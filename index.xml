<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jose Storopoli, PhD</title>
  <link rel="alternate" href="https://storopoli.io/" />
  <link rel="self" href="https://storopoli.io/index.xml" />
  <subtitle>Recent content on Jose Storopoli, PhD</subtitle>
  <id>https://storopoli.io/</id>
  <generator uri="http://gohugo.io" version="0.122.0">Hugo</generator>
  <language>en-us</language>
  <updated>2024-02-05T18:53:28-03:00</updated>
  <author>
    <name>Jose Storopoli</name>
    
  </author>
  <rights>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/)</rights>
      <entry>
        <title>Cryptography Basics</title>
        <link rel="alternate" href="https://storopoli.io/2024-02-05-crypto-basics/" />
        <id>https://storopoli.io/2024-02-05-crypto-basics/</id>
        <published>2024-02-05T18:53:28-03:00</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">Euclid&amp;rsquo;s one-way function
Warning: This post has KaTeX enabled, so if you want to view the rendered math formulas, you&amp;rsquo;ll have to unfortunately enable JavaScript.
This is the companion post to the cryptography workshop that I gave at a local BitDevs. Let&amp;rsquo;s explore the basics of cryptography. We&amp;rsquo;ll go through the following topics:
One-way functions Hash functions Public-key cryptography DSA Schnorr Why we don&amp;rsquo;t reuse nonces? Why we can combine Schnorr Signatures and not DSA?</summary>
          <content type="html"><![CDATA[<figure>
    <img loading="lazy" src="euclid.webp"
         alt="Euclid&#39;s one-way function"/> <figcaption>
            <p>Euclid&rsquo;s one-way function</p>
        </figcaption>
</figure>

<blockquote>
<p>Warning: This post has <a href="https://katex.org/">KaTeX</a> enabled,
so if you want to view the rendered math formulas,
you&rsquo;ll have to unfortunately enable JavaScript.</p>
</blockquote>
<p>This is the companion post to the <a href="https://github.com/storopoli/cryptography-workshop">cryptography workshop</a>
that I gave at a local BitDevs.
Let&rsquo;s explore the basics of cryptography.
We&rsquo;ll go through the following topics:</p>
<ul>
<li>One-way functions</li>
<li>Hash functions</li>
<li>Public-key cryptography</li>
<li>DSA</li>
<li>Schnorr</li>
<li>Why we don&rsquo;t reuse nonces?</li>
<li>Why we can combine Schnorr Signatures and not DSA?</li>
</ul>
<h2 id="one-way-functions">One-way functions</h2>
<p>A one-way function is a <strong>function that is easy to compute on every input,
but hard to invert given the image<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> of a random input</strong>.
For example, imagine an omelet.
It&rsquo;s easy to make an omelet from eggs,
but it&rsquo;s hard to make eggs from an omelet.
In a sense we can say that the function $\text{omelet}$ is a one-way function</p>
<p>$$\text{omelet}^{-1}(x) = \ldots$$</p>
<p>That is, we don&rsquo;t know how to invert the function $\text{omelet}$ to get the original eggs back.
Or, even better, <strong>the benefit we get from reverting the omelet to eggs is not worth the effort,
either in time or money</strong>.</p>
<p>Not all functions are one-way functions.
The exponential function, $f(x) = e^x$, is not a one-way function.
It is easy to undo the exponential function by taking the natural logarithm,</p>
<p>$$f^{-1}(x) = \ln(x)$$</p>
<p>To showcase one-way functions, let&rsquo;s take a look at the following example.
Let&rsquo;s play around with some numbers.
Not any kind of numbers, but very special numbers called <strong>primes</strong>.
A prime number is a natural number greater than 1 that has no positive divisors other than 1 and itself.</p>
<p>If I give you a big number $n$ and ask you to find its prime factors,
and point a gun at your head,
you&rsquo;ll pretty much screwed.
There&rsquo;s no known efficient algorithm<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> to factorize a big number into its prime factors.
You&rsquo;ll be forced to test all numbers from 2 to $\sqrt{n}$ to see if they divide $n$.</p>
<p>Here&rsquo;s a number:</p>
<p>$$90809$$</p>
<p>What are its prime factors?
It&rsquo;s $1279 \cdot 71$.
Easy to check, right?
Hard to find.
That&rsquo;s because prime factorization, if you choose a fucking big number, is a one-way function.</p>
<h2 id="hash-functions">Hash Functions</h2>
<p>Let&rsquo;s spice things up.
There is a special class of one-way functions called <strong>hash functions</strong>.</p>
<p><strong>A hash function is any function that can be used to map data of arbitrary size to fixed-size values</strong>.</p>
<p>But we are most interested in <strong><em>cryptographic</em> hash functions</strong>,
which are hash functions that have statistical properties desirable for cryptographic application:</p>
<ul>
<li><strong>One-way function</strong>: easy to compute $y = f(x)$, hard as fuck to do the opposite, $x = f^{-1}(y)$.</li>
<li><strong>Deterministic</strong>: given a function that maps elements from set $X$ to set $Y$, $f: X \to Y$,
for every $x \in X$ there&rsquo;s <em>at least one</em> $y \in Y$<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.
This means that if I give you a certain input, it will always map to the same output.
It is deterministic.</li>
<li><strong>Collision resistance</strong>: the possible values of $f: X \to Y$ follows a uniform distribution,
that is, given the size of the set $Y$,
it is hard to find two $x_1, x_2 \in X$ that have the same $y \in Y$ value<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.
This property is really important because if an attacker wants to brute-force the
hash function, there&rsquo;s no option than searching uniformly across the whole possible
space of possible values that the hash function outputs.</li>
</ul>
<p>These properties make enable cryptographic hash functions to be used in a wide range of applications,
including but not limited to:</p>
<ul>
<li>
<p><strong>Digital signatures</strong>: Hash functions are used to create a digest of the message to be signed.
The digital signature is then generated using the hash, rather than the message itself,
to ensure integrity and non-repudiation.</p>
</li>
<li>
<p><strong>Password hashing</strong>: Storing passwords as hash values instead of plain text.
Even if the hash values are exposed,
the original passwords remain secure due to the pre-image resistance property.</p>
</li>
<li>
<p><strong>Blockchain and cryptocurrency</strong>: Hash functions are used to maintain the integrity of the blockchain.
Each block contains the hash of the previous block, creating a secure link.
Cryptographic hashes also underpin various aspects of cryptocurrency transactions.</p>
</li>
<li>
<p><strong>Data integrity verification</strong>: Hash functions are used to ensure that files, messages,
or data blocks have not been altered.
By comparing hash values computed before and after transmission or storage,
any changes in the data can be detected.</p>
</li>
</ul>
<p>We&rsquo;ll cover just the <strong>digital signatures</strong> part in this post.</p>
<h3 id="sha-2-and-its-variants">SHA-2 and its variants</h3>
<p>The Secure Hash Algorithm 2 (SHA-2) is a set of cryptographic hash functions designed by the National Security Agency (NSA).
It was first published in 2001.</p>
<p>It is composed of six hash functions with digests that are 224, 256, 384, 512, 512/224, and 512/256 bits long:</p>
<ul>
<li><code>SHA-224</code></li>
<li><code>SHA-256</code></li>
<li><code>SHA-384</code></li>
<li><code>SHA-512</code></li>
<li><code>SHA-512/224</code></li>
<li><code>SHA-512/256</code></li>
</ul>
<p>Amongst these, let&rsquo;s focus on SHA-256, which is the most widely used while also being notoriously adopted by bitcoin.</p>
<p>SHA-256 does not have any known vulnerabilities and is considered secure.
It comprises of 32-bit words and operates on 64-byte blocks.
The algorithm does 64 rounds of the following operations:</p>
<ul>
<li><code>AND</code>: bitwise boolean AND</li>
<li><code>XOR</code>: bitwise boolean XOR</li>
<li><code>OR</code>: bitwise boolean OR</li>
<li><code>ROT</code>: right rotation bit shift</li>
<li><code>ADD</code>: addition modulo $2^{32}$</li>
</ul>
<p>You can check <a href="https://en.wikipedia.org/wiki/SHA-2#Pseudocode">SHA-256 Pseudocode on Wikipedia</a>.
It really scrambles the input message in a way that is very hard to reverse.</p>
<p>These operations are non-linear and very difficult to keep track of.
In other words, you can&rsquo;t reverse-engineer the hash to find the original message.
There&rsquo;s no <a href="https://en.wikipedia.org/wiki/Automatic_differentiation">&ldquo;autodiff&rdquo;</a> for hash functions.</p>
<p>Since it is a cryptographic hash function,
if we change just one bit of the input,
the output will be completely different.
Check this example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;The quick brown fox jumps over the lazy dog&#34;</span> <span class="p">|</span> shasum -a <span class="m">256</span>   
</span></span><span class="line"><span class="cl">c03905fcdab297513a620ec81ed46ca44ddb62d41cbbd83eb4a5a3592be26a69  -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;The quick brown fox jumps over the lazy dog.&#34;</span> <span class="p">|</span> shasum -a <span class="m">256</span>
</span></span><span class="line"><span class="cl">b47cc0f104b62d4c7c30bcd68fd8e67613e287dc4ad8c310ef10cbadea9c4380  -
</span></span></code></pre></div><p>Here we are only adding a period at the end of the sentence,
and the hash is completely different.
This is due to the property of collision resistance that we mentioned earlier.</p>
<h2 id="fields">Fields</h2>
<p>Before we dive into public-key cryptography,
we need a brief interlude on fields.</p>
<p><strong><a href="https://en.wikipedia.org/wiki/Field_(mathematics)">Fields</a> are sets with two binary operations,
called addition $+$ and multiplication $\times$</strong>.
We write</p>
<p>$$F = (F, +, \times)$$</p>
<p>to denote a field,
where $F$ is the set, $+$ is the addition operation,
and $\times$ is the multiplication operation.</p>
<p>Addition and multiplication behave similar to the addition and multiplication of real numbers.
For example, addition is <strong>commutative</strong> and <strong>associative</strong></p>
<p>$$a + b = b + a,$$</p>
<p>and multiplication is <strong>distributive</strong></p>
<p>$$a \times (b + c) = a \times b + a \times c.$$</p>
<p>Also, there are two special elements in the field,
called the <strong>additive identity</strong> $-a$ and the <strong>multiplicative identity</strong> $a^{-1}$,
such that</p>
<p>$$a + (-a) = I,$$</p>
<p>and</p>
<p>$$a \times a^{-1} = I,$$</p>
<p>where $I$ is the identity element.</p>
<p>Note that this allows us to define <strong>subtraction</strong></p>
<p>$$a - b = a + (-b),$$</p>
<p>and <strong>division</strong></p>
<p>$$a \div b = a \times b^{-1}.$$</p>
<h3 id="finite-fields">Finite Fields</h3>
<p>Now we are ready for finite fields.
A <a href="https://en.wikipedia.org/wiki/Finite_field"><em>finite field</em></a>, also called a Galois field (in honor of Évariste Galois),
is a <strong>field with a finite number of elements.
As with any field, a finite field is a set on which the operations of multiplication,
addition, subtraction and division are defined and satisfy the rules above for fields</strong>.</p>
<p>Finite fields is a very rich topic in mathematics,
and there are many ways to construct them.
The easiest way to construct a finite field is to take the <strong>integers modulo a prime number $p$</strong>.
For example $\mathbb{Z}_5$ is a finite field with 5 elements:</p>
<p>$$\mathbb{Z}_5 = \lbrace 0, 1, 2, 3, 4 \rbrace.$$</p>
<p>In general, $\mathbb{Z}_n$ is a finite field with $n$ elements:</p>
<p>$$\mathbb{Z}_n = \lbrace 0, 1, 2, \ldots, n - 1 \rbrace.$$</p>
<p><strong>The number of elements in a finite field is called the <em>order</em> of the field</strong>.
The order of a finite field is <strong>always a prime number $p$</strong>.
The $\mathbb{Z}_5$ example above is a finite field of order 5.
However, $\mathbb{Z}_4$ is not a finite field,
because 4 is not a prime number, but rather a composite number.</p>
<p>$$4 = 2 \times 2.$$</p>
<p>And we can write $\mathbb{Z}_4$ as</p>
<p>$$\mathbb{Z}_4 = 2 \times \mathbb{Z}_2.$$</p>
<p>This means that every element in $a \in \mathbb{Z}_4$ can be written as</p>
<p>$$a = 2 \times b,$$</p>
<p>where $b$ is an element in $\mathbb{Z}_2$.</p>
<p>Hence, not every element of $\mathbb{Z}_4$ is unique, and they are equivalent to the elements in $\mathbb{Z}_2$.</p>
<p>In general if $n$ is a composite number,
then $\mathbb{Z}_n$ is not a finite field.
However, if $n = r \times s$ where $r$ and $s$ are prime numbers,
and $r &lt; s$,
then $\mathbb{Z}_n$ is a finite field of order $r$.</p>
<h4 id="operations-in-finite-fields">Operations in Finite Fields</h4>
<p><strong>Addition</strong> in finite fields is defined as the remainder of the sum of two elements modulo the order of the
field.</p>
<p>For example, in $\mathbb{Z}_3$,</p>
<p>$$1 + 2 = 3 \mod 3 = 0.$$</p>
<p>We can also define subtraction in finite fields as the remainder of the difference of two elements modulo the order of the field.</p>
<p>For example, in $\mathbb{Z}_3$,</p>
<p>$$1 - 2 = -1 \mod 3 = 2.$$</p>
<p>Multiplication in finite fields can be written as multiple additions.
For example, in $\mathbb{Z}_3$,</p>
<p>$$2 \times 2 = 2 + 2 = 4 \mod 3 = 1.$$</p>
<p>Exponentiation in finite fields can be written as multiple multiplications.
For example, in $\mathbb{Z}_3$,</p>
<p>$$2^2 = 2 \times 2 = 4 \mod 3 = 1.$$</p>
<p>As you can see addition, subtraction, and multiplication becomes linear operations.
This is very trivial for any finite field.</p>
<p>However, for division we are pretty much screwed.
It is really hard to find the multiplicative inverse of an element in a finite field.
For example, suppose that we have numbers $a,b$ in a very large finite field $\mathbb{Z}_p$,
such that</p>
<p>$$c = a \times b \mod p.$$</p>
<p>Then we can write division as</p>
<p>$$a = c \div b = c \times b^{-1} \mod p.$$</p>
<p>Now we need to find $b^{-1}$, which is the multiplicative inverse of $b$.
This is called the <a href="https://en.wikipedia.org/wiki/Discrete_logarithm"><strong><em>discrete logarithm problem</em></strong></a>.
Because we need to find $b^{-1}$ such that</p>
<p>$$b^{-1} = \log_b c \mod p.$$</p>
<p>Since this number is a discrete number and not a real number,
that&rsquo;s why it&rsquo;s called the discrete logarithm problem.</p>
<p>Good luck my friend, no efficient method is known for computing them in general.
You can try brute force, but that&rsquo;s not efficient.</p>
<h4 id="why-the-discrete-logarithm-problem-is-hard-as-fuck">Why the Discrete Logarithm Problem is Hard as Fuck</h4>
<p>To get a feeling why the discrete logarithm problem is difficult,
let&rsquo;s add one more concept to our bag of knowledge.
Every finite field has <em><strong>generators</strong></em>,
also known as <em><strong>primitive roots</strong></em>,
which is also a member of the group,
such that applying multiplication to this one single element
makes possible to generate the whole finite field.</p>
<p>Let&rsquo;s illustrate this with an example.
Below we have a table of all the results of the following operation</p>
<p>$$b^x \mod 7$$</p>
<p>for every possible value of $x$.
As you&rsquo;ve guessed right this is the $\mathbb{Z}_7$ finite field.</p>
<table>
<thead>
<tr>
<th style="text-align:center">$b$</th>
<th style="text-align:center">$b^1 \mod 7$</th>
<th style="text-align:center">$b^2 \mod 7$</th>
<th style="text-align:center">$b^3 \mod 7$</th>
<th style="text-align:center">$b^4 \mod 7$</th>
<th style="text-align:center">$b^5 \mod 7$</th>
<th style="text-align:center">$b^6 \mod 7$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$5$</td>
<td style="text-align:center">$4$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$2$</td>
<td style="text-align:center">$3$</td>
<td style="text-align:center">$1$</td>
</tr>
<tr>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$6$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$1$</td>
</tr>
</tbody>
</table>
<p>You see that something interesting is happening here.
For specific values of $b$, such as $b = 3$, and $b = 5$, we are able to <strong>generate the whole finite field</strong>.
Hence, say that $3$ and $5$ are <em><strong>generators</strong></em> or <em><strong>primitive roots</strong></em> of $\mathbb{Z}_7$.</p>
<p>Now suppose I ask you to find $x$ in the following equation</p>
<p>$$3^x \mod p = 11$$</p>
<p>where $p$ is a very large prime number.
Then you don&rsquo;t have any other option than brute forcing it.
<strong>You&rsquo;ll need to try each exponent $x \in \mathbb{Z}_p$ until you find the one that satisfies the equation</strong>.</p>
<p>Notice that this operation is very asymmetric.
It is very easy to compute $3^x \mod p$ for any $x$,
but it is very hard to find $x$ given $3^x \mod p$.</p>
<p>Now we are ready to dive into public-key cryptography.</p>
<h4 id="numerical-example-of-the-discrete-logarithm-problem">Numerical Example of the Discrete Logarithm Problem</h4>
<p>Let&rsquo;s illustrate the discrete logarithm problem with a numerical example.</p>
<ol>
<li><strong>Choose a prime number $p$</strong>. Let&rsquo;s pick $p = 17$.</li>
<li><strong>Choose a generator $g$ of the group</strong>.
For $p = 17$, we can choose $g = 3$ because $3$ is a primitive root of $\mathbb{Z}_{17}$.</li>
<li><strong>Choose an element $x$</strong>.
Let&rsquo;s pick $x = 15$.</li>
</ol>
<p>The discrete logarithm problem is to find $x$ given $g^x \mod p$.
So let&rsquo;s plug in the numbers; find $x$ in</p>
<p>$$3^x = 15 \mod 17 $$</p>
<p>Try to find it.
Good luck<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>.</p>
<h2 id="public-key-cryptography">Public-key cryptography</h2>
<p>Public-key cryptography, or asymmetric cryptography, is a cryptographic system that uses pairs of keys:
private and public.
The public key you can share with anyone,
but the private key you must keep secret.
The keys are related mathematically,
but it is computationally infeasible to derive the private key from the public key.
In other words, the public key is a one-way function of the private key.</p>
<p>Before we dive into the details of the public-key cryptography, and signing and verifying messages,
let me introduce some notation:</p>
<ul>
<li>$p$: big fucking huge prime number (4096 bits or more)</li>
<li>$\mathbb{Z}_p$: the finite field of order $p$</li>
<li>$g$: a generator of $\mathbb{Z}_p$</li>
<li>$S_k$: secret key, a random integer in the finite field $\mathbb{Z}_p$</li>
<li>$P_k$: public key derived by $P_k = g^{S_k}$</li>
</ul>
<p>If you know $S_k$ and $g$ (which is almost always part of the spec),
then it&rsquo;s easy to derive the $P_k$.
However, if you only know $g$ and $P_k$, good luck finding $S_k$.
It&rsquo;s the discrete log problem again.
And as long $p$ is HUGE you are pretty confident that no one will find your secret key
from your public key.</p>
<p>Now what we can do with these keys and big prime numbers?
We&rsquo;ll we can sign a message with our secret key and everyone can verify the authenticity of
the message using our public key.
The message in our case it is commonly a hash function of the &ldquo;original message&rdquo;.
Due to the collision resistance property, we can definitely assert that:</p>
<ol>
<li>the message has not been altered</li>
<li>the message was signed by the owner of the private key</li>
</ol>
<p>Fun fact, I once gave a recommendation letter to a very bright student,
that was only a plain text file signed with my private key.
I could rest assured that the letter was not altered,
and the student and other people could verify that I was the author of the letter.</p>
<p>Next, we&rsquo;ll dive into the details of the Digital Signature Algorithm (DSA)
and the Schnorr signature algorithm.</p>
<h2 id="dsa">DSA</h2>
<p>DSA stands for <a href="https://en.wikipedia.org/wiki/Digital_Signature_Algorithm">Digital Signature Algorithm</a>.
It was first proposed by the National Institute of Standards and Technology (NIST) in 1991.
Note that <a href="https://lwn.net/Articles/958048/">OpenSSH announced that DSA is scheduled for removal in 2025</a>.</p>
<p>Here&rsquo;s how you can sign a message using DSA:</p>
<ol>
<li>Choose two prime numbers $p, q$ such that $p - 1 \mod q = 0$ (e.g., 1279 and 71).</li>
<li>Choose your private key $S_k$ as a random integer $\in [1, q-1]$.</li>
<li>Choose a generator $g$.</li>
<li>Compute your public key $P_k$: $g^{S_k} \mod p$.</li>
<li>Choose your nonce $k$: as a random integer $\in [1, q-1]$.</li>
<li>Compute your &ldquo;public nonce&rdquo; $K$: $(g^k \mod p) \mod q$ (also known as $r$).</li>
<li>Get your message ($m$) through a cryptographic hash function $H$: $H(m)$.</li>
<li>Compute your signature $s$: $(k^{-1} (H(m) + S_k K)) \mod q$.</li>
<li>Send to your buddy $(p, q, g)$, $P_k$, and $(K, s)$.</li>
</ol>
<p>And here&rsquo;s how you can verify the signature:</p>
<ol>
<li>Compute $w = s^{-1} \mod q$.</li>
<li>Compute $u_1 = H{m} \cdot w \mod q$.</li>
<li>Compute $u_2 = K \cdot w \mod q$.</li>
<li>Compute $K^* = {g^{u_1} P^{u_2}_k \mod p} \mod q$.</li>
<li>Assert $K = K^*$.</li>
</ol>
<p>How this works?
Let&rsquo;s go through a proof of correctness.
I added some comments to every operation in parentheses to make it easier to follow.</p>
<ol>
<li>$s = k^{-1} \cdot {H + S_k K} \mod q$ ($\mod p$ and $H(m)$ implicit).</li>
<li>$k = s^{-1} \cdot {H + S_k K} \mod q$ (move $s$ to $k$).</li>
<li>$k = H \cdot s^{-1} + S_k K \cdot s^{-1} \mod q$ (distribute $s^{-1}$).</li>
<li>$k = H \cdot w + S_k K \cdot w \mod q$ ($w = s^{-1}$).</li>
<li>$g^k = g^{H \cdot w + S_k K \cdot w \mod q}$ (put $g$ in both sides).</li>
<li>$g^k = g^{H \cdot w \mod q} \cdot g^{S_k K \cdot w \mod q}$ (product of the exponents).</li>
<li>$g^k = g^{H \cdot w \mod q} \cdot P^{K \cdot w \mod q}_k$ ($P_k = g^{S_k}$).</li>
<li>$g^k = g^{u_1} \cdot P^{u_2}_k$ (replace $u_1$ and $u_2$).</li>
<li>$K = K^*$ (replace $K$ and $K^*$).</li>
</ol>
<p>There you go.
This attest that the signature is correct and the message was signed by the owner of the private key.</p>
<h2 id="schnorr">Schnorr</h2>
<p><a href="https://en.wikipedia.org/wiki/Schnorr_signature">Schnorr signature algorithm</a>
is a very similar algorithm to DSA.
It was proposed by Claus-Peter Schnorr in 1989.
It is considered to be more secure than DSA and is also more efficient.
The patent for Schnorr signatures expired in 2008,
just in time for Satoshi to include it in Bitcoin.
However, it was probably not included due to the fact that there wasn&rsquo;t
good battle-tested software implementations of it at the time.
However, it was added to Bitcoin in the Taproot upgrade<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>.</p>
<p>Schnorr is a marvelous algorithm.
It is so much simpler than DSA.
Here&rsquo;s how you sign a message using Schnorr:</p>
<ol>
<li>Choose a prime number $p$.</li>
<li>Choose your private key $S_k$ as a random integer $\in [1, p-1]$.</li>
<li>Choose a generator $g$.</li>
<li>Compute your public key $P_k$: $g^{S_k}$.</li>
<li>Choose your nonce $k$: as a random integer $\in [1, p-1]$.</li>
<li>Compute your &ldquo;public nonce&rdquo; $K$: $g^k \mod p$ (also known as $r$).</li>
<li>Get your message ($m$) through a cryptographic hash function $H$ concatenating with $K$: $e = H(K || m)$.</li>
<li>Compute your signature $s$: $k - S_k e$.</li>
<li>Send to your buddy $(p, g)$, $P_k$, and $(K, s)$.</li>
</ol>
<p>And here&rsquo;s how you can verify the signature:</p>
<ol>
<li>Compute $e = H(K || m)$.</li>
<li>Compute $K^* = g^s P_k^e$.</li>
<li>Compute $e^* = H(K^* || m)$.</li>
<li>Assert $e = e^*$.</li>
</ol>
<p>How this works?
Let&rsquo;s go through a proof of correctness.
As before, I added some comments to every operation in parentheses to make it easier to follow.</p>
<ol>
<li>$K^* = g^s P_k^e$ ($\mod p$ implicit).</li>
<li>$K^* = g^{k - S_k e} g^{S_k e}$ ($s = k - S_k e$ and $P_k = g^{S_k}$).</li>
<li>$K^* = g^k$ (cancel $S_k e$ in the exponent of $g$).</li>
<li>$K^* = K$ ($K = g^k$).</li>
<li>Hence $H(K^* || m) = H(K || m)$.</li>
</ol>
<p>There you go.
This attest that the signature is correct and the message was signed by the owner of the private key.</p>
<h2 id="why-we-dont-reuse-nonces">Why we don&rsquo;t reuse nonces?</h2>
<p>Never, ever, reuse a nonce.
Why?
First, because nonce is short for &ldquo;number used once&rdquo;.
It is supposed to be used only once.
Because if you reuse a nonce, then you are pretty much screwed.
An attacker can derive your private key from two signatures with the same nonce.
This is called the &ldquo;nonce reuse attack&rdquo;.</p>
<p>Fun fact: this is what happened to the
<a href="https://en.wikipedia.org/wiki/PlayStation_3_homebrew#Private_key_compromised">PlayStation 3</a>.</p>
<p>Let&rsquo;s see how we can derive the private key from two signatures with the same nonce.
Here we are in a context that we have two signatures $s$ and $s^\prime$,
both using the same nonce $k = k^\prime$.</p>
<p>First, let&rsquo;s do the <del>ugly</del> DSA math:</p>
<p>$$\begin{aligned}
s^\prime - s &amp;= (k^{\prime {-1}} (H(m_1) + S_k K&rsquo;)) - (k^{-1} (H(m_2) + S_k K)) \\
s^\prime - s &amp;= k^{-1} (H(m_1) - H(m_2)) \\
k &amp;= (H(m_1) - H(m_2)) (s^\prime - s)^{-1}
\end{aligned}$$</p>
<p>Now remember you know $s$, $s^\prime$, $H(m_1)$, $H(m_2)$ $K$, and $K^\prime$.
Let&rsquo;s do the final step and solve for $S_k$:</p>
<p>$$S_k = K^{-1}  (k s - H(m_1))$$</p>
<p>Now let&rsquo;s do the Schnorr math.
But in Schnorr, everything is simpler.
Even nonce reuse attacks.</p>
<p>$$s^\prime - s = (k^\prime - k) - S_k (e^\prime - e)$$</p>
<p>If $k^\prime = k$ (nonce reuse) then you can easily isolate $S_k$ with simple algebra.</p>
<p>Remember: you know $s^\prime, s, e, e^\prime$ and $k^\prime - k = 0$.</p>
<h2 id="why-we-can-combine-schnorr-signatures-and-not-dsa">Why we can combine Schnorr Signatures and not DSA?</h2>
<p>In Bitcoin, we can combine Schnorr signatures and not DSA.
Why?
Because Schnorr signatures are linear.
This means that you can add two Schnorr signatures and get a valid signature for the sum of the messages.
This is not possible with DSA.
This is called the &ldquo;linearity property&rdquo; of Schnorr signatures.</p>
<p>Remember that in $Z_p$ addition, multiplication, and exponentiation,
i.e anything with $+, \cdot, -$, are linear operations
However, division (modular inverse),
.i.e anything that is $^{-1}$, is not linear.
That is:</p>
<p>$$x^{-1} + y^{-1} != (x + y)^{-1}.$$</p>
<p>Here&rsquo;s a trivial python code that shows that modular inverse is not linear:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">71</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kc">False</span>
</span></span></code></pre></div><p>Let&rsquo;s revisit the signature step of DSA and Schnorr:</p>
<ul>
<li>DSA: $s = k^{-1} (H(m) + S_k K)$</li>
<li>Schnorr: $s = k - S_k H(K || m)$</li>
</ul>
<p>So if you have two Schnorr signatures $s_1$ and $s_2$ for two messages $m_1$ and $m_2$,
then you can easily compute a valid signature for the sum of the messages $m_1 + m_2$:</p>
<p>$$s = s_1 + s_2$$</p>
<p>Also note that we can combine Schnorr public keys:</p>
<p>$$P^\prime_k + P_k = g^{S^\prime_k} + g^{S_k} = g^{S_k^\prime + S_k}$$</p>
<p>And the signature $s$ for the sum of the messages $m_1 + m_2$
can be verified with the public key $P^\prime_k + P_k$.</p>
<p>This is not possible with DSA.</p>
<p>Because the signature step in DSA is not linear,
it has a $k^{-1}$ in it.</p>
<h2 id="technical-interlude-elliptic-curves">Technical Interlude: Elliptic Curves</h2>
<p>Technically speaking, Bitcoin uses the Elliptic Curve Digital Signature Algorithm (ECDSA),
and the Schnorr signature algorithm is based on the same elliptic curve (EC) as ECDSA.</p>
<p>And trivially speaking EC public-key cryptography in the end is just a finite field
on $\mathbb{Z}_p$.
It has everything that we&rsquo;ve seen so far:</p>
<ul>
<li>Addition</li>
<li>Subtraction</li>
<li>Multiplication</li>
<li>Division</li>
<li>Exponentiation</li>
<li>Generators</li>
<li>Discrete Logarithm Problem</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>I hope you enjoyed this companion post to the
<a href="https://github.com/storopoli/cryptography-workshop">cryptography workshop</a>.
Remember don&rsquo;t reuse nonces.</p>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>the image of a function $f$ is the set of all values that $f$ may produce.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>the problem of factoring a number into its prime factors is not known to be in
the class of problems that can be solved in polynomial time, P.
It is not known to be NP-complete, NP, either.
Actually to find it P is NP or not is the hardest way to earn a million dollars,
<a href="https://en.m.wikipedia.org/wiki/Millennium_Prize_Problems#P_versus_NP">the P vs NP problem</a>.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>this is called <a href="https://en.wikipedia.org/wiki/Bijection%2C_injection_and_surjection">surjection</a>.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>at least $\frac{1}{N}$ where $N$ is the size of $Y$.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>The answer is $x = 6$. This means that $3^6 = 15 \mod 17$.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>Taproot is a proposed Bitcoin protocol upgrade that was deployed
as a forward-compatible soft fork.
The validation of Taproot is based on Schnorr signatures.
You can find more in BIPS
<a href="https://github.com/bitcoin/bips/blob/master/bip-0340.mediawiki">340</a>,
<a href="https://github.com/bitcoin/bips/blob/master/bip-0341.mediawiki">341</a>, and
<a href="https://github.com/bitcoin/bips/blob/master/bip-0342.mediawiki">342</a>.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content>
      </entry>
      <entry>
        <title>Fullstack and Progressive Web Apps in Rust: A Tale of a Sudoku Spyware</title>
        <link rel="alternate" href="https://storopoli.io/2024-01-30-sudoku/" />
        <id>https://storopoli.io/2024-01-30-sudoku/</id>
        <published>2024-01-30T08:57:33Z</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">It all started when I had to accompany my mom to the hospital. It was just a routine checkup, but I had to wait for a few hours. I brought my laptop with me, since they have good WiFi and I could work on my projects. Then I realized that my mom was playing a Sudoku1 game on her phone. I couln&amp;rsquo;t help but notice that the game was full of ads and it was asking for a lot of permissions, like location and sensor data.</summary>
          <content type="html"><![CDATA[<p><img loading="lazy" src="rust_webdev_meme.jpg#center" alt="rust webdev meme"  />
</p>
<p>It all started when I had to accompany my mom to the hospital.
It was just a routine checkup, but I had to wait for a few hours.
I brought my laptop with me, since they have good WiFi and I could work on my projects.
Then I realized that my mom was playing a <a href="https://en.wikipedia.org/wiki/Sudoku">Sudoku</a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>
game on her phone.
I couln&rsquo;t help but notice that the game was full of ads and it was asking for a lot of permissions,
like location and sensor data.
So I decided to make a <strong>Sudoku game for her, without ads or using any permission</strong>.
It wouldn&rsquo;t even need to ask for the blessing of Google or <a href="https://youtu.be/XHVxm12NbrY">Tim Apple</a>
since it was a Progressive Web App (PWA) and it would work offline.</p>
<p>You can play the game at <a href="https://storopoli.io/sudoku">storopoli.io/sudoku</a>
or check the source code at <a href="https://github.com/storopoli/sudoku"><code>storopoli/sudoku</code></a>.</p>
<p>Here&rsquo;s a screenshot of the game:</p>
<p><img loading="lazy" src="sudoku_screenshot.png#center" alt="sudoku screenshot"  />
</p>
<h2 id="tools-of-choice">Tools of Choice</h2>
<p>So what would I use to build this game?
Only one thing: <a href="https://dioxuslabs.com/"><strong>Dioxus</strong></a>.
Dioxus is a fullstack framework for Rust,
that allows you to build web applications with Rust.
You can benefit from the safety and performance of Rust,
powerful type system and borrow checker,
along with the low memory footprint.</p>
<p>That&rsquo;s it. <strong>Just Rust and HTML with some raw CSS</strong>.
No &ldquo;YavaScript&rdquo;. No Node.js. No npm. No webpack. No Tailwind CSS.
Just <code>cargo run --release</code> and you&rsquo;re done.</p>
<h2 id="package-management">Package Management</h2>
<p>Using Rust for fullstack development is an amazing thing.
First, <strong>package management is a breeze with Cargo</strong>.
Second, you don&rsquo;t have to worry about <strong>&ldquo;npm vulnerabilities&rdquo;</strong>.
Have you ever gone into your project and ran <code>npm audit</code>?</p>
<p><img loading="lazy" src="npm_vulnerabilities.png#center" alt="npm_vulnerabilities"  />
</p>
<p>This is solvable with Rust.</p>
<h2 id="runtime-errors">Runtime Errors</h2>
<p>An additional advantage is that you <strong>don&rsquo;t have to worry about common
runtime errors</strong> like <code>undefined is not a function</code> or <code>null is not an object</code>.
These are all picked-up by <strong>Rust on compile time</strong>.
So you can focus on the logic of your application knowing that it will work as <strong>expected</strong>.</p>
<p>A common workflow in Rust fullstack applications is to use Rust&rsquo;s powerful type system
to parse any user input into a type that you can trust, and then propagate that type
throughout your application. This way you can be sure that you&rsquo;re not going to have
any runtime errors due to invalid input. This is not the case with &ldquo;YavaScript&rdquo;.
You need to validate the input at every step of the way, and you can&rsquo;t be sure
that the input is valid at any point in time.</p>
<p>You can sleep soundly at night knowing that your application won&rsquo;t crash
and as long as the <strong>host machine has electricity and internet access,
your app is working as expected</strong><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<h2 id="performance">Performance</h2>
<p>Rust is known for its <strong>performance</strong>.
This is due to the fact that Rust gives you control over deciding on which type you&rsquo;ll use for a variable.
This is not the case with &ldquo;YavaScript&rdquo;, where you can&rsquo;t decide if a variable is a number or a string.
Also you can use references and lifetimes to avoid copying data around.</p>
<p>So, if you make sane decisions, like <code>u8</code> (unsigned 8-bit integer) instead of <code>i32</code> (signed 32-bit integer)
for a number that will never be greater than 255, you can have a very low memory footprint.
Also you can use <code>&amp;str</code> (string slice) instead of <code>String</code> to avoid copying strings around.</p>
<p>You just don&rsquo;t have this level of control with &ldquo;YavaScript&rdquo;.
You get either strings or numbers and you can&rsquo;t decide on the size of the number.
And all of your strings will be heap-allocated and copied around.</p>
<h2 id="progressive-web-apps">Progressive Web Apps</h2>
<p>Progressive Web Apps (PWAs) are web applications that are regular web pages or websites,
but can appear to the user like traditional applications or native mobile applications.
Since they use the device&rsquo;s browser, they don&rsquo;t need to be installed through an app store.
This is a great advantage, since you don&rsquo;t have to ask for permissions to Google or
<a href="https://youtu.be/XHVxm12NbrY">Tim Apple</a>.</p>
<p><strong>In Dioxus making a PWA was really easy</strong>.
There is a PWA template in the <a href="https://github.com/DioxusLabs/dioxus/tree/master/examples/PWA-example"><code>examples/</code> directory in their repository</a>.
You just have to follow the instructions in the README and you&rsquo;re done.
In my case, I only had to change the metadata in the <code>manifest.json</code> file
and add what I wanted to cache in the service worker <code>.js</code> file.
These were only the favicon icon and the CSS style file.</p>
<h2 id="sudoku-algorithm">Sudoku Algorithm</h2>
<p>I didn&rsquo;t have to worry about the algorithm to generate the Sudoku board.
This was already implemented in the <a href="https://crates.io/crates/sudoku"><code>sudoku</code></a> crate.
But I had to implement some <strong>Sudoku logic to make the user interface work</strong>.</p>
<p>Some things that I had to implement were:</p>
<ul>
<li><strong>find the related cells</strong>.
Given a cell, find the cells in the same row, column and sub-grid.</li>
<li><strong>find the conflicting cells</strong>.
Given a cell, find the cells in the same row, column and sub-grid that have the same value.</li>
</ul>
<h3 id="find-the-related-cells">Find the Related Cells</h3>
<p>This was a simple task, yet it was very fun to implement.</p>
<p>To get the related cells, you need to find the row and column of the cell.
Then you can find the start row and start column of the 3x3 sub-grid.
After that, you can add the cells in the same row, column and sub-grid to a vector.
Finally, you can remove the duplicates and the original cell from the vector.</p>
<p>Here&rsquo;s the code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_related_cells</span><span class="p">(</span><span class="n">index</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">related_cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">start_row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">row</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">start_col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Add cells in the same row
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">related_cells</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">row</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Add cells in the same column
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">related_cells</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">col</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Add cells in the same 3x3 sub-grid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">start_row</span><span class="o">..</span><span class="n">start_row</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">start_col</span><span class="o">..</span><span class="n">start_col</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">related_cells</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Remove duplicates and the original cell
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">related_cells</span><span class="p">.</span><span class="n">sort_unstable</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">related_cells</span><span class="p">.</span><span class="n">dedup</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">related_cells</span><span class="p">.</span><span class="n">retain</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">index</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">related_cells</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="find-the-conflicting-cells">Find the Conflicting Cells</h3>
<p>To find the conflicting cells, you need to get the value of the target cell.
Then you can get the related cells and filter the ones that have the same value as the target cell.
Easy peasy.</p>
<p>Here&rsquo;s the code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_conflicting_cells</span><span class="p">(</span><span class="n">board</span>: <span class="kp">&amp;</span><span class="nc">SudokuState</span><span class="p">,</span><span class="w"> </span><span class="n">index</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Get the value of the target cell
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">board</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Ignore if the target cell is empty (value 0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Vec</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Get related cells
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">related_cells</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_related_cells</span><span class="p">(</span><span class="n">index</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Find cells that have the same value as the target cell
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">related_cells</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">into_iter</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">index</span><span class="o">|</span><span class="w"> </span><span class="n">board</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Note that I am using <code>0</code> to represent empty cells.</p>
<p>But if the user ignores the conflicting cells and adds a number to the board,
there will be more conflicting cells than the ones related to the target cell.
This can be done with another helper function.</p>
<p>Here&rsquo;s the code, and I took the liberty of adding the docstrings (the <code>///</code> comments that renders as documentation):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="sd">/// Get all the conflictings cells for all filled cells in a Sudoku board
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ## Parameters
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// - `current_sudoku: SudokuState` - A reference to the current [`SudokuState`]
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ## Returns
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// Returns a `Vec&lt;u8&gt;` representing all cell&#39;s indices that are conflicting
</span></span></span><span class="line"><span class="cl"><span class="sd">/// with the current Sudoku board.
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">get_all_conflicting_cells</span><span class="p">(</span><span class="n">current_sudoku</span>: <span class="kp">&amp;</span><span class="nc">SudokuState</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">filled</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_sudoku</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">enumerate</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">filter_map</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">value</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kt">u8</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">idx</span><span class="p">).</span><span class="n">ok</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nb">None</span><span class="w"> </span><span class="c1">// Filter out the item if the value is 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Get all conflicting cells for the filled cells
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">conflicting</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filled</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">flat_map</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">v</span><span class="o">|</span><span class="w"> </span><span class="n">get_conflicting_cells</span><span class="p">(</span><span class="n">current_sudoku</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">.</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;&gt;</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Retain unique
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="n">conflicting</span><span class="p">.</span><span class="n">sort_unstable</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">conflicting</span><span class="p">.</span><span class="n">dedup</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">conflicting</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>The trick here is that we are using a <code>flat_map</code> since a naive <code>map</code> would return a nested <code>Vec&lt;Vec&lt;Vec&lt;...&gt;&gt;&gt;</code>
of <code>u8</code>s, and we don&rsquo;t want that.
We want a flat <code>Vec&lt;u8&gt;</code> of all conflicting cells.
Recursion is always tricky, go ask Alan Turing.</p>
<h2 id="sudoku-app-state">Sudoku App State</h2>
<p>As you can see, I used a <code>SudokuState</code> type to represent the state of the game.
This is just a type alias for a <code>[u8; 81]</code> array.
This is a very simple and efficient way to represent the state of the game.</p>
<p>Here&rsquo;s the code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="k">pub</span><span class="w"> </span><span class="k">type</span> <span class="nc">SudokuState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="mi">81</span><span class="p">];</span><span class="w">
</span></span></span></code></pre></div><p>The Sudoku app has also an undo button.
This is implemented by using a <code>Vec&lt;SudokuState&gt;</code> to store the history of the game.
Every time that the user adds a number to the board, the new update state is pushed to the history vector.
When the user clicks the undo button, the last state is popped from the history vector and the board is updated.</p>
<p>There&rsquo;s one additional problem with the undo button.
It needs to switch the clicked cell to the one that was clicked before.
Yet another simple, but fun, task.
First you need to find the index at which two given <code>SudokuState</code>, the current and the last,
differ by exactly one item.</p>
<p>Again I&rsquo;ll add the docstrings since they incorporate some good practices that are worth mentioning:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="sd">/// Finds the index at which two given [`SudokuState`]
</span></span></span><span class="line"><span class="cl"><span class="sd">/// differ by exactly one item.
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// This function iterates over both arrays in lockstep and checks for a
</span></span></span><span class="line"><span class="cl"><span class="sd">/// pair of elements that are not equal.
</span></span></span><span class="line"><span class="cl"><span class="sd">/// It assumes that there is exactly one such pair and returns its index.
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ## Parameters
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// * `previous: SudokuState` - A reference to the first [`SudokuState`] to compare.
</span></span></span><span class="line"><span class="cl"><span class="sd">/// * `current: SudokuState` - A reference to the second [`SudokuState`] to compare.
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ## Returns
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// Returns `Some(usize)` with the index of the differing element if found,
</span></span></span><span class="line"><span class="cl"><span class="sd">/// otherwise returns `None` if the arrays are identical (which should not
</span></span></span><span class="line"><span class="cl"><span class="sd">/// happen given the problem constraints).
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ## Panics
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// The function will panic if cannot convert any of the Sudoku&#39;s board cells
</span></span></span><span class="line"><span class="cl"><span class="sd">/// indexes from `usize` into a `u8`
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ## Examples
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ```
</span></span></span><span class="line"><span class="cl"><span class="sd">/// let old_board: SudokuState = [0; 81];
</span></span></span><span class="line"><span class="cl"><span class="sd">/// let mut new_boad: SudokuState = [0; 81];
</span></span></span><span class="line"><span class="cl"><span class="sd">/// new_board[42] = 1; // Introduce a change
</span></span></span><span class="line"><span class="cl"><span class="sd">///
</span></span></span><span class="line"><span class="cl"><span class="sd">/// let index = find_changed_cell(&amp;old_board, &amp;new_board);
</span></span></span><span class="line"><span class="cl"><span class="sd">/// assert_eq!(index, Some(42));
</span></span></span><span class="line"><span class="cl"><span class="sd">/// ```
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">find_changed_cell</span><span class="p">(</span><span class="n">previous</span>: <span class="kp">&amp;</span><span class="nc">SudokuState</span><span class="p">,</span><span class="w"> </span><span class="n">current</span>: <span class="kp">&amp;</span><span class="nc">SudokuState</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">cell1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">cell2</span><span class="p">))</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">previous</span><span class="p">.</span><span class="n">iter</span><span class="p">().</span><span class="n">zip</span><span class="p">(</span><span class="n">current</span><span class="p">.</span><span class="n">iter</span><span class="p">()).</span><span class="n">enumerate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">cell1</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cell2</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="kt">u8</span>::<span class="n">try_from</span><span class="p">(</span><span class="n">index</span><span class="p">).</span><span class="n">expect</span><span class="p">(</span><span class="s">&#34;cannot convert from u8&#34;</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">None</span><span class="w"> </span><span class="c1">// Return None if no change is found (which should not happen in your case)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>The function <code>find_changed_cell</code> can panic if it cannot convert any of the Sudoku&rsquo;s board cells indexes from <code>usize</code> into a <code>u8</code>.
Hence, we add a <code>## Panics</code> section to the docstring to inform the user of this possibility.
Additionally, we add an <code>## Examples</code> section to show how to use the function.
These are good practices that are worth mentioning<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> and I highly encourage you to use them in your Rust code.</p>
<h2 id="tests">Tests</h2>
<p>Another advantage of using Rust is that you can write tests for your code
without needing to use a third-party library.
It is baked into the language and you can run your tests with <code>cargo test</code>.</p>
<p>Here&rsquo;s an example of a test for the <code>get_conflicting_cells</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[test]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">test_conflicts_multiple</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">board</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 1 with conflict
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 2 with conflict
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 7
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">            </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// Row 9 with conflict
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">get_conflicting_cells</span><span class="p">(</span><span class="o">&amp;</span><span class="n">board</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">72</span><span class="p">]);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>And also two tests for the <code>find_changed_cell</code> function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="cp">#[test]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">test_find_changed_cell_single_difference</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">old_board</span>: <span class="nc">SudokuState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">81</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">new_board</span>: <span class="nc">SudokuState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">81</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">new_board</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Introduce a change
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">find_changed_cell</span><span class="p">(</span><span class="o">&amp;</span><span class="n">old_board</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">new_board</span><span class="p">),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="cp">#[test]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">fn</span> <span class="nf">test_find_changed_cell_no_difference</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">old_board</span>: <span class="nc">SudokuState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="mi">81</span><span class="p">];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// This should return None since there is no difference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">        </span><span class="fm">assert_eq!</span><span class="p">(</span><span class="n">find_changed_cell</span><span class="p">(</span><span class="o">&amp;</span><span class="n">old_board</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">old_board</span><span class="p">),</span><span class="w"> </span><span class="nb">None</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>I had a lot of fun building this game.
I gave my mother an amazing gift that she&rsquo;ll treasure forever.
Her smartphone has one less spyware now.
I deployed a fullstack web app with Rust that is fast, safe and efficient;
with the caveat that I didn&rsquo;t touched any &ldquo;YavaScript&rdquo; or complexes build tools.</p>
<p>I hope you enjoyed this post and that you&rsquo;ll give Rust a try in your next fullstack project.</p>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>According to <a href="https://en.wikipedia.org/wiki/Sudoku">Wikipedia</a>,
Sudoku is a logic-based, combinatorial number-placement puzzle.
The objective is to fill a 9×9 grid with digits so that each column, each row,
and each of the nine 3×3 subgrids that compose the grid contain all of the digits from 1 to 9.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>in my case I am sending the bill to Bill Gates,
since it is using the GitHub Pages to host the app.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>The <code>clippy</code> linter can warn you if you don&rsquo;t add these sections to your docstrings.
Just add <code>pedantic = &quot;deny&quot;</code> inside your <code>Cargo.toml</code> file in the <code>[lints.clippy]</code> section and you&rsquo;re good to go.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content>
      </entry>
      <entry>
        <title>htmx: an Oasis in a Desert of Soy</title>
        <link rel="alternate" href="https://storopoli.io/2024-01-14-htmx/" />
        <id>https://storopoli.io/2024-01-14-htmx/</id>
        <published>2024-01-14T06:13:19-03:00</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">Warning: This post has mermaid.js enabled, so if you want to view the rendered diagrams, you&amp;rsquo;ll have to unfortunately enable JavaScript.
I love to learn new things and I&amp;rsquo;m passionate about Stoic philosophy. So, when I acquired the domain stoicquotes.io1, I&amp;rsquo;ve decided to give htmx a try.
What is htmx? htmx is a small JavaScript library that allows you to enhance your HTML with attributes to perform AJAX (Asynchronous JavaScript and XML) without writing JavaScript2.</summary>
          <content type="html"><![CDATA[<blockquote>
<p>Warning: This post has <a href="https://mermaid.js.org"><code>mermaid.js</code></a> enabled,
so if you want to view the rendered diagrams,
you&rsquo;ll have to unfortunately enable JavaScript.</p>
</blockquote>
<p><img loading="lazy" src="bellcurve.png#center" alt="htmx bell curve"  />
</p>
<p>I love to learn new things and I&rsquo;m passionate about Stoic philosophy.
So, when I acquired the domain
<a href="https://stoicquotes.io"><code>stoicquotes.io</code></a><sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>,
I&rsquo;ve decided to give <a href="https://htmx.org"><code>htmx</code></a> a try.</p>
<h2 id="what-is-htmx">What is <code>htmx</code>?</h2>
<p><strong><code>htmx</code></strong> is a small JavaScript library that allows you to enhance your HTML with
attributes to perform AJAX (Asynchronous JavaScript and XML) without writing
JavaScript<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. It focuses on extending HTML by adding custom attributes
that describe how to perform common dynamic web page behaviors like partial page
updates, form submission, etc. <code>htmx</code> is designed to be easy to use, requiring
minimal JavaScript knowledge, so that you can add interactivity<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> to web pages
with just HTML.</p>
<p>Let&rsquo;s contrast this with the <a href="../2023-11-10-2023-11-13-soydev/">Soy stuff</a>
like the notorious React framework. <strong>React</strong>, on the other hand, is a JavaScript
library for building user interfaces, primarily through a component-based
architecture. It manages the creation of user interface elements, updates the UI
efficiently when data changes, and helps keep your UI in sync with the state of
your application. React requires a deeper knowledge of JavaScript and understanding
of its principles, such as components, state, and props.</p>
<p><strong>In simple terms:</strong></p>
<ul>
<li><strong><code>htmx</code></strong> enhances plain HTML by letting you add attributes for dynamic
behaviors, so you can make webpages interactive with no JavaScript coding;
you can think of it as boosting your HTML to do more.</li>
<li><strong>React</strong> is more like building a complex machine from customizable parts that
you program with JavaScript, giving you full control over how your application
looks and behaves but also requiring more from you in terms of code complexity
and architecture.</li>
</ul>
<p>Additionally, React can be slower and less performant than <code>htmx</code>.
This is due to <code>htmx</code> manipulating the actual
<a href="https://en.wikipedia.org/wiki/Document_Object_Model">DOM</a> itself,
while React updates objects in the Virtual DOM. Afterward, React compares the
new Virtual DOM with a pre-update version and calculates the
most efficient way to make these changes to the real DOM.
So React has to do this whole trip around diff&rsquo;ing all the time the Virtual DOM
against the actual DOM for <strong>every fucking change</strong>.</p>
<p>Finally, <code>htmx</code> receives pure HTML from the server.
React needs to the <strong>JSON busboy thing</strong>: the server sends JSON, React parses
JSON into JavaScript code, then it parses it again to HTML for the browser.</p>
<p>Here are some <a href="https://mermaid.js.org/"><code>mermaid.js</code></a> diagrams to illustrate
what is going on under the hood:</p>
<div class="mermaid" style="text-align: center">

---

title: htmx
---

flowchart LR
HTML --> DOM
</div>

<div class="mermaid" style="text-align: center">

---

title: React
---

flowchart LR
JSON --> JavaScript --> HTML --> VDOM[Virtual DOM] --> DOM
</div>

<p>A consequence of these different paradigms is that <code>htmx</code> don&rsquo;t care about
what the server sends back and will happily include in the DOM.
Hence, front-end and back-end are decoupled and less complex.
Whereas in Reactland, we need to have a tight synchronicity between front-end
and back-end. If the JSON that the server sends doesn&rsquo;t conform to the exact
specifications of the front-end, the application <del>becomes a dumpster fire</del>
breaks.</p>
<h2 id="hypermedia">Hypermedia</h2>
<p>When the web was created it was based on the concept of
<a href="https://en.wikipedia.org/wiki/Hypermedia"><strong>Hypermedia</strong></a>.
Hypermedia refers to a system of interconnected multimedia elements, which can
include text, graphics, audio, video, and hyperlinks. It allows users to
navigate between related pieces of content across the web or within
applications, creating a non-linear way of accessing information.</p>
<p>HTML follows the Hypermedia protocol. HTML is the native language of browsers<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.
That&rsquo;s why all the React-like frameworks have to convert JavaScript into HTML.
So it&rsquo;s only natural to rely primarily on HTML to deliver content and sprinkle
JavaScript sparingly when you need something that HTML cannot offer.</p>
<p>Unfortunately, HTML has stopped in time. Despite all the richness of
<a href="https://en.wikipedia.org/wiki/HTTP">HTTP</a> with the diverse request methods:
<code>GET</code>, <code>HEAD</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>CONNECT</code>, <code>OPTIONS</code>, <code>TRACE</code>, <code>PATCH</code>;
HTML only has <em>two</em> elements that interact with the server:</p>
<ul>
<li><code>&lt;a&gt;</code>: sends a <code>GET</code> request to fetch new data.</li>
<li><code>&lt;form&gt;</code>: sends a <code>POST</code> request to create new data.</li>
</ul>
<p>That&rsquo;s the main purpose of <code>htmx</code>: allowing HTML elements to leverage all the
capabilities of HTTP.</p>
<h2 id="htmx-in-practice"><code>htmx</code> in Practice</h2>
<p>OK, enough of abstract and theoretical concepts. Let&rsquo;s see how <code>htmx</code> works in
practice.</p>
<p>First, the only thing you need to do enable <code>htmx</code> is to insert this <code>&lt;script&gt;</code>
tag in your HTML:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://unpkg.com/htmx.org@{version}&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>where <code>{version}</code> is the desired <code>htmx</code> version that you&rsquo;ll want to use.
I has around 40kb of size.</p>
<p>Inside the code behind <a href="https://stoicquotes.io"><code>stoicquotes.io</code></a><sup id="fnref1:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>,
we have the following HTML<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">blockquote</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;quote&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        Some nice Stoic quote...
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">blockquote</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">button</span> <span class="na">hx-get</span><span class="o">=</span><span class="s">&#34;/quote&#34;</span> <span class="na">hx-trigger</span><span class="o">=</span><span class="s">&#34;click&#34;</span> <span class="na">hx-target</span><span class="o">=</span><span class="s">&#34;#quote&#34;</span> <span class="na">hx-swap</span><span class="o">=</span><span class="s">&#34;outerHTML&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    New
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>When the user clicks (<code>hx-trigger</code>) in the &ldquo;New&rdquo; button, <code>htmx</code> sends a <code>GET</code>
request to the <code>/quote</code> endpoint (<code>hx-get</code>). Then it swaps the whole HTML
(<code>hx-swap</code>) of the element that has id &ldquo;quote&rdquo; (<code>hx-target</code>).
This is accomplished without a single character of JavaScript.
Instead we extend HTML by adding new attributes to the HTML elements:</p>
<ul>
<li><code>hx-get</code></li>
<li><code>hx-trigger</code></li>
<li><code>hx-target</code></li>
<li><code>hx-swap</code></li>
</ul>
<p>The server replies with a new <code>&lt;blockquote&gt;</code> element every time it gets a <code>GET</code>
request in the <code>/quote</code> endpoint.</p>
<p>This is truly amazing. We just used one line of <code>htmx</code>.</p>
<p><img loading="lazy" src="4-lines.png#center" alt="htmx 4 lines"  />
</p>
<p><code>htmx</code> adheres to my trifecta of amazing tools<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>:</p>
<ul>
<li>powerful</li>
<li>expressive</li>
<li>concise</li>
</ul>
<p>Here&rsquo;s a breakdown of what the trifecta of amazing tools means:</p>
<ol>
<li>
<p><strong>Powerful:</strong>
A powerful tool has the capability to handle complex, demanding tasks with
relative ease. It possesses the strength, performance, and features necessary to
accomplish a wide range of functions.</p>
</li>
<li>
<p><strong>Expressive:</strong>
An expressive tool gives users the ability to articulate complex ideas,
designs, or concepts with simplicity and nuance. It provides a rich set of
capabilities that allow for diverse and sophisticated forms of expression.</p>
</li>
<li>
<p><strong>Concise:</strong>
A concise tool allows for achieving goals with minimal effort or complexity.
It focuses on efficiency and effectiveness, often through simplification and the
removal of unnecessary components. It should be capable of performing tasks
without requiring verbose instructions or processes.</p>
</li>
</ol>
<h3 id="how-we-would-do-this-in-react">How we would do this in React?</h3>
<p>Now compare this with React.</p>
<p>First, we need to install React.
This is not simple, but here&rsquo;s a breakdown:</p>
<ol>
<li>
<p>install Node.js</p>
</li>
<li>
<p>install React: <code>npm install react react-dom</code></p>
</li>
<li>
<p>create an <code>index.js</code> file with some variant of:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createRoot</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react-dom/client&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&lt;div id=&#34;app&#34;&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">createRoot</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;app&#39;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">root</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="p">,</span> <span class="nx">world</span><span class="o">&lt;</span><span class="err">/h1&gt;);</span>
</span></span></code></pre></div></li>
</ol>
<p>And now here&rsquo;s the code for the <code>Quote</code> component:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useState</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Quote</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="p">[</span><span class="nx">quote</span><span class="p">,</span> <span class="nx">setQuote</span><span class="p">]</span> <span class="o">=</span> <span class="nx">useState</span><span class="p">(</span><span class="s1">&#39;Some nice Stoic quote...&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">fetchNewQuote</span> <span class="o">=</span> <span class="kr">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">response</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;/quote&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">newQuote</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">response</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setQuote</span><span class="p">(</span><span class="nx">newQuote</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error fetching new quote:&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">blockquote</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;quote&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="nx">quote</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">blockquote</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onClick</span><span class="o">=</span><span class="p">{</span><span class="nx">fetchNewQuote</span><span class="p">}&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">New</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">Quote</span><span class="p">;</span>
</span></span></code></pre></div><p>That&rsquo;s a LOT of JavaScript code.
The Soy Gods must be smiling upon you, my friend.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I highly recommend that you check out <a href="https://htmx.org"><code>htmx</code></a>,
especially the free <a href="https://htmx.org/#book">Hypermedia systems book</a> which
goes into details and it is way more comprehensive than this short blog post.</p>
<p><code>htmx</code> is a fresh and elegant approach to build simple reactive web pages.
It extends HTML to be able to use all of the capabilities of any JavaScript-based
reactive framework without a single drop of JavaScript.
You just add some new HTML attributes to your HTML elements.</p>
<p>I&rsquo;ve had such joy using <code>htmx</code> lately.
It made me go back into my early teens, when I was doing HTML pages in
<a href="https://en.wikipedia.org/wiki/GeoCities">GeoCities</a>.
Good times, no JavaScript-bloated code.</p>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>you can find the source code at
<a href="https://github.com/storopoli/stoic-quotes"><code>storopoli/stoic-quotes</code></a>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>YES, yes, no YavaScript. Hooray!&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><code>htmx</code> can do much more, such as lazy loading, infinite scroll,
or submitting forms without a full page reload, etc.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>actually we also have <a href="https://webassembly.org">WASM</a>.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>I&rsquo;ve simplified a bit removing some styling for the purpose of clarity.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>there are some other tools that I use that adhere to the trifecta.
Most notoriously is <a href="https://julialang.org">Julia</a> and
<a href="https://rust-lang.org">Rust</a>.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content>
      </entry>
      <entry>
        <title>Testing Bayesian Models with Nix and GitHub Actions</title>
        <link rel="alternate" href="https://storopoli.io/2023-12-04-bayesian_models_ci/" />
        <id>https://storopoli.io/2023-12-04-bayesian_models_ci/</id>
        <published>2023-12-04T17:43:03-03:00</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">I have an open access and open source1 graduate-level course on Bayesian statistics. It is available in GitHub through the repo storopoli/Bayesian-Statistics. I&amp;rsquo;ve taught it many times and every time was such a joy. It is composed of:
a set of 300+ slides2 covering the theoretical part Stan3 models Turing.jl4 models Now and then I receive emails from someone saying that the materials helped them to understand Bayesian statistics. These kind messages really make my day, and that&amp;rsquo;s why I strive to keep the content up-to-date and relevant.</summary>
          <content type="html"><![CDATA[<p><img loading="lazy" src="bayesian-models-go-brrrrr.png#center" alt="bayesian-models-go-brrrrr"  />
</p>
<p>I have an open access and open source<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> graduate-level course on Bayesian statistics.
It is available in GitHub through the repo <a href="https://github.com/storopoli/Bayesian-Statistics"><code>storopoli/Bayesian-Statistics</code></a>.
I&rsquo;ve taught it many times and every time was such a joy.
It is composed of:</p>
<ul>
<li>a set of 300+ slides<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> covering the theoretical part</li>
<li><a href="https://mc-stan.org">Stan</a><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> models</li>
<li><a href="https://turinglang.org">Turing.jl</a><sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> models</li>
</ul>
<p>Now and then I receive emails from someone saying that the materials helped
them to understand Bayesian statistics.
These kind messages really make my day, and that&rsquo;s why I strive to keep
the content up-to-date and relevant.</p>
<p>I decided to make the repository fully reproducible and testable in CI<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> using
<a href="https://nixos.org">Nix</a>
and <a href="https://docs.github.com/en/actions">GitHub actions</a>.</p>
<p>Here&rsquo;s what I am testing on every new change to the main repository
and every new pull request (PR):</p>
<ol>
<li><strong>slides in LaTeX</strong> are built and released as PDF in CI</li>
<li><strong>typos</strong> in content and code are tested</li>
<li><strong>Turing.jl models</strong> are run and tested in CI using the latest version of Julia,
Turing.jl and dependencies</li>
<li><strong>Stan models</strong> are run and test in CI using the latest version of Stan</li>
</ol>
<h2 id="nix">Nix</h2>
<p>All of these tests demand a highly reproducible and intricate development
environment.
That&rsquo;s where <a href="https://nixos.org">Nix</a> comes in.
Nix can be viewed as a package manager, operating system, build tool,
immutable system, and many things.</p>
<p>Nix is purely functional.
Everything is described as an expression/function,
taking some inputs and producing deterministic outputs.
This guarantees reproducible results and makes caching everything easy.
Nix expressions are lazy. Anything described in Nix code will only be executed
if some other expression needs its results.
This is very powerful but somewhat unnatural for developers not familiar
with functional programming.</p>
<p>I enjoy Nix so much that I use it as the operating system and package manager in
all of my computers.
Feel free to check my setup at
<a href="https://github.com/storopoli/flakes"><code>storopoli/flakes</code></a>.</p>
<p>The main essence of the repository setup is the
<a href="https://github.com/storopoli/Bayesian-Statistics/blob/main/flake.nix"><code>flake.nix</code> file</a>.
A Flake is a collection of recipes (Nix derivations) that the repository
provides.
From the <a href="https://nixos.wiki/wiki/Flakes">NixOS Wiki article on Flakes</a>:</p>
<blockquote>
<p>Flakes is a feature of managing Nix packages to simplify usability and improve
reproducibility of Nix installations.
Flakes manages dependencies between Nix expressions,
which are the primary protocols for specifying packages.
Flakes implements these protocols in a consistent schema with a common set
of policies for managing packages.</p>
</blockquote>
<p>I use the Nix&rsquo;s Flakes to not only setup the main repository package,
defined in the Flake as just <code>package.default</code>
which is the PDF build of the LaTeX slides,
but also to setup the development environment,
defined in the Flake as the <code>devShell.default</code>,
to run the latest versions of
Stan and Julia/Turing.jl.</p>
<p>We&rsquo;ll go over the Flake file in detail.
However, let me show the full Flake file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;A basic flake with a shell&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">inputs</span><span class="o">.</span><span class="n">nixpkgs</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;github:NixOS/nixpkgs/nixpkgs-unstable&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">inputs</span><span class="o">.</span><span class="n">flake-utils</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;github:numtide/flake-utils&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">inputs</span><span class="o">.</span><span class="n">pre-commit-hooks</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;github:cachix/pre-commit-hooks.nix&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">outputs</span> <span class="o">=</span> <span class="p">{</span> <span class="n">self</span><span class="o">,</span> <span class="n">nixpkgs</span><span class="o">,</span> <span class="n">flake-utils</span><span class="o">,</span> <span class="n">pre-commit-hooks</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">    <span class="n">flake-utils</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">eachDefaultSystem</span> <span class="p">(</span><span class="n">system</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">let</span>
</span></span><span class="line"><span class="cl">        <span class="n">pkgs</span> <span class="o">=</span> <span class="n">nixpkgs</span><span class="o">.</span><span class="n">legacyPackages</span><span class="o">.</span><span class="si">${</span><span class="n">system</span><span class="si">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">tex</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="o">.</span><span class="n">combine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">scheme-small</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">latexmk</span> <span class="n">pgf</span> <span class="n">pgfplots</span> <span class="n">tikzsymbols</span> <span class="n">biblatex</span> <span class="n">beamer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">silence</span> <span class="n">appendixnumberbeamer</span> <span class="n">fira</span> <span class="n">fontaxes</span> <span class="n">mwe</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">noto</span> <span class="n">csquotes</span> <span class="n">babel</span> <span class="n">helvetic</span> <span class="n">transparent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">xpatch</span> <span class="n">hyphenat</span> <span class="n">wasysym</span> <span class="n">algorithm2e</span> <span class="n">listings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">lstbayes</span> <span class="n">ulem</span> <span class="n">subfigure</span> <span class="n">ifoddpage</span> <span class="n">relsize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">adjustbox</span> <span class="n">media9</span> <span class="n">ocgx2</span> <span class="n">biblatex-apa</span> <span class="n">wasy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="n">julia</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">julia-bin</span><span class="o">.</span><span class="n">overrideDerivation</span> <span class="p">(</span><span class="n">oldAttrs</span><span class="p">:</span> <span class="p">{</span> <span class="n">doInstallCheck</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">in</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">checks</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">pre-commit-check</span> <span class="o">=</span> <span class="n">pre-commit-hooks</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="si">${</span><span class="n">system</span><span class="si">}</span><span class="o">.</span><span class="n">run</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">src</span> <span class="o">=</span> <span class="sr">./.</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">hooks</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">typos</span><span class="o">.</span><span class="n">enable</span> <span class="o">=</span> <span class="no">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">};</span>
</span></span><span class="line"><span class="cl">          <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">devShells</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">mkShell</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">packages</span> <span class="o">=</span> <span class="k">with</span> <span class="n">pkgs</span><span class="p">;[</span>
</span></span><span class="line"><span class="cl">            <span class="n">bashInteractive</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># pdfpc # FIXME: broken on darwin</span>
</span></span><span class="line"><span class="cl">            <span class="n">typos</span>
</span></span><span class="line"><span class="cl">            <span class="n">cmdstan</span>
</span></span><span class="line"><span class="cl">            <span class="n">julia</span>
</span></span><span class="line"><span class="cl">          <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="n">shellHook</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">            export JULIA_NUM_THREADS=&#34;auto&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">            export JULIA_PROJECT=&#34;turing&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">            export CMDSTAN_HOME=&#34;</span><span class="si">${</span><span class="n">pkgs</span><span class="o">.</span><span class="n">cmdstan</span><span class="si">}</span><span class="s1">/opt/cmdstan&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">            </span><span class="si">${</span><span class="n">self</span><span class="o">.</span><span class="n">checks</span><span class="o">.</span><span class="si">${</span><span class="n">system</span><span class="si">}</span><span class="o">.</span><span class="n">pre-commit-check</span><span class="o">.</span><span class="n">shellHook</span><span class="si">}</span><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">          &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="n">packages</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">stdenvNoCC</span><span class="o">.</span><span class="n">mkDerivation</span> <span class="k">rec</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;slides&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">src</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">buildInputs</span> <span class="o">=</span> <span class="k">with</span> <span class="n">pkgs</span><span class="p">;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">coreutils</span>
</span></span><span class="line"><span class="cl">            <span class="n">tex</span>
</span></span><span class="line"><span class="cl">            <span class="n">gnuplot</span>
</span></span><span class="line"><span class="cl">            <span class="n">biber</span>
</span></span><span class="line"><span class="cl">          <span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;unpackPhase&#34;</span> <span class="s2">&#34;buildPhase&#34;</span> <span class="s2">&#34;installPhase&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">          <span class="n">buildPhase</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">            export PATH=&#34;</span><span class="si">${</span><span class="n">pkgs</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">makeBinPath</span> <span class="n">buildInputs</span><span class="si">}</span><span class="s1">&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s1">            cd slides
</span></span></span><span class="line"><span class="cl"><span class="s1">            export HOME=$(pwd)
</span></span></span><span class="line"><span class="cl"><span class="s1">            latexmk -pdflatex -shell-escape slides.tex
</span></span></span><span class="line"><span class="cl"><span class="s1">          &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="n">installPhase</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">            mkdir -p $out
</span></span></span><span class="line"><span class="cl"><span class="s1">            cp slides.pdf $out/
</span></span></span><span class="line"><span class="cl"><span class="s1">          &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>A flake is composed primarily of <code>inputs</code> and <code>outputs</code>.
As <code>inputs</code> I have:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="n">inputs</span><span class="o">.</span><span class="n">nixpkgs</span><span class="o">.</span><span class="n">url</span> <span class="err">=</span> <span class="s2">&#34;github:NixOS/nixpkgs/nixpkgs-unstable&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span><span class="o">.</span><span class="n">flake-utils</span><span class="o">.</span><span class="n">url</span> <span class="err">=</span> <span class="s2">&#34;github:numtide/flake-utils&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">inputs</span><span class="o">.</span><span class="n">pre-commit-hooks</span><span class="o">.</span><span class="n">url</span> <span class="err">=</span> <span class="s2">&#34;github:cachix/pre-commit-hooks.nix&#34;</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li><a href="https://github.com/NixOS/nixpkgs"><strong><code>nixpkgs</code></strong></a>
is responsible for providing all of the packages necessary for both
<code>package.default</code> and <code>devShell.default</code>: <code>cmdstan</code>, <code>julia-bin</code>, <code>typos</code>,
and a bunch of <code>texlive</code> LaTeX small packages.</li>
<li><a href="https://github.com/numtide/flake-utils"><strong><code>flake-utils</code></strong></a>
are a bunch of Nix utility functions that creates tons of
syntactic sugar to make the Flake easily accessible in all platforms,
such as macOS and Linux.</li>
<li><a href="https://github.com/cachix/pre-commit-hooks.nix"><strong><code>pre-commit-hooks</code></strong></a>
is a nice Nix utility to create easy
<a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks">git hooks</a>
that do some checking at several steps of the git workflow.
The only hook that I am using is the <a href="https://github.com/crate-ci/typos"><code>typos</code></a>
pre-commit hook that checks the whole commit changes for common typos and won&rsquo;t
let you commit successfully if you have typos:
either correct or whitelist them in the <code>_typos.toml</code> file.</li>
</ul>
<p>The <code>outputs</code> are the bulk of the Flake file and it is a Nix function that
takes all the above as inputs and outputs a couple of things:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="n">outputs</span> <span class="err">=</span> <span class="p">{</span> <span class="n">self</span><span class="o">,</span> <span class="n">nixpkgs</span><span class="o">,</span> <span class="n">flake-utils</span><span class="o">,</span> <span class="n">pre-commit-hooks</span> <span class="p">}:</span>
</span></span><span class="line"><span class="cl">    <span class="n">flake-utils</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">eachDefaultSystem</span> <span class="p">(</span><span class="n">system</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">checks</span> <span class="o">=</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">      <span class="n">devShells</span> <span class="o">=</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">      <span class="n">packages</span> <span class="o">=</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl">   <span class="p">});</span>
</span></span></code></pre></div><ul>
<li><code>checks</code> things that are executed/built when you run <code>nix flake check</code></li>
<li><code>devShells</code> things that are executed/built when you run <code>nix develop</code></li>
<li><code>packages</code> things that are executed/built when you run <code>nix build</code></li>
</ul>
<p>Let&rsquo;s go over each one of the outputs that the repository Flake has.</p>
<h3 id="packages----latex-slides"><code>packages</code> &ndash; LaTeX slides</h3>
<p>We all know that LaTeX is a pain to make it work.
If it builds in my machine definitely won&rsquo;t build in yours.
This is solved effortlessly in Nix.
Take a look at the <code>tex</code> variable definition in the <code>let ... in</code> block:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="k">let</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">  <span class="n">tex</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="o">.</span><span class="n">combine</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">scheme-small</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">latexmk</span> <span class="n">pgf</span> <span class="n">pgfplots</span> <span class="n">tikzsymbols</span> <span class="n">biblatex</span> <span class="n">beamer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">silence</span> <span class="n">appendixnumberbeamer</span> <span class="n">fira</span> <span class="n">fontaxes</span> <span class="n">mwe</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">noto</span> <span class="n">csquotes</span> <span class="n">babel</span> <span class="n">helvetic</span> <span class="n">transparent</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">xpatch</span> <span class="n">hyphenat</span> <span class="n">wasysym</span> <span class="n">algorithm2e</span> <span class="n">listings</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">lstbayes</span> <span class="n">ulem</span> <span class="n">subfigure</span> <span class="n">ifoddpage</span> <span class="n">relsize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">inherit</span> <span class="p">(</span><span class="n">pkgs</span><span class="o">.</span><span class="n">texlive</span><span class="p">)</span> <span class="n">adjustbox</span> <span class="n">media9</span> <span class="n">ocgx2</span> <span class="n">biblatex-apa</span> <span class="n">wasy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="k">in</span>
</span></span></code></pre></div><p><code>tex</code> is a custom instantiation of the <code>texlive.combine</code> derivation with some
overrides to specify which CTAN packages you need to build the slides.
We use <code>tex</code> in the <code>packages.default</code> Flake <code>output</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="n">packages</span><span class="o">.</span><span class="n">default</span> <span class="err">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">stdenvNoCC</span><span class="o">.</span><span class="n">mkDerivation</span> <span class="k">rec</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;slides&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">src</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">buildInputs</span> <span class="o">=</span> <span class="k">with</span> <span class="n">pkgs</span><span class="p">;</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">coreutils</span>
</span></span><span class="line"><span class="cl">    <span class="n">tex</span>
</span></span><span class="line"><span class="cl">    <span class="n">gnuplot</span>
</span></span><span class="line"><span class="cl">    <span class="n">biber</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">phases</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&#34;unpackPhase&#34;</span> <span class="s2">&#34;buildPhase&#34;</span> <span class="s2">&#34;installPhase&#34;</span> <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="n">buildPhase</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    export PATH=&#34;</span><span class="si">${</span><span class="n">pkgs</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">makeBinPath</span> <span class="n">buildInputs</span><span class="si">}</span><span class="s1">&#34;;
</span></span></span><span class="line"><span class="cl"><span class="s1">    cd slides
</span></span></span><span class="line"><span class="cl"><span class="s1">    export HOME=$(pwd)
</span></span></span><span class="line"><span class="cl"><span class="s1">    latexmk -pdflatex -shell-escape slides.tex
</span></span></span><span class="line"><span class="cl"><span class="s1">  &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">installPhase</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    mkdir -p $out
</span></span></span><span class="line"><span class="cl"><span class="s1">    cp slides.pdf $out/
</span></span></span><span class="line"><span class="cl"><span class="s1">  &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Here we are declaring a Nix derivation with the <code>stdenvNoCC.mkDerivation</code>,
the <code>NoCC</code> part means that we don&rsquo;t need C/C++ build tools.
The <code>src</code> is the Flake repository itself and I also specify the dependencies
in <code>buildInputs</code>: I still need some fancy stuff to build my slides.
Finally, I specify the several <code>phases</code> of the derivation.
The most important part is that I <code>cd</code> into the <code>slides/</code> directory
and run <code>latexmk</code> in it, and copy the resulting PDF to the <code>$out</code> Nix
special directory which serves as the output directory for the derivation.</p>
<p>This is really nice because anyone with Nix installed can run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nix build github:storopoli/Bayesian-Statistics
</span></span></code></pre></div><p>and bingo! You have my slides as PDF built from LaTeX files without having to
clone or download the repository.
Fully reproducible in any machine or architecture.</p>
<p>The next step is to configure GitHub actions to run Nix and build the slides'
PDF file in CI.
I have two workflows for that and they are almost identical except for the
last step.
The first one is the
<a href="https://github.com/storopoli/Bayesian-Statistics/blob/main/.github/workflows/build-slides.yml"><code>build-slides.yml</code></a>,
which, of course, builds the slides.
These are the relevant parts:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Slides</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout repository</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Install Nix</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">DeterminateSystems/nix-installer-action@v8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Slides</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">nix build -L</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Copy result out of nix store</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">cp -v result/slides.pdf slides.pdf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Upload Artifacts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/upload-artifact@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">output</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">./slides.pdf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">if-no-files-found</span><span class="p">:</span><span class="w"> </span><span class="l">error</span><span class="w">
</span></span></span></code></pre></div><p>Here we use a set of actions to:</p>
<ol>
<li>install Nix</li>
<li>build the slides&rsquo; PDF file using <code>nix build</code>
(the <code>-L</code> flag is to have more verbose logs)</li>
<li>upload the built slides&rsquo; PDF file as an artifact of the CI run.
This is useful for inspection and debugging.
There is also the caveat that if the PDF file is not found the whole workflow
should error.</li>
</ol>
<p>The last one is the
<a href="https://github.com/storopoli/Bayesian-Statistics/blob/main/.github/workflows/release-slides.yml"><code>release-slides.yml</code></a>,
which releases the slides when I publish a new tag.
It is almost the same as <code>build-slides.yml</code>, thus I will only highlight the
relevant bits:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">tags</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">ncipollo/release-action@v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">release</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">artifacts</span><span class="p">:</span><span class="w"> </span><span class="l">./slides.pdf</span><span class="w">
</span></span></span></code></pre></div><p>The only change is the final step that we now use a <code>release-action</code>
that automatically publishes a release with the slides&rsquo; PDF file as one of the
release artifacts.
This is good since, once I achieve a milestone in the slides,
I can easily tag a new version and have GitHub automatically publish a new
release with the resulting PDF file attached in the release.</p>
<p>This is a very good workflow, both in GitHub but also locally.
I don&rsquo;t need to install tons of gigabytes of texlive stuff to build my slides
locally.
I just run <code>nix build</code>.
Also, if someones contributes to the slides I don&rsquo;t need to check the correctness
of the LaTeX code, only the content and the output PDF artifact in the
resulting CI from the PR.
If it&rsquo;s all good, just thank the blessed soul and merge it!</p>
<h3 id="turingjl-models">Turing.jl Models</h3>
<p>The repository has a directory called <code>turing/</code> which is a Julia project with
<code>.jl</code> files and a <code>Project.toml</code> that lists the Julia dependencies and
appropriate <code>compat</code> bounds.
In order to test the Turing.jl models in the Julia files,
I have the following things in the Nix Flake <code>devShell</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="k">let</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">  <span class="n">julia</span> <span class="o">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">julia-bin</span><span class="o">.</span><span class="n">overrideDerivation</span> <span class="p">(</span><span class="n">oldAttrs</span><span class="p">:</span> <span class="p">{</span> <span class="n">doInstallCheck</span> <span class="o">=</span> <span class="no">false</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="k">in</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="n">devShells</span><span class="o">.</span><span class="n">default</span> <span class="err">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">mkShell</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">packages</span> <span class="o">=</span> <span class="k">with</span> <span class="n">pkgs</span><span class="p">;[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">    <span class="n">julia</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">shellHook</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="s1">    export JULIA_NUM_THREADS=&#34;auto&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    export JULIA_PROJECT=&#34;turing&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="s1">  &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Nix <code>devShell</code> lets you create a development environment by adding a
transparent layer on top of your standard shell environment with additional
packages, hooks, and environment variables.
First, in the <code>let ... in</code> block, I am defining a variable called <code>julia</code>
that is the <code>julia-bin</code> package with an attribute <code>doInstallCheck</code>
being overridden to <code>false</code>.
I don&rsquo;t want the Nix derivation of the <code>mkShell</code> to run all Julia standard tests.
Next, I define some environment variables in the <code>shellHook</code>,
which, as the name implies, runs every time that I instantiate the default
<code>devShell</code> with <code>nix develop</code>.</p>
<p>With the Nix Flake part covered, let&rsquo;s check how we wrap everything in a
GitHub action workflow file named
<a href="https://github.com/storopoli/Bayesian-Statistics/blob/main/.github/workflows/models.yml"><code>models.yml</code></a>.
Again, I will only highlight the relevant parts for the Turing.jl model testing
CI job:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">test-turing</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Test Turing Models</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">matrix</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">jl-file</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s2">&#34;01-predictive_checks.jl&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="s2">&#34;13-model_comparison-roaches.jl&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Test ${{ matrix.jl-file }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          nix develop -L . --command bash -c &#34;julia -e &#39;using Pkg; Pkg.instantiate()&#39;&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          nix develop -L . --command bash -c &#34;julia turing/${{ matrix.jl-file }}&#34;</span><span class="w">          
</span></span></span></code></pre></div><p>I list all the Turing.jl model Julia files in a <code>matrix.jl-file</code> list
to
<a href="https://docs.github.com/actions/using-jobs/using-a-matrix-for-your-jobs">define variations for each job</a>.
Next, we install the latest Julia version.
Finally, we run everything in parallel using the YAML string interpolation
<code>${{ matrix.jl-file }}</code>.
This expands the expression into <code>N</code> parallel jobs,
where <code>N</code> is the <code>jl-file</code> list length.</p>
<p>If any of these parallel jobs error out, then the whole workflow will error.
Hence, we are always certain that the models are up-to-date with the latest Julia
version in <code>nixpkgs</code>, and the latest Turing.jl dependencies.</p>
<h3 id="stan-models">Stan Models</h3>
<p>The repository has a directory called <code>stan/</code> that holds a bunch of Stan models
in <code>.stan</code> files.
These models can be used with any Stan interface,
such as
<a href="https://mc-stan.org/rstan"><code>RStan</code></a>/<a href="https://mc-stan.org/cmdstanr"><code>CmdStanR</code></a>,
<a href="https://pystan.readthedocs.org/en/latest/"><code>PyStan</code></a>/<a href="https://mc-stan.org/cmdstanpy"><code>CmdStanPy</code></a>,
or <a href="https://github.com/goedman/Stan.jl"><code>Stan.jl</code></a>.
However I am using <a href="https://mc-stan.org/docs/cmdstan-guide/index.html"><code>CmdStan</code></a>
which only needs a shell environment and Stan, no additional dependencies
like Python, R, or Julia.
Additionally, <code>nixpkgs</code> has a
<a href="https://search.nixos.org/packages?query=cmdstan"><code>cmdstan</code></a>
package that is well-maintained and up-to-date with the latest Stan release.</p>
<p>In order to test the Stan models,
I have the following setup in the Nix Flake <code>devShell</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="n">devShells</span><span class="o">.</span><span class="n">default</span> <span class="err">=</span> <span class="n">pkgs</span><span class="o">.</span><span class="n">mkShell</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">packages</span> <span class="o">=</span> <span class="k">with</span> <span class="n">pkgs</span><span class="p">;[</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">    <span class="n">cmdstan</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">shellHook</span> <span class="o">=</span> <span class="s1">&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="s1">    export CMDSTAN_HOME=&#34;</span><span class="si">${</span><span class="n">pkgs</span><span class="o">.</span><span class="n">cmdstan</span><span class="si">}</span><span class="s1">/opt/cmdstan&#34;
</span></span></span><span class="line"><span class="cl"><span class="s1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="s1">  &#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>Here I am also defining an environment variable in the <code>shellHook</code>,
<code>CMDSTAN_HOME</code> because that is useful for local development.</p>
<p>In the same GitHub action workflow
<a href="https://github.com/storopoli/Bayesian-Statistics/blob/main/.github/workflows/models.yml"><code>models.yml</code></a>
file is defined the Stan model testing CI job:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">test-stan</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Test Stan Models</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">matrix</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">stan</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;01-predictive_checks-posterior&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;coin_flip.data.json&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>{<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">model</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;13-model_comparison-zero_inflated-poisson&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">data</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;roaches.data.json&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>}<span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Test ${{ matrix.stan.model }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#34;Compiling: ${{ matrix.stan.model }}&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          nix develop -L . --command bash -c &#34;stan stan/${{ matrix.stan.model }}&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          nix develop -L . --command bash -c &#34;stan/${{ matrix.stan.model }} sample data file=stan/${{ matrix.stan.data }}&#34;</span><span class="w">          
</span></span></span></code></pre></div><p>Now I am using a YAML dictionary as the entry for every element in the <code>stan</code>
YAML list with two keys: <code>model</code> and <code>data</code>.
<code>model</code> lists the Stan model file without the <code>.stan</code> extension,
and <code>data</code> lists the JSON data file that the model needs to run.
We&rsquo;ll use both to run parallel jobs to test all the Stan models listed in the
<code>stan</code> list.
For that we use the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nix" data-lang="nix"><span class="line"><span class="cl"><span class="n">nix</span> <span class="n">develop</span> <span class="err">-</span><span class="n">L</span> <span class="o">.</span> <span class="err">--</span><span class="n">command</span> <span class="n">bash</span> <span class="err">-</span><span class="n">c</span> <span class="s2">&#34;stan stan/</span><span class="si">${</span><span class="p">{</span> <span class="n">matrix</span><span class="o">.</span><span class="n">stan</span><span class="o">.</span><span class="n">model</span> <span class="p">}</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">nix</span> <span class="n">develop</span> <span class="err">-</span><span class="n">L</span> <span class="o">.</span> <span class="err">--</span><span class="n">command</span> <span class="n">bash</span> <span class="err">-</span><span class="n">c</span> <span class="s2">&#34;stan/</span><span class="si">${</span><span class="p">{</span> <span class="n">matrix</span><span class="o">.</span><span class="n">stan</span><span class="o">.</span><span class="n">model</span> <span class="p">}</span><span class="si">}</span><span class="s2"> sample data file=stan/</span><span class="si">${</span><span class="p">{</span> <span class="n">matrix</span><span class="o">.</span><span class="n">stan</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>This instantiates the <code>devShell.default</code> shell environment,
and uses the <code>stan</code> binary provided by the <code>cmdstan</code> Nix package to compile the
model into an executable binary.
Next, we run this model executable binary in <code>sample</code> mode while also providing
the corresponding data file with <code>data file=</code>.</p>
<p>As before, if any of these parallel jobs error out, then the whole workflow will
error.
Hence, we are always certain that the models are up-to-date with the latest
Stan/CmdStan version in <code>nixpkgs</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>I am quite happy with this setup.
It makes easy to run test in CI with GitHub Actions,
while also being effortless to instantiate a development environment with Nix.
If I want to get a new computer up and running, I don&rsquo;t need to install a bunch
of packages and go over &ldquo;getting started&rdquo; instructions to have all the necessary
dependencies.</p>
<p>This setup also helps onboard new contributors since it is:</p>
<ol>
<li>easy to setup the dependencies necessary to develop and test</li>
<li>trivial to check if contributions won&rsquo;t break anything</li>
</ol>
<p>Speaking of &ldquo;contributors&rdquo;, if you are interested in Bayesian modeling,
feel free to go over the contents of the repository
<a href="https://github.com/storopoli/Bayesian-Statistics"><code>storopoli/Bayesian-Statistics</code></a>.
<strong>Contributions are most welcomed</strong>.
Don&rsquo;t hesitate on opening an issue or pull request.</p>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>the code is MIT-licensed and the content is CreativeCommons
Non-Commercial 4.0&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>I am also planning to go over the slides for every lecture
in a YouTube playlist in the near future.
This would make it the experience complete: slides, lectures, and code.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>a probabilistic programming language and suite of MCMC samplers written in C++.
It is today&rsquo;s gold standard in Bayesian stats.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>is an ecosystem of Julia packages for Bayesian inference using probabilistic
programming.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>CI stands for <strong>c</strong>ontinuous <strong>i</strong>ntegration,
sometimes also known as CI/CD, <strong>c</strong>ontinuous <strong>i</strong>ntegration and <strong>c</strong>ontinuous
<strong>d</strong>elivery.
<a href="https://en.wikipedia.org/wiki/CI/CD">CI/CD</a> is a wide &ldquo;umbrella&rdquo; term
for &ldquo;everything that is tested in all parts of the development cicle&rdquo;,
and these tests commonly take place in a cloud machine.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content>
      </entry>
      <entry>
        <title>Zero-cost Abstractions</title>
        <link rel="alternate" href="https://storopoli.io/2023-11-28-zero_cost_abstractions/" />
        <id>https://storopoli.io/2023-11-28-zero_cost_abstractions/</id>
        <published>2023-11-28T18:19:36-03:00</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">In programming language circles there&amp;rsquo;s a recently trend of discussing a concept called zero-cost abstractions: the ability to use higher-levels abstractions without suffering any loss of performance.
Zero-cost abstractions allows you to write performant code without having to give up a single drop of convenience and expressiveness:
You want for-loops? You can have it. Generics? Yeah, why not? Data structures? Sure, keep&amp;rsquo;em coming. Async operations? You bet ya! Multi-threading? Hell yes!</summary>
          <content type="html"><![CDATA[<p>In programming language circles there&rsquo;s a recently trend of discussing a concept
called <strong>zero-cost abstractions</strong>:
the ability to use higher-levels abstractions without suffering any loss of performance.</p>
<p>Zero-cost abstractions allows you to write performant code without having to
give up a single drop of convenience and expressiveness:</p>
<p>You want for-loops?
<em>You can have it</em>.
Generics?
<em>Yeah, why not</em>?
Data structures?
<em>Sure, keep&rsquo;em coming</em>.
Async operations?
<em>You bet ya</em>!
Multi-threading?
<em>Hell yes</em>!</p>
<p>To put more formally,
I like <a href="https://stackoverflow.com/a/69178445">this definition from StackOverflow</a>:</p>
<blockquote>
<p>Zero Cost Abstractions means adding higher-level programming concepts, like generics,
collections and so on do not come with a run-time cost,
only compile time cost (the code will be slower to compile).
Any operation on zero-cost abstractions is as fast as you would write out
matching functionality by hand using lower-level programming concepts like
for loops, counters, ifs and using raw pointers.</p>
</blockquote>
<p>Here&rsquo;s an analogy:</p>
<blockquote>
<p>Imagine that you are going to buy a car.
The sales person offers you a fancy car praising how easy it is to drive it,
that you don&rsquo;t need to think about RPM, clutch and stick shift,
parking maneuver, fuel type, and other shenanigans.
You just turn it on and drive.
However, once you take a look at the car&rsquo;s data sheet, you are horrified.
The car is bad in every aspect except easy of use.
It has dreadful fuel consumption,
atrocious safety ratings,
disastrous handling, and so on&hellip;</p>
</blockquote>
<p>Believe me, you wouldn&rsquo;t want to own that car.</p>
<p>Metaphors aside, that&rsquo;s <strong>exactly what professional developers<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> and whole teams
choose to use every day: unacceptable inferior tools</strong>.
Tools that, not only don&rsquo;t have <strong>zero-cost abstractions</strong>,
rather don&rsquo;t allow you to even have non-zero-cost anything!</p>
<p>Let&rsquo;s do some Python bashing in the meantime.
I know that&rsquo;s easy to bash Python,
but that&rsquo;s not the point.
If Python wasn&rsquo;t used so widely in production,
I would definitely leave it alone.
Don&rsquo;t get me wrong, Python is the second-best language for everything<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<h2 id="the-curious-case-of-the-python-boolean">The curious case of the Python boolean</h2>
<p><img loading="lazy" src="non-zero-cost-abstraction.png#center" alt="non-zero-cost-abstraction"  />
</p>
<p>I wish this meme was a joke, but it isn&rsquo;t.
A boolean is one of the simplest data type taking only two possible values:
true or false.
Just grab your nearest Python REPL:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">getsizeof</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">getsizeof</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">28</span>
</span></span></code></pre></div><p>The function <a href="https://docs.python.org/3/library/sys.html#sys.getsizeof"><code>sys.getsizeof</code></a>
returns the size of an object in bytes.
<strong>How the hell Python needs 28 bytes to represent something that needs at most 1 byte</strong><sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>?
Imagine incurring a 28x penalty in memory size requirements for every boolean
that you use.
Now multiply this by every operation that your code is going to run in production
over time.
Again: <strong>unacceptable</strong>.</p>
<p>That&rsquo;s because all objects in Python,
in the sense that everything that you can instantiate,
i.e. everything that you can put on the left hand-side of the <code>=</code> assignment,
is a <a href="https://docs.python.org/3/c-api/structures.html#c.PyObject"><code>PyObject</code></a>:</p>
<blockquote>
<p>All Python objects ultimately share a small number of fields at the
beginning of the object’s representation in memory.
These are represented by the <code>PyObject</code> and <code>PyVarObject</code> types.</p>
</blockquote>
<p>Python is dynamically-typed, which means that you don&rsquo;t have primitives like
8-, 16-, 32-bit (un)signed integers and so on.
Everything is a huge mess allocated in the heap that must carry not only its value,
but also information about its type.</p>
<p>Most important, everything that is fast in Python is <em>not Python-based</em>.
Take a look at the image below,
I grabbed some popular Python libraries from GitHub,
namely <a href="https://github.com/numpy/numpy">NumPy</a> (linear algebra package)
and <a href="https://github.com/pytorch/pytorch">PyToch</a> (deep learning package),
and checked the
language codebase percentage.</p>
<p><img loading="lazy" src="python-my-ass.jpg#center" alt="python-my-ass"  />
</p>
<p>Surprise, they are <strong><em>not</em> Python libraries</strong>.
They are <strong>C/C++ codebases</strong>.
Even if Python is the main language used in these codebases<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>,
I still think that this is not the case due to the nature of the Python code:
<strong>all docstrings are written in Python</strong>.
If you have a very fast C function in your codebase that takes 50 lines of code,
followed by a Python wrapper function that calls it using 10 lines of code,
<em>but</em> with a docstring that is 50 lines of code;
you have a &ldquo;Python&rdquo;-majority codebase.</p>
<p>In a sense the most efficient Python programmer is a C/C++ programmer&hellip;</p>
<p>Here&rsquo;s <a href="https://julialang.org">Julia</a>, which is also dynamically-typed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">Base</span><span class="o">.</span><span class="n">summarysize</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>
</span></span></code></pre></div><p>And to your surprise,
Julia is coded in &hellip;. Julia!
Check the image below for the language codebase percentage of
<a href="https://github.com/JuliaLang/julia">Julia</a>
and <a href="https://github.com/LuxDL/Lux.jl"><code>Lux.jl</code></a><sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> (deep learning package).</p>
<p><img loading="lazy" src="julia.jpg#center" alt="julia"  />
</p>
<p>Finally, here&rsquo;s <a href="https://rust-lang.org">Rust</a>, which is not dynamically-,
but static-typed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// main.rs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Size of bool: </span><span class="si">{}</span><span class="s"> byte&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cargo run --release
</span></span><span class="line"><span class="cl">   Compiling size_of_bool v0.1.0
</span></span><span class="line"><span class="cl">    Finished release <span class="o">[</span>optimized<span class="o">]</span> target<span class="o">(</span>s<span class="o">)</span> in 0.00s
</span></span><span class="line"><span class="cl">     Running <span class="sb">`</span>target/release/size_of_bool<span class="sb">`</span>
</span></span><span class="line"><span class="cl">Size of bool: <span class="m">1</span> byte
</span></span></code></pre></div><h2 id="more-zero-costs-abstractions">More zero-costs abstractions</h2>
<p>Let&rsquo;s cover two more zero-costs abstractions, both in Julia and in Rust:
<strong>for-loops</strong> and <strong>enums</strong>.</p>
<h3 id="for-loops">For-loops</h3>
<p>A friend and a Julia-advocate once told me that Julia&rsquo;s master plan is to secretly
&ldquo;make everyone aware about <em>compilers</em>&rdquo;.
The <a href="https://en.wikipedia.org/wiki/Compiler">compiler</a>
is a program that translate source code from a high-level programming language
to a low-level programming language
(e.g. assembly language, object code, or machine code) to create an
executable program.</p>
<p>Python uses <a href="https://github.com/python/cpython">CPython</a> as the compiler.
If you search around on why CPython/Python is so slow and inefficient,
you&rsquo;ll find that the culprits are:</p>
<ol>
<li>Python is <strong>dynamic-typed language</strong>.</li>
<li>Python&rsquo;s <strong>Global Interpreter Lock (GIL) restricts multi-threading capabilities</strong>.</li>
<li>Python is <strong>interpreted</strong>, which means that Python code is executed sequentially:
line-by-line.</li>
<li>Python is <strong>garbage-collected</strong>: all memory its tracked,
and allocated or deallocated which introduces overhead.</li>
</ol>
<p>I completely disagree with almost all the above reasons, except the GIL.
<strong>Python is slow because of its design decisions</strong>,
more specifically the way CPython works under the hood.
It is not built for performance in mind.
Actually, the main objective of Python was to be a
&ldquo;language that would be easy to read, write, and maintain&rdquo;.
I salute that: Python has remained true to its main objective.</p>
<p>Now let&rsquo;s switch to Julia:</p>
<ol>
<li>Julia is <strong>dynamic-typed language</strong>.</li>
<li>Julia is <strong>interpreted</strong>, which means that Julia code is executed sequentially:
line-by-line.</li>
<li>Julia is <strong>garbage-collected</strong>: all memory its tracked,
and allocated or deallocated which introduces overhead.</li>
</ol>
<p>I&rsquo;ve copy-pasted all Python&rsquo;s arguments for inefficiency, except the GIL.
And, contrary to Python, <a href="https://julialang.org/benchmarks/">Julia is fast</a>!
Sometimes even faster than C<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>.
Actually, that was the goal all along since Julia&rsquo;s inception.
If you check the <a href="https://julialang.org/blog/2012/02/why-we-created-julia/">notorious Julia announcement blog post from 2012</a>:</p>
<blockquote>
<p>We want a language that&rsquo;s open source, with a liberal license.
We want the speed of C with the dynamism of Ruby.
We want a language that&rsquo;s homoiconic, with true macros like Lisp,
but with obvious, familiar mathematical notation like Matlab.
We want something as usable for general programming as Python,
as easy for statistics as R, as natural for string processing as Perl,
as powerful for linear algebra as Matlab, as good at gluing programs together as the shell.
Something that is dirt simple to learn,
yet keeps the most serious hackers happy.
We want it interactive and we want it compiled.</p>
<p>(Did we mention it should be as fast as C?)</p>
</blockquote>
<p>It mentions &ldquo;speed&rdquo; twice.
Not only that, but also specifically says that it should match C&rsquo;s speed.</p>
<p>Julia is fast because of its design decisions.
One of the major reasons why Julia is fast is because of the choice of compiler
that it uses: <a href="https://llvm.org/">LLVM</a>.</p>
<p>LLVM originally stood for <strong>l</strong>ow <strong>l</strong>evel <strong>v</strong>irtual <strong>m</strong>achine.
Despite its name, LLVM has little to do with traditional virtual machines.
LLVM can take <a href="https://en.wikipedia.org/wiki/Intermediate_representation">intermediate representation (IR)</a>
code and compile it into machine-dependent instructions.
It has <a href="https://foundation.llvm.org/docs/sponsors/">support and sponsorship</a>
from a lot of big-tech corporations,
such as Apple, Google, IBM, Meta, Arm, Intel, AMD, Nvidia, and so on.
It is a pretty fast compiler that can do wonders in optimizing IR code to a
plethora of computer architectures.</p>
<p>In a sense, Julia is a front-end for LLVM.
It turns your easy-to-read and easy-to-write Julia code into LLVM IR code.
Take this for-loop example inside a function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="k">function</span> <span class="n">sum_10</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">acc</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">:</span><span class="mi">10</span>
</span></span><span class="line"><span class="cl">        <span class="n">acc</span> <span class="o">+=</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">acc</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></div><p>Let&rsquo;s check what Julia generates as LLVM IR code for this function.
We can do that with the <code>@code_llvm</code> macro.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@code_llvm</span> <span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span> <span class="n">sum_10</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">define</span> <span class="n">i64</span> <span class="nd">@julia_sum_10_172</span><span class="p">()</span> <span class="c">#0 {</span>
</span></span><span class="line"><span class="cl"><span class="n">top</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">ret</span> <span class="n">i64</span> <span class="mi">55</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span></code></pre></div><p>You can&rsquo;t easily fool the compiler.
Julia understands that the answer is 55,
and the LLVM IR generated code is pretty much just &ldquo;return 55 as a 64-bit integer&rdquo;.</p>
<p>Let&rsquo;s also check the machine-dependent instructions with the <code>@code_native</code> macro.
I am using an Apple Silicon machine, so these instructions might differ from yours:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@code_native</span> <span class="n">debuginfo</span><span class="o">=</span><span class="ss">:none</span> <span class="n">sum_10</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">section</span>        <span class="n">__TEXT</span><span class="p">,</span><span class="n">__text</span><span class="p">,</span><span class="n">regular</span><span class="p">,</span><span class="n">pure_instructions</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">build_version</span> <span class="n">macos</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">globl</span>  <span class="n">_julia_sum_10_214</span>               <span class="p">;</span> <span class="o">--</span> <span class="n">Begin</span> <span class="k">function</span> <span class="n">julia_sum_10_214</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">p2align</span>        <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">_julia_sum_10_214</span><span class="o">:</span>                      <span class="p">;</span> <span class="nd">@julia_sum_10_214</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">cfi_startproc</span>
</span></span><span class="line"><span class="cl"><span class="p">;</span> <span class="o">%</span><span class="n">bb</span><span class="mf">.0</span><span class="o">:</span>                                <span class="p">;</span> <span class="o">%</span><span class="n">top</span>
</span></span><span class="line"><span class="cl">        <span class="n">mov</span>     <span class="n">w0</span><span class="p">,</span> <span class="c">#55</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="n">cfi_endproc</span>
</span></span><span class="line"><span class="cl">                                        <span class="p">;</span> <span class="o">--</span> <span class="n">End</span> <span class="k">function</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">subsections_via_symbols</span>
</span></span></code></pre></div><p>The only important instruction for our argument here is the <code>mov w0, #55</code>.
This means &ldquo;move the value 55 into the <code>w0</code> register&rdquo;,
where <code>w0</code> is one of registers available in ARM-based architectures
(which Apple Silicon chips are).</p>
<p>This is a <strong>zero-cost abstraction</strong>!
I don&rsquo;t need to give up for-loops, because they might be slow and inefficient;
like some Python users suggest newcomers.
I can have the full convenience and expressiveness of for-loops without
paying performance costs.
Pretty much the definition of a zero-cost abstraction from above.</p>
<p>Using LLVM as a compiler backend is not something unique to Julia.
Rust also uses LLVM under the hood.
Take for example this simple Rust code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// main.rs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">sum_10</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="o">..=</span><span class="mi">10</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">acc</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">i</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">acc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;sum_10: </span><span class="si">{}</span><span class="s">&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">sum_10</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>We can inspect both LLVM IR code and machine instructions with the
<a href="https://github.com/pacak/cargo-show-asm"><code>cargo-show-asm</code></a> crate:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cargo asm --llvm <span class="s2">&#34;sum_10::main&#34;</span> <span class="p">|</span> grep <span class="m">55</span>
</span></span><span class="line"><span class="cl">    Finished release <span class="o">[</span>optimized<span class="o">]</span> target<span class="o">(</span>s<span class="o">)</span> in 0.00s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  store i32 55, ptr %_9, align <span class="m">4</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cargo asm <span class="s2">&#34;sum_10::main&#34;</span> <span class="p">|</span> grep <span class="m">55</span>
</span></span><span class="line"><span class="cl">    Finished release <span class="o">[</span>optimized<span class="o">]</span> target<span class="o">(</span>s<span class="o">)</span> in 0.00s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        mov w8, <span class="c1">#55</span>
</span></span></code></pre></div><p>No coincidence that the LLVM IR code is very similar,
with the difference that integers, by default,
in Julia are 64 bits and in Rust 32 bits.
However, the machine code is <strong>identical</strong>:
&ldquo;move the value 55 into a <code>w</code> something register&rdquo;.</p>
<h3 id="enums">Enums</h3>
<p>Another zero-cost abstraction, in Julia and Rust, is <strong>enums</strong>.</p>
<p>In Julia all enums, by default have a <code>BaseType</code> of <code>Int32</code>:
a signed 32-bit integer.
However, we can override this with type annotations:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@enum</span> <span class="n">Thing</span><span class="o">::</span><span class="kt">Bool</span> <span class="n">One</span> <span class="n">Two</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">Base</span><span class="o">.</span><span class="n">summarysize</span><span class="p">(</span><span class="n">Thing</span><span class="p">(</span><span class="nb">false</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>
</span></span></code></pre></div><p>Here we have an enum <code>Thing</code> with two variants: <code>One</code> and <code>Two</code>.
Since we can safely represent all the possible variant space of <code>Thing</code>
with a boolean type, we override the <code>BaseType</code> of <code>Thing</code> to be the <code>Bool</code> type.
Unsurprised, any object of <code>Thing</code> occupies 1 byte in memory.</p>
<p>We can achieve the same with Rust:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rust" data-lang="rust"><span class="line"><span class="cl"><span class="c1">// main.rs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">mem</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="cp">#[allow(dead_code)]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">enum</span> <span class="nc">Thing</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">One</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Two</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="fm">println!</span><span class="p">(</span><span class="s">&#34;Size of Thing: </span><span class="si">{}</span><span class="s"> byte&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">mem</span>::<span class="n">size_of</span>::<span class="o">&lt;</span><span class="n">Thing</span><span class="o">&gt;</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cargo run --release
</span></span><span class="line"><span class="cl">   Compiling enum_size v0.1.0
</span></span><span class="line"><span class="cl">    Finished release <span class="o">[</span>optimized<span class="o">]</span> target<span class="o">(</span>s<span class="o">)</span> in 0.09s
</span></span><span class="line"><span class="cl">     Running <span class="sb">`</span>target/release/enum_size<span class="sb">`</span>
</span></span><span class="line"><span class="cl">Size of Thing: <span class="m">1</span> byte
</span></span></code></pre></div><p>However, contrary to Julia, Rust compiler automatically detects the enum&rsquo;s
variant space size and adjust accordingly.
So, no need of overrides.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Zero-cost abstractions are a joy to have in a programming language.
It enables you, as a programmer, to just focus on what&rsquo;s important:
write expressive code that is easy to read, maintain, debug, and build upon.</p>
<p>It is no wonder that zero-cost abstractions is a pervasive feature
of two of my top-favorite languages:
<a href="https://julialang.org">Julia</a>
and <a href="https://rust-lang.org">Rust</a>.</p>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>this post is somehow connected to my <a href="../2023-11-10-2023-11-13-soydev/">soydev rant</a>.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>and that&rsquo;s not a compliment.&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>technically, we can represent a boolean with just one bit.
However, the short answer is still one byte,
because that&rsquo;s <a href="https://en.wikipedia.org/wiki/Byte">smallest addressable unit of memory</a>.&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>and modifying <code>.gitattributes</code> is cheating.
Yes, I am talking to you <a href="https://github.com/numpy/numpy/blob/06d7bdfbb585264dcf23d4322be7aee449733ca2/.gitattributes#L6-L7">NumPy</a>!&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p><a href="https://github.com/LuxDL/Lux.jl"><code>Lux.jl</code></a> doesn&rsquo;t even have a <code>.gitattributes</code> file.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>if you compare runtime execution.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content>
      </entry>
      <entry>
        <title>Lindley&#39;s Paradox, or The consistency of Bayesian Thinking</title>
        <link rel="alternate" href="https://storopoli.io/2023-11-23-lindley_paradox/" />
        <id>https://storopoli.io/2023-11-23-lindley_paradox/</id>
        <published>2023-11-22T07:06:59-03:00</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">Warning: This post has KaTeX enabled, so if you want to view the rendered math formulas, you&amp;rsquo;ll have to unfortunately enable JavaScript.
Dennis Lindley, one of my many heroes, was an English statistician, decision theorist and leading advocate of Bayesian statistics. He published a pivotal book, Understanding Uncertainty, that changed my view on what is and how to handle uncertainty in a coherent1 way. He is responsible for one of my favorites quotes: &amp;ldquo;Inside every non-Bayesian there is a Bayesian struggling to get out&amp;rdquo;; and one of my favorite heuristics around prior probabilities: Cromwell&amp;rsquo;s Rule2.</summary>
          <content type="html"><![CDATA[<blockquote>
<p>Warning: This post has <a href="https://katex.org/">KaTeX</a> enabled,
so if you want to view the rendered math formulas,
you&rsquo;ll have to unfortunately enable JavaScript.</p>
</blockquote>
<p><img loading="lazy" src="lindley.jpg#center" alt="Dennis Lindley"  />
</p>
<p><a href="https://en.wikipedia.org/wiki/Dennis_Lindley">Dennis Lindley</a>,
one of my many heroes,
was an English statistician,
decision theorist and leading advocate of Bayesian statistics.
He published a pivotal book,
<a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9781118650158">Understanding Uncertainty</a>,
that changed my view on what is and how to handle uncertainty in a
coherent<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> way.
He is responsible for one of my favorites quotes:
&ldquo;Inside every non-Bayesian there is a Bayesian struggling to get out&rdquo;;
and one of my favorite heuristics around prior probabilities:
<a href="https://en.wikipedia.org/wiki/Cromwell%27s_rule">Cromwell&rsquo;s Rule</a><sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.
Lindley predicted in 1975 that &ldquo;Bayesian methods will indeed become pervasive,
enabled by the development of powerful computing facilities&rdquo; (Lindley, 1975).
You can find more about all of Lindley&rsquo;s achievements in his <a href="https://www.theguardian.com/science/2014/mar/16/dennis-lindley">obituary</a>.</p>
<h2 id="lindleys-paradox">Lindley&rsquo;s Paradox</h2>
<p>Lindley&rsquo;s paradox<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> is a counterintuitive situation in statistics
in which the Bayesian and frequentist approaches to a hypothesis testing problem
give different results for certain choices of the prior distribution.</p>
<p>More formally, the paradox is as follows.
We have some parameter $\theta$ that we are interested in.
Then, we proceed with an experiment to test two competing hypotheses:</p>
<ol>
<li>$H_0$ (also known as <em>null hypothesis</em>):
there is no &ldquo;effect&rdquo;, or, more specifically,
$\theta = 0$.</li>
<li>$H_a$ (also known as <em>alternative hypothesis</em>):
there is an &ldquo;effect&rdquo;, or, more specifically,
$\theta \ne 0$.</li>
</ol>
<p>The paradox occurs when two conditions are met:</p>
<ol>
<li>The result of the experiment is <em>significant</em> by a frequentist test of $H_0$,
which indicates sufficient evidence to reject $H_0$, at a certain threshold of
probability<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.</li>
<li>The posterior probability (Bayesian approach) of $H_0 \mid \theta$
(null hypothesis given $\theta$) is high,
which indicates strong evidence that $H_0$ should be favored over $H_a$,
that is, to <em>not</em> reject $H_0$.</li>
</ol>
<p>These results can occur at the same time when $H_0$ is very specific,
$H_a$ more diffuse,
and the prior distribution does not strongly favor one or the other.
These conditions are pervasive across science
and common in traditional null-hypothesis significance testing approaches.</p>
<p>This is a duel of frequentist versus Bayesian approaches,
and one of the many in which Bayesian emerges as the most coherent.
Let&rsquo;s give a example and go over the analytical result with a ton of math,
but also a computational result with <a href="https://julialang.org">Julia</a>.</p>
<h2 id="example">Example</h2>
<p>Here&rsquo;s the setup for the example.
In a certain city 49,581 boys and 48,870 girls have been
born over a certain time period.
The observed proportion of male births is thus
$\frac{49,581}{98,451} \approx 0.5036$.</p>
<p>We assume that the birth of a child is independent with a certain probability
$\theta$.
Since our data is a sequence of $n$ independent <a href="https://en.wikipedia.org/wiki/Bernoulli_trial">Bernoulli trials</a>,
i.e., $n$ independent random experiments with exactly two possible outcomes:
&ldquo;success&rdquo; and &ldquo;failure&rdquo;,
in which the probability of success is the same every time the
experiment is conducted.
We can safely assume that it follows a <a href="https://en.wikipedia.org/wiki/Binomial_distribution">binomial distribution</a>
with parameters:</p>
<ul>
<li>$n$: the number of &ldquo;trials&rdquo; (or the total number of births).</li>
<li>$\theta$: the probability of male births.</li>
</ul>
<p>We then set up our two competing hypotheses:</p>
<ol>
<li>$H_0$: $\theta = 0.5$.</li>
<li>$H_a$: $\theta \ne 0.5$.</li>
</ol>
<h3 id="analytical-solution">Analytical Solution</h3>
<p>This is a toy-problem and, like most toy problems,
we can solve it analytically<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> for both the frequentist and the Bayesian approaches.</p>
<h4 id="analytical-solutions----frequentist-approach">Analytical Solutions &ndash; Frequentist Approach</h4>
<p>The frequentist approach to testing $H_0$ is to compute a $p$-value<sup id="fnref1:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>,
the probability of observing births of boys at least as large as 49,581
assuming $H_0$ is true.
Because the number of births is very large,
we can use a normal approximation<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup> for the
binomial-distributed number of male births.
Let&rsquo;s define $X$ as the total number of male births,
then $X$ follows a normal distribution:</p>
<p>$$X \sim \text{Normal}(\mu, \sigma)$$</p>
<p>where $\mu$ is the mean parameter,
$n \theta$ in our case,
and $\sigma$ is the standard deviation parameter,
$\sqrt{n \theta (1 - \theta)}$.
We need to calculate the conditional probability of
$X \geq \frac{49,581}{98,451} \approx 0.5036$
given $\mu = n \theta = 98,451 \cdot \frac{1}{2} = 49,225.5$
and
$\sigma = \sqrt{n \theta (1 - \theta)} = \sqrt{98,451 \cdot \frac{1}{2} \cdot (1 - \frac{1}{2})}$:</p>
<p>$$P(X \ge 0.5036 \mid \mu = 49,225.5, \sigma = \sqrt{24.612.75})$$</p>
<p>This is basically a
<a href="https://en.wikipedia.org/wiki/Cumulative_distribution_function">cumulative distribution function (CDF)</a>
of $X$ on the interval $[49,225.5, 98,451]$:</p>
<p>$$\int_{49,225.5}^{98,451} \frac{1}{\sqrt{2 \pi \sigma^2}} e^{- \frac{\left( \frac{x - \mu}{\sigma} \right)^2}{2}} dx$$</p>
<p>After inserting the values and doing some arithmetic,
our answer is approximately $0.0117$.
Note that this is a one-sided test,
since it is symmetrical,
the two-sided test would be
$0.0117 \cdot 2 = 0.0235$.
Since we don&rsquo;t deviate from the Fisher&rsquo;s canon,
this is well below the 5% threshold.
Hooray! We rejected the null hypothesis!
Quick! Grab a frequentist celebratory cigar!
But, wait. Let&rsquo;s check the Bayesian approach.</p>
<h4 id="analytical-solutions----bayesian-approach">Analytical Solutions &ndash; Bayesian Approach</h4>
<p>For the Bayesian approach, we need to set prior probabilities on both hypotheses.
Since we do not favor one from another, let&rsquo;s set equal prior probabilities:</p>
<p>$$P(H_0) = P(H_a) = \frac{1}{2}$$</p>
<p>Additionally, all parameters of interest need a prior distribution.
So, let&rsquo;s put a prior distribution on $\theta$.
We could be fancy here, but let&rsquo;s not.
We&rsquo;ll use a uniform distribution on $[0, 1]$.</p>
<p>We have everything we need to compute the posterior probability of $H_0$ given
$\theta$.
For this, we&rsquo;ll use <a href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes theorem</a><sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>:</p>
<p>$$P(A \mid B) = \frac{P(B \mid A) P(A)}{P(B)}$$</p>
<p>Now again let&rsquo;s plug in all the values:</p>
<p>$$P(H_0 \mid \theta) = \frac{P(\theta \mid H_0) P(H_0)}{P(\theta)}$$</p>
<p>Note that by the <a href="https://en.wikipedia.org/wiki/Probability_axioms">axioms of probability</a>
and by the <a href="https://en.wikipedia.org/wiki/Chain_rule_(probability)">product rule of probability</a>
we can decompose $P(\theta)$ into:</p>
<p>$$P(\theta) = P(\theta \mid H_0) P(H_0) + P(\theta \mid H_a) P(H_a)$$</p>
<p>Again, we&rsquo;ll use the normal approximation:</p>
<p>$$
\begin{aligned}
&amp;P \left( \theta = 0.5 \mid \mu = 49,225.5, \sigma = \sqrt{24.612.75} \right) \\
&amp;= \frac{
\frac{1}{\sqrt{2 \pi \sigma^2}} e^{- \left( \frac{(\mu - \mu \cdot 0.5)}{2 \sigma} \right)^2} \cdot 0.5
}
{
\frac{1}{\sqrt{2 \pi \sigma^2}} e^{ \left( -\frac{(\mu - \mu \cdot 0.5)}{2 \sigma} \right)^2} \cdot 0.5 +
\int_0^1 \frac {1}{\sqrt{2 \pi \sigma^2} } e^{- \left( \frac{\mu - \mu \cdot \theta)}{2 \sigma} \right)^2}d \theta \cdot 0.5
} \\
&amp;= 0.9505
\end{aligned}
$$</p>
<p>The likelihood of the alternative hypothesis,
$P(\theta \mid H_a)$,
is just the CDF of all possible values of $\theta \ne 0.5$.</p>
<p>$$P(H_0 \mid \text{data}) = P \left( \theta = 0.5 \mid \mu = 49,225.5, \sigma = \sqrt{24.612.75} \right) &gt; 0.95$$</p>
<p>And we fail to reject the null hypothesis, in frequentist terms.
However, we can also say in Bayesian terms, that we strongly favor $H_0$
over $H_a$.</p>
<p>Quick! Grab the Bayesian celebratory cigar!
The null is back on the game!</p>
<h3 id="computational-solutional">Computational Solutional</h3>
<p>For the computational solution, we&rsquo;ll use <a href="https://julialang.org">Julia</a>
and the following packages:</p>
<ul>
<li><a href="https://github.com/JuliaStats/HypothesisTests.jl"><code>HypothesisTest.jl</code></a></li>
<li><a href="https://turinglang.org/"><code>Turing.jl</code></a></li>
</ul>
<h4 id="computational-solutions----frequentist-approach">Computational Solutions &ndash; Frequentist Approach</h4>
<p>We can perform a <a href="https://juliastats.org/HypothesisTests.jl/stable/nonparametric/#Binomial-test"><code>BinomialTest</code></a>
with <code>HypothesisTest.jl</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">HypothesisTests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">BinomialTest</span><span class="p">(</span><span class="mi">49_225</span><span class="p">,</span> <span class="mi">98_451</span><span class="p">,</span> <span class="mf">0.5036</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Binomial</span> <span class="n">test</span>
</span></span><span class="line"><span class="cl"><span class="o">-------------</span>
</span></span><span class="line"><span class="cl"><span class="n">Population</span> <span class="n">details</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">parameter</span> <span class="n">of</span> <span class="n">interest</span><span class="o">:</span>   <span class="n">Probability</span> <span class="n">of</span> <span class="n">success</span>
</span></span><span class="line"><span class="cl">    <span class="n">value</span> <span class="n">under</span> <span class="n">h_0</span><span class="o">:</span>         <span class="mf">0.5036</span>
</span></span><span class="line"><span class="cl">    <span class="n">point</span> <span class="n">estimate</span><span class="o">:</span>          <span class="mf">0.499995</span>
</span></span><span class="line"><span class="cl">    <span class="mi">95</span><span class="o">%</span> <span class="n">confidence</span> <span class="n">interval</span><span class="o">:</span> <span class="p">(</span><span class="mf">0.4969</span><span class="p">,</span> <span class="mf">0.5031</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Test</span> <span class="n">summary</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">outcome</span> <span class="n">with</span> <span class="mi">95</span><span class="o">%</span> <span class="n">confidence</span><span class="o">:</span> <span class="n">reject</span> <span class="n">h_0</span>
</span></span><span class="line"><span class="cl">    <span class="n">two</span><span class="o">-</span><span class="n">sided</span> <span class="n">p</span><span class="o">-</span><span class="n">value</span><span class="o">:</span>           <span class="mf">0.0239</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Details</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">number</span> <span class="n">of</span> <span class="n">observations</span><span class="o">:</span> <span class="mi">98451</span>
</span></span><span class="line"><span class="cl">    <span class="n">number</span> <span class="n">of</span> <span class="n">successes</span><span class="o">:</span>    <span class="mi">49225</span>
</span></span></code></pre></div><p>This is the two-sided test,
and I had to round $49,225.5$ to $49,225$
since <code>BinomialTest</code> do not support real numbers.
But the results match with the analytical solution,
we still reject the null.</p>
<h4 id="computational-solutions----bayesian-approach">Computational Solutions &ndash; Bayesian Approach</h4>
<p>Now, for the Bayesian computational approach,
I&rsquo;m going to use a generative modeling approach,
and one of my favorites probabilistic programming languages,
<code>Turing.jl</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">Turing</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="nd">@model</span> <span class="k">function</span> <span class="n">birth_rate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">           <span class="n">θ</span> <span class="o">~</span> <span class="n">Uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="n">total_births</span> <span class="o">=</span> <span class="mi">98_451</span>
</span></span><span class="line"><span class="cl">           <span class="n">male_births</span> <span class="o">~</span> <span class="n">Binomial</span><span class="p">(</span><span class="n">total_births</span><span class="p">,</span> <span class="n">θ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="k">end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">model</span> <span class="o">=</span> <span class="n">birth_rate</span><span class="p">()</span> <span class="o">|</span> <span class="p">(;</span> <span class="n">male_births</span> <span class="o">=</span> <span class="mi">49_225</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">chain</span> <span class="o">=</span> <span class="n">sample</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">NUTS</span><span class="p">(</span><span class="mi">1_000</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="n">MCMCThreads</span><span class="p">(),</span> <span class="mi">1_000</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Chains</span> <span class="n">MCMC</span> <span class="n">chain</span> <span class="p">(</span><span class="mi">1000</span><span class="o">×</span><span class="mi">13</span><span class="o">×</span><span class="mi">4</span> <span class="kt">Array</span><span class="p">{</span><span class="kt">Float64</span><span class="p">,</span> <span class="mi">3</span><span class="p">})</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Iterations</span>        <span class="o">=</span> <span class="mi">1001</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="mi">2000</span>
</span></span><span class="line"><span class="cl"><span class="kt">Number</span> <span class="n">of</span> <span class="n">chains</span>  <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">Samples</span> <span class="n">per</span> <span class="n">chain</span> <span class="o">=</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl"><span class="n">Wall</span> <span class="n">duration</span>     <span class="o">=</span> <span class="mf">0.2</span> <span class="n">seconds</span>
</span></span><span class="line"><span class="cl"><span class="n">Compute</span> <span class="n">duration</span>  <span class="o">=</span> <span class="mf">0.19</span> <span class="n">seconds</span>
</span></span><span class="line"><span class="cl"><span class="n">parameters</span>        <span class="o">=</span> <span class="n">θ</span>
</span></span><span class="line"><span class="cl"><span class="n">internals</span>         <span class="o">=</span> <span class="n">lp</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">is_accept</span><span class="p">,</span> <span class="n">acceptance_rate</span><span class="p">,</span> <span class="n">log_density</span><span class="p">,</span> <span class="n">hamiltonian_energy</span><span class="p">,</span> <span class="n">hamiltonian_energy_error</span><span class="p">,</span> <span class="n">max_hamiltonian_energy_error</span><span class="p">,</span> <span class="n">tree_depth</span><span class="p">,</span> <span class="n">numerical_error</span><span class="p">,</span> <span class="n">step_size</span><span class="p">,</span> <span class="n">nom_step_size</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Summary</span> <span class="n">Statistics</span>
</span></span><span class="line"><span class="cl">  <span class="n">parameters</span>      <span class="n">mean</span>       <span class="n">std</span>      <span class="n">mcse</span>    <span class="n">ess_bulk</span>    <span class="n">ess_tail</span>      <span class="n">rhat</span>   <span class="n">ess_per_sec</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Symbol</span>   <span class="kt">Float64</span>   <span class="kt">Float64</span>   <span class="kt">Float64</span>     <span class="kt">Float64</span>     <span class="kt">Float64</span>   <span class="kt">Float64</span>       <span class="kt">Float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">           <span class="n">θ</span>    <span class="mf">0.4999</span>    <span class="mf">0.0016</span>    <span class="mf">0.0000</span>   <span class="mf">1422.2028</span>   <span class="mf">2198.1987</span>    <span class="mf">1.0057</span>     <span class="mf">7368.9267</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Quantiles</span>
</span></span><span class="line"><span class="cl">  <span class="n">parameters</span>      <span class="mf">2.5</span><span class="o">%</span>     <span class="mf">25.0</span><span class="o">%</span>     <span class="mf">50.0</span><span class="o">%</span>     <span class="mf">75.0</span><span class="o">%</span>     <span class="mf">97.5</span><span class="o">%</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Symbol</span>   <span class="kt">Float64</span>   <span class="kt">Float64</span>   <span class="kt">Float64</span>   <span class="kt">Float64</span>   <span class="kt">Float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">           <span class="n">θ</span>    <span class="mf">0.4969</span>    <span class="mf">0.4988</span>    <span class="mf">0.4999</span>    <span class="mf">0.5011</span>    <span class="mf">0.5031</span>
</span></span></code></pre></div><p>We can see from the output of the quantiles that the 95% quantile for $\theta$ is
the interval $(0.4969, 0.5031)$.
Although it overlaps zero, that is not the equivalent of a hypothesis test.
For that, we&rsquo;ll use the
<a href="https://en.wikipedia.org/wiki/highest_posterior_density_interval">highest posterior density interval (HPDI)</a>,
which is defined as &ldquo;choosing the narrowest interval&rdquo; that
captures a certain posterior density threshold value.
In this case, we&rsquo;ll use a threshold interval of 95%,
i.e. an $\alpha = 0.05$:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">hpd</span><span class="p">(</span><span class="n">chain</span><span class="p">;</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">HPD</span>
</span></span><span class="line"><span class="cl">  <span class="n">parameters</span>     <span class="n">lower</span>     <span class="n">upper</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Symbol</span>   <span class="kt">Float64</span>   <span class="kt">Float64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">           <span class="n">θ</span>    <span class="mf">0.4970</span>    <span class="mf">0.5031</span>
</span></span></code></pre></div><p>We see that we fail to reject the null,
$\theta = 0.5$ at $\alpha = 0.05$ which is in accordance with the analytical
solution.</p>
<h2 id="why-the-frequentist-and-bayesian-approaches-disagree">Why the Frequentist and Bayesian Approaches Disagree</h2>
<p>Why do the approaches disagree?
What is going on under the hood?</p>
<p>The answer is disappointing<sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup>.
The main problem is that the frequentist approach only allows fixed significance
levels with respect to sample size.
Whereas the Bayesian approach is consistent and robust to sample size variations.</p>
<p>Taken to extreme, in some cases, due to huge sample sizes,
the $p$-value is pretty much a <em>proxy</em> for sample size
and have little to no utility on hypothesis testing.
This is known as $p$-hacking<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup>.</p>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
<h2 id="references">References</h2>
<p>Lindley, Dennis V. &ldquo;The future of statistics: A Bayesian 21st century&rdquo;.
<em>Advances in Applied Probability</em> 7 (1975): 106-115.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>as far as I know there&rsquo;s only one coherent approach to uncertainty,
and it is the Bayesian approach.
Otherwise, as de Finetti and Ramsey proposed,
you are susceptible to a <a href="https://en.wikipedia.org/wiki/Dutch_book">Dutch book</a>.
This is a topic for another blog post&hellip;&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Cromwell&rsquo;s rule states that the use of prior probabilities of 1
(&ldquo;the event will definitely occur&rdquo;) or 0 (&ldquo;the event will definitely not occur&rdquo;)
should be avoided, except when applied to statements that are logically true or false.
Hence, anything that is not a math theorem should have priors in $(0,1)$.
The reference comes from <a href="https://en.wikipedia.org/wiki/Oliver_Cromwell">Oliver Cromwell</a>,
asking, very politely, for the Church of Scotland to consider that their prior probability
might be wrong.
This footnote also deserves a whole blog post&hellip;&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p><a href="https://en.wikipedia.org/wiki/Stigler%27s_law_of_eponymy">Stigler&rsquo;s law of eponymy</a>
states that no scientific discovery is named after its original discoverer.
The paradox was already was discussed in <a href="https://en.wikipedia.org/wiki/Harold_Jeffreys">Harold Jeffreys</a>'
1939 textbook.
Also, fun fact, Stigler&rsquo;s is not the original creator of such law&hellip;
Now that&rsquo;s a self-referential paradox, and a broad version of the <a href="https://en.wikipedia.org/wiki/Halting_problem">Halting problem</a>,
which should earn its own footnote.
Nevertheless, we are getting into self-referential danger zone here with
footnotes&rsquo; of footnotes&rsquo; of footnotes&rsquo;&hellip;&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4">
<p>this is called $p$-value and can be easily defined as
&ldquo;the probability of sampling data from a target population given that $H_0$
is true as the number of sampling procedures $\to \infty$&rdquo;.
Yes, it is not that intuitive, and it deserves not a blog post,
but a full curriculum to hammer it home.&#160;<a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5">
<p>that is not true for most of the real-world problems.
For Bayesian approaches,
we need to run computational asymptotic exact approximations using a class
of methods called <a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">Markov chain Monte Carlo (MCMC)</a>.
Furthermore, for some nasty problems we need to use different set of methods
called <a href="https://en.wikipedia.org/wiki/Variational_Inference">variational inference (VI)</a>
or <a href="https://en.wikipedia.org/wiki/Approximate_Bayesian_computation">approximate Bayesian computation (ABC)</a>.&#160;<a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6">
<p>if you are curious about how this approximation works,
check the backup slides of my
<a href="https://github.com/storopoli/Bayesian-Statistics">open access and open source graduate course on Bayesian statistics</a>.&#160;<a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7">
<p>Bayes&rsquo; theorem is officially called Bayes-Price-Laplace theorem.
Bayes was trying to disprove David Hume&rsquo;s argument that miracles did not exist
(How dare he?).
He used the probabilistic approach of trying to quantify the probability of a parameter
(god exists) given data (miracles happened).
He died without publishing any of his ideas.
His wife probably freaked out when she saw the huge pile of notes that he had
and called his buddy Richard Price to figure out what to do with it.
Price struck gold and immediately noticed the relevance of Bayes&rsquo; findings.
He read it aloud at the Royal Society.
Later, Pierre-Simon Laplace, unbeknownst to the work of Bayes,
used the same probabilistic approach to perform statistical inference using France&rsquo;s
first census data in the early-Napoleonic era.
Somehow we had the answer to statistical inference back then,
and we had to rediscover everything again in the late-20th century&hellip;&#160;<a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8">
<p>disappointing because most of
published scientific studies suffer from this flaw.&#160;<a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9">
<p>and, like all footnotes here, it deserves its own blog post&hellip;&#160;<a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
]]></content>
      </entry>
      <entry>
        <title>Word Embeddings</title>
        <link rel="alternate" href="https://storopoli.io/2023-11-20-word_embeddings/" />
        <id>https://storopoli.io/2023-11-20-word_embeddings/</id>
        <published>2023-11-19T22:49:51-03:00</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">Warning: This post has KaTeX enabled, so if you want to view the rendered math formulas, you&amp;rsquo;ll have to unfortunately enable JavaScript.
I wish I could go back in time and tell my younger self that you can make a machine understand human language with trigonometry. That would definitely have made me more aware and interested in the subject during my school years. I would have looked at triangles, circles, sines, cosines, and tangents in a whole different way.</summary>
          <content type="html"><![CDATA[<blockquote>
<p>Warning: This post has <a href="https://katex.org/">KaTeX</a> enabled,
so if you want to view the rendered math formulas,
you&rsquo;ll have to unfortunately enable JavaScript.</p>
</blockquote>
<p><img loading="lazy" src="euclid.jpg#center" alt="Euclid of Alexandria"  />
</p>
<p>I wish I could go back in time and tell my younger self
that you can make a machine understand human language with trigonometry.
That would definitely have made me more aware and interested in the
subject during my school years.
I would have looked at triangles, circles, sines, cosines, and tangents
in a whole different way.
Alas, better late than never.</p>
<p>In this post, we&rsquo;ll learn how to represent words using word embeddings,
and how to use basic trigonometry to play around with them.
Of course, we&rsquo;ll use <a href="https://julialang.org">Julia</a>.</p>
<h2 id="word-embeddings">Word Embeddings</h2>
<p><strong><a href="https://en.wikipedia.org/wiki/Word_embedding">Word embeddings</a> is a way to
represent words as a real-valued vector that encodes the meaning of the word
in such a way that words that are closer in the vector space are expected
to be similar in meaning</strong>.</p>
<p>Ok, let&rsquo;s unwrap the above definition.
First, a <strong>real-valued vector</strong> is any vector which its elements belong to the real
numbers.
Generally we denote vectors with a bold lower-case letter,
and we denote its elements (also called components) using square brackets.
Hence, a vector $\bold{v}$ that has 3 elements, $1$, $2$, and $3$,
can be written as</p>
<p>$$\bold{v} = \begin{bmatrix} 1 \\ 2 \\ 3 \end{bmatrix}$$</p>
<p>Next, what &ldquo;close&rdquo; means for vectors?
We can use distance functions to get a measurable value.
The most famous and commonly used distance function is the <strong>Euclidean distance</strong>,
in honor of <a href="https://en.wikipedia.org/wiki/Euclid">Euclid</a>, the &ldquo;father of geometry&rdquo;,
and the guy pictured in the image at the top of this post.
The Euclidean distance is defined in trigonometry for 2-D and 3-D spaces.
However, it can be generalized to any dimension $n &gt; 1$ by using vectors.</p>
<p>Since every word is represented by an $n$-dimensional vector,
we can use distances to compute a metric that represent similarity between vectors.
And, more interesting, we can add and subtract words
(or any other linear combination of one or more words) to generate new words.</p>
<p>Before we jump to code and examples, a quick note about how word embeddings
are constructed.
They are trained like a regular machine learning algorithm,
where the cost function measures the difference between
some vector distance between the vectors and a &ldquo;semantic distance&rdquo;.
The goal is to iteratively find good vector values that minimize the cost.
So, if a vector is close to another vector measured by a distance function,
but far apart measured by some semantic distance on the words that these
vectors represent, then the cost function will be higher.
The algorithm cannot change the semantic distance, it is treated as a fixed value.
However, it can change the vector elements&rsquo; values so that the vector distance function
closely resembles the semantic distance function.
Lastly, generally the dimensionality of the vectors used in word embeddings
are high, $n &gt; 50$, since it needs a proper amount of dimensions in order to
represent all the semantic information of words with vectors.</p>
<h2 id="pre-trained-word-embeddings">Pre-Trained Word Embeddings</h2>
<p>Generally we don&rsquo;t train our own word embeddings from scratch,
we use pre-trained ones.
Here is a list of some of the most popular ones:</p>
<ul>
<li><a href="https://code.google.com/archive/p/word2vec/">Word2Vec</a>:
One of the first public available word embeddings,
made by Google in 2013.
Only supports English.</li>
<li><a href="https://nlp.stanford.edu/projects/glove/">GloVe</a>:
made by Stanford in 2014.
Only supports English.</li>
<li><a href="https://fasttext.cc/">FastText</a>:
From Facebook, released in 2016.
Supports hundreds of languages.</li>
</ul>
<h2 id="julia-code">Julia Code</h2>
<p>We will use the <a href="https://github.com/JuliaText/Embeddings.jl"><code>Embeddings.jl</code></a>
package to easily load word embeddings as vectors,
and the <a href="https://github.com/JuliaStats/Distances.jl"><code>Distances.jl</code></a>
package for the convenience of several distance functions.
This is a nice example of the Julia package ecosystem composability,
where one package can define types, another can define functions,
and another can define custom behavior of these functions on types that
are defined in other packages.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jl" data-lang="jl"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">Embeddings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">Distances</span>
</span></span></code></pre></div><p>Let&rsquo;s load the <a href="https://nlp.stanford.edu/projects/glove/">GloVe</a>
word embeddings.
First, let&rsquo;s check what we have in store to choose from
GloVe&rsquo;s English language embeddings:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jl" data-lang="jl"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">language_files</span><span class="p">(</span><span class="kt">GloVe</span><span class="p">{</span><span class="ss">:en</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="mi">20</span><span class="o">-</span><span class="n">element</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">String</span><span class="p">}</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.50d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.100d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.200d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.300d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.42B.300d/glove.42B.300d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.840B.300d/glove.840B.300d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.25d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.50d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.100d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.200d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.50d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.100d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.200d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.6B/glove.6B.300d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.42B.300d/glove.42B.300d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.840B.300d/glove.840B.300d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.25d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.50d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.100d.txt&#34;</span>
</span></span><span class="line"><span class="cl"> <span class="s">&#34;glove.twitter.27B/glove.twitter.27B.200d.txt&#34;</span>
</span></span></code></pre></div><p>I&rsquo;ll use the <code>&quot;glove.6B/glove.6B.50d.txt&quot;</code>.
This means that it was trained with 6 billion tokens,
and it provides embeddings with 50-dimensional vectors.
The <code>load_embeddings</code> function takes an optional second positional
argument as an <code>Int</code> to choose from which index of the <code>language_files</code> to use.
Finally, I just want the words &ldquo;king&rdquo;, &ldquo;queen&rdquo;, &ldquo;man&rdquo;, &ldquo;woman&rdquo;;
so I am passing these words as a <code>Set</code> to the <code>keep_words</code> keyword argument:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jl" data-lang="jl"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">glove</span> <span class="o">=</span> <span class="n">load_embeddings</span><span class="p">(</span><span class="kt">GloVe</span><span class="p">{</span><span class="ss">:en</span><span class="p">},</span> <span class="mi">1</span><span class="p">;</span> <span class="n">keep_words</span><span class="o">=</span><span class="kt">Set</span><span class="p">([</span><span class="s">&#34;king&#34;</span><span class="p">,</span> <span class="s">&#34;queen&#34;</span><span class="p">,</span> <span class="s">&#34;man&#34;</span><span class="p">,</span> <span class="s">&#34;woman&#34;</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="n">Embeddings</span><span class="o">.</span><span class="kt">EmbeddingTable</span><span class="p">{</span><span class="kt">Matrix</span><span class="p">{</span><span class="kt">Float32</span><span class="p">},</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">String</span><span class="p">}}(</span><span class="kt">Float32</span><span class="p">[</span><span class="o">-</span><span class="mf">0.094386</span> <span class="mf">0.50451</span> <span class="o">-</span><span class="mf">0.18153</span> <span class="mf">0.37854</span><span class="p">;</span> <span class="mf">0.43007</span> <span class="mf">0.68607</span> <span class="mf">0.64827</span> <span class="mf">1.8233</span><span class="p">;</span> <span class="o">…</span> <span class="p">;</span> <span class="mf">0.53135</span> <span class="o">-</span><span class="mf">0.64426</span> <span class="mf">0.48764</span> <span class="mf">0.0092753</span><span class="p">;</span> <span class="o">-</span><span class="mf">0.11725</span> <span class="o">-</span><span class="mf">0.51042</span> <span class="o">-</span><span class="mf">0.10467</span> <span class="o">-</span><span class="mf">0.60284</span><span class="p">],</span> <span class="p">[</span><span class="s">&#34;man&#34;</span><span class="p">,</span> <span class="s">&#34;king&#34;</span><span class="p">,</span> <span class="s">&#34;woman&#34;</span><span class="p">,</span> <span class="s">&#34;queen&#34;</span><span class="p">])</span>
</span></span></code></pre></div><p>Watch out with the order that we get back.
If you see the output of <code>load_embeddings</code>,
the order is <code>&quot;man&quot;, &quot;king&quot;, &quot;woman&quot;, &quot;queen&quot;]</code>
Let&rsquo;s see how a word is represented:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jl" data-lang="jl"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">queen</span> <span class="o">=</span> <span class="n">glove</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="mi">50</span><span class="o">-</span><span class="n">element</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">Float32</span><span class="p">}</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="mf">0.37854</span>
</span></span><span class="line"><span class="cl">  <span class="mf">1.8233</span>
</span></span><span class="line"><span class="cl"> <span class="o">-</span><span class="mf">1.2648</span>
</span></span><span class="line"><span class="cl">  <span class="o">⋮</span>
</span></span><span class="line"><span class="cl"> <span class="o">-</span><span class="mf">2.2839</span>
</span></span><span class="line"><span class="cl">  <span class="mf">0.0092753</span>
</span></span><span class="line"><span class="cl"> <span class="o">-</span><span class="mf">0.60284</span>
</span></span></code></pre></div><p>They are 50-dimensional vectors of <code>Float32</code>.</p>
<p>Now, here&rsquo;s the fun part:
let&rsquo;s add words and check the similarity between the
result and some other word.
A classical example is to start with the word &ldquo;king&rdquo;,
subtract the word &ldquo;men&rdquo;,
add the word &ldquo;woman&rdquo;,
and check the distance of the result to the word &ldquo;queen&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jl" data-lang="jl"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">man</span> <span class="o">=</span> <span class="n">glove</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">king</span> <span class="o">=</span> <span class="n">glove</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">woman</span> <span class="o">=</span> <span class="n">glove</span><span class="o">.</span><span class="n">embeddings</span><span class="p">[</span><span class="o">:</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">cosine_dist</span><span class="p">(</span><span class="n">king</span> <span class="o">-</span> <span class="n">man</span> <span class="o">+</span> <span class="n">woman</span><span class="p">,</span> <span class="n">queen</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">0.13904202f0</span>
</span></span></code></pre></div><p>This is less than 1/4 of the distance of &ldquo;woman&rdquo; to &ldquo;king&rdquo;:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jl" data-lang="jl"><span class="line"><span class="cl"><span class="n">julia</span><span class="o">&gt;</span> <span class="n">cosine_dist</span><span class="p">(</span><span class="n">woman</span><span class="p">,</span> <span class="n">king</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mf">0.58866215f0</span>
</span></span></code></pre></div><p>Feel free to play around with others words.
If you want suggestions, another classical example is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-julia" data-lang="julia"><span class="line"><span class="cl"><span class="n">cosine_dist</span><span class="p">(</span><span class="n">Madrid</span> <span class="o">-</span> <span class="n">Spain</span> <span class="o">+</span> <span class="n">France</span><span class="p">,</span> <span class="n">Paris</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>I think that by allying interesting applications to abstract math topics
like trigonometry is the vital missing piece in STEM education.
I wish every new kid that is learning math could have the opportunity to contemplate
how new and exciting technologies have some amazing simple math under the hood.
If you liked this post, you would probably like <a href="https://en.wikipedia.org/wiki/Linear_algebra">linear algebra</a>.
I would highly recommend <a href="https://math.mit.edu/~gs/">Gilbert Strang&rsquo;s books</a>
and <a href="https://www.youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab">3blue1brown series on linear algebra</a>.</p>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
]]></content>
      </entry>
      <entry>
        <title>What is soydev? And why do I hate it</title>
        <link rel="alternate" href="https://storopoli.io/2023-11-10-2023-11-13-soydev/" />
        <id>https://storopoli.io/2023-11-10-2023-11-13-soydev/</id>
        <published>2023-11-13T00:00:00Z</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">Let&amp;rsquo;s dive into the concept of &amp;ldquo;soydev&amp;rdquo;, a term often used pejoratively to describe developers with a superficial understanding of technology. I provide my definition of what soydev is, why is bad, and how it came to be. To counteract soydev inclinations, I propose an abstract approach centered on timeless concepts, protocols, and first principles, fostering a mindset of exploration, resilience in the face of failure, and an insatiable hunger for knowledge.</summary>
          <content type="html"><![CDATA[<p><img loading="lazy" src="soydev.jpg" alt="soydev meme"  />
</p>
<p>Let&rsquo;s dive into the <strong>concept of &ldquo;soydev&rdquo;</strong>,
a term often used pejoratively to describe developers with
a superficial understanding of technology.
I provide my definition of what soydev is,
why is bad, and how it came to be.
To counteract soydev inclinations,
I propose an abstract approach centered on timeless concepts, protocols,
and first principles, fostering a mindset of exploration,
resilience in the face of failure, and an insatiable hunger for knowledge.</p>
<p>While we&rsquo;ll start with a look at the soydev stereotype,
our journey will lead us to a wider reflection on the importance of depth in
technological understanding.</p>
<h2 id="definition">Definition</h2>
<p>First, let&rsquo;s tackle the definition of <em>soydev</em>.
<a href="https://www.urbandictionary.com/define.php?term=Soydev">Urban Dictionary</a>
provides two interesting definitions:</p>
<p>Urban Dictionary definition 1:</p>
<blockquote>
<p>Soydev is a &ldquo;programmer&rdquo; that works at a bigh tech company and
only knows JavaScript and HTML.
They love IDEs like Visual Studio Code and inefficient frameworks
that slow their code down.
They represent the majority of &ldquo;programmers&rdquo; today and
if their numbers continue growing,
not one person on earth will know how a computer works by the year 2050
when all the gigachad 1980s C and Unix programmers are gone.</p>
</blockquote>
<p>Urban Dictionary definition 2:</p>
<blockquote>
<p>Soydev is a type of most abundant Software Developer.
The Software he/she makes is always inefficient and
uses more CPU and RAM than it should.
This person always prefers hard work to smart work,
Has little or no knowledge of existing solutions of a problem,
Comes up with very complex solution for a simple problem and
has fear of native and fast programming languages like C, C++ and Rust</p>
</blockquote>
<p>These definitions give a glimpse of what a soydev is.
However, they are loaded with pejorative language,
and also are based on non-timeless technologies and tools.
I, much prefer to rely on concepts and principles that are timeless.
Hence, I will provide my own definition of soydev:</p>
<p><strong>Soydev is someone who only has a superficial conception of technology
and computers that is restricted to repeating patterns learned
from popular workflows on the internet;
but who doesn&rsquo;t dedicate time or effort to learning concepts in a deeper way.</strong></p>
<p>Although soydev is a term with specific connotations,
it opens the door to a larger conversation about the depth of our engagement
with technology.
This superficiality is not unique to soydevs
but is a symptom of a broader trend in our relationship with technology.</p>
<p>Most of us start our journey in a skill by having the superficial conception of it.
However, some are not satisfied with this superficial conception,
and strive to understand what lies beyond the surface.</p>
<p>Understanding concepts from first principles allows us to achieve a deep graceful
kind of mastery that when seems almost effortless to others.
Deep down lies a lot of effort and time spent in learning and practicing.
Innumerable hours of deep thinking and reflecting on
why things are the way they are, and how they could be different if you
tried to implement them from scratch yourself.</p>
<p>There is also an inherently rare mixture of curiosity and creativity in the
process of profoundly learning and understanding concepts in this way.
You start not only to ask the &ldquo;Why?&rdquo; questions but also the &ldquo;What if?&rdquo; questions.
I feel that this posture on understanding concepts paves the way for joyful mastery.</p>
<p><a href="https://en.wikipedia.org/wiki/Richard_Feynman">Richard Feynman</a>
once said &ldquo;What I cannot create, I do not understand&rdquo;.
You cannot create anything that you don&rsquo;t know the underlying concepts.
Therefore, by allying creativity and discovery with deep knowledge,
Feynman&rsquo;s argument was that in order for you truly master something,
you&rsquo;ll need to be able to recreate it from scratch.</p>
<p>If you are struggling with my abstractions, I can provide some concrete examples.
A soydev might be someone who:</p>
<ol>
<li>Instead of using a simple text editor like vim/emacs/nano,
prefers a totally bloated IDE like VSCode to write even basic things in plaintext.
Or cannot SSH into a remote server without a GUI.</li>
<li>Instead of choosing a native solution like HTML for a simple web page section,
prefers to overengineer with a JavaScript framework that has a lot of dependencies,
and takes 3 seconds to render in the browser.</li>
<li>Prefers to use black box abstractions instead of learning about basic tech
primitives and protocols that would get the job done.</li>
<li>Has no idea what about most concepts that are at the core of computing like
bit, byte, heap, stack, garbage collector, async, parallel, CPU cycles,
cache miss, L1/L2/L3 cache etc.</li>
<li>Don&rsquo;t understand the math, or what is going on under the hood when
using machine learning libraries.</li>
</ol>
<h2 id="why-soydev-is-bad">Why soydev is bad</h2>
<p>First, let&rsquo;s understand that being a soydev is not necessarily bad,
but is highly limited on his ability and curiosity.
A soydev will never be able to achieve the same level of mastery
as someone who is willing to go deep and learn concepts from first principles.</p>
<p>Now, on the other hand,
soydev is bad because it perpetuates a mindset of superficiality.
The path of technology innovation is guided by curiosity and creativity.
And paved with hard work and deep understanding.
Imagine if all the great minds in technology took the easy path of mindless
tooling and problem-solving?
We would be in a stagnant and infertile scenario,
where everyone would use the same technology and tools without
questioning or thinking about the problems that they are trying to solve.</p>
<p>Hence, the culture of soydev is bad for the future of technology,
where most new developers will be highly limited in their ability to innovate.</p>
<h2 id="why-soydev-is-on-the-rise">Why soydev is on the rise</h2>
<p>I think that soydev culture is highly correlated with
the increase of technology and
decrease of barriers to access such technology.
We live in an age that not only technology is everywhere,
but also to interact with it is quite effortless.</p>
<p>My computational statistician mind is always aware of cognitive
and statistical bias.
Whenever I see a correlation across time,
I always take a step back and try to think about the assumptions
and conceptual models behind it.</p>
<p>Does the increase in technology usage and importance in daily life
results in more people using technology from a professional point-of-view?
Yes.
Does the increase in people professionally using technology
results in an increase of tooling and conceptual abstractions
that allows superficial interactions without need to deeply understand
the concepts behind such technology?
I do think that this is true as well.</p>
<p>These assumptions cover the constituents of the rise of soydev
from a &ldquo;demand&rdquo; viewpoint.
Nevertheless, there is also the analogous &ldquo;supply&rdquo; viewpoint.
If these trends in demand are not met by trends in supply,
we would not see the establishment of the soydev phenomenon.
There is an emerging trend to standardize all the available tech
into commodities.</p>
<p>While commoditization of technological solutions has inherent advantages,
such as scalability and lower opportunity costs,
it has some disadvantages.
The main disadvantage is the abrupt decrease of technological innovations.
If we have strong standardization that are enforced by market and social forces,
then why care to innovate?
Why bring new solutions or new ways to solve problems if it will not be adopted
and are doomed to oblivion?
Why decide to try to do things different if there is such a high maintenance
cost, especially when training and expanding human resources capable of
dealing with such non-standard solutions?</p>
<p>In this context, technological innovation can only be undertaken
by big corporations that, not only have big budgets,
but also big influence to push its innovations as industry standards.</p>
<p>Don&rsquo;t get me wrong: I do think that industry standards are important.
However, I much prefer a protocol standard than product standards.
First, protocol standards are generally not tied to a single company or brand.
Second, protocol standards have a higher propensity to expose its underlying
concepts to developers.
Think about TCP/IP versus your favorite front-end framework:
Which one would result in deeper understanding of the underlying concepts?</p>
<p>The rise of soydevs mirrors a societal shift towards immediate gratification and
away from the pursuit of deep knowledge.</p>
<h2 id="how-to-stop-being-a-soydev">How to stop being a soydev</h2>
<p>Despite these unstoppable trends I do think that it is possible to use
tools and shallow abstractions without being a soydev.
Or, to stop being a soydev and advance towards deep understanding
of what constitutes your craft.
Moving beyond the &lsquo;soydev&rsquo; mindset is about embracing the richness that
comes from a deep understanding of technology.
Here is a short, not by any means exhaustive list of things that you can start doing:</p>
<ol>
<li><strong>Stop thinking about what is latest and greatest</strong>.
The tools are not important as the problems they are solving.
Understand what is the need that the tool tries to address,
and the major concepts on how it works.</li>
<li><strong>Focus on concepts, protocols and first principles</strong>.
Forget about frameworks, languages, editors, apps, etc.
Focus on what probably won&rsquo;t change in the next decade in technology.
It is easy (and less uncertain) to think concepts and problems,
than in tools and solutions.</li>
<li><strong>Set aside some weekly time to explore new ideas</strong>.
Time block it, make it a calendar event.
Try to find a time slot that you can be free of distraction and worries.
Free all of your working memory when you are starting a &ldquo;new idea&rdquo; session.
Think about what problem is this idea trying to solve.
Also don&rsquo;t be stuck to just using the &ldquo;problem-solving&rdquo; lens.
Most concepts that are worth knowing in computer science and programming
don&rsquo;t have a clear problem tied to them.</li>
<li><strong>Tinker. Play around</strong>. Break something down and see if you can build from scratch.
Remember Feynman&rsquo;s &ldquo;What I cannot create, I do not understand&rdquo;.</li>
<li><strong>Failure is almost certain</strong>. Yes, you will definitely fail.
I say to a lot of junior devs, interns, and students that the only advantage
that I have compared to them is that I&rsquo;ve failed more times that they have tried.</li>
<li><strong>Stay curious and hungry for knowledge</strong>.
I am always impressed on how children are so curious.
I feel sad that almost no one retains their childhood curiosity as an adult
(Maybe that&rsquo;s why I love to interact with children).
Also, I am amazed by how deprived of will to learn some are.
That is an idea that for me, it is hard to grasp,
since I feel the exactly opposite.
Often I have to hold myself not diving into certain areas, ideas or concepts
because I cannot afford the time to learn them.
However, I am always tempted by them.</li>
</ol>
<h2 id="license">License</h2>
<p>This post is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International</a>.</p>
<p><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img loading="lazy" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" alt="CC BY-NC-SA 4.0"  />
</a></p>
]]></content>
      </entry>
      <entry>
        <title>About</title>
        <link rel="alternate" href="https://storopoli.io/about/" />
        <id>https://storopoli.io/about/</id>
        <published>0001-01-01T00:00:00Z</published>
        <updated>2024-02-11T10:34:49-03:00</updated>
        <summary type="html">I am a software developer with a background in computational statististics, scienfitic computing, data science, machine learning/deep learning, backend development, and full-stack web development. In other words, I make computers go faster while crunching big numbers (which is almost everything that they do). I am also an ardent Bayesian. I like Rust, Julia, Nix, Vim, and htmx. I love math, computer science, coding, stats, and teaching. I practice Stoic Philosophy daily.</summary>
          <content type="html"><![CDATA[<p>I am a software developer with a background in computational statististics,
scienfitic computing, data science, machine learning/deep learning,
backend development, and full-stack web development.
In other words, I make computers go faster while crunching big numbers
(which is almost everything that they do).
I am also an ardent <a href="https://youtu.be/RMNwsdb5VU4">Bayesian</a>.
I like <a href="https://rust-lang.org/">Rust</a>,
<a href="https://julialang.org">Julia</a>,
<a href="https://nixos.org">Nix</a>,
<a href="https://www.vim.org">Vim</a>,
and <a href="https://htmx.org">htmx</a>.
I love math, computer science, coding, stats, and teaching.
I practice <a href="https://stoicquotes.io">Stoic Philosophy</a> daily.
I hate <a href="https://storopoli.io/2023-11-10-2023-11-13-soydev/">bloatware and the soydev phenomenon</a>.
Everything that I do is either open source or has a permissive Creative Commons license.</p>
<p>Here&rsquo;s a list of some resources that I&rsquo;ve made or contributed:</p>
<ul>
<li><a href="https://juliadatascience.io/">Julia Data Science book</a>.</li>
<li><a href="https://github.com/storopoli/Bayesian-Statistics">Graduate course on Bayesian Statistics</a></li>
<li><a href="https://storopoli.io/Bayesian-Julia">Bayesian Statistics with Julia and Turing</a></li>
<li><a href="https://github.com/TuringLang/TuringGLM.jl"><code>TuringGLM.jl</code></a></li>
<li><a href="https://poweranalyses.org"><code>poweranalyses.org</code> Online calculator for Sample Size, Significance Level, Power, and Effect Size</a></li>
<li><a href="https://storopoli.io/sudoku">Sudoku PWA WebAssembly Game in Rust</a> (code at <a href="https://github.com/storopoli/sudoku"><code>storopoli/sudoku</code></a>)</li>
<li><a href="https://storopoli.io/Computacao-Cientifica/">Data Science and Scientific Computing with Julia (Portuguese)</a></li>
<li><a href="https://github.com/storopoli/ciencia-de-dados">Undergraduate course on Data Science, Machine Learning and Deep Learning (Portuguese)</a></li>
<li><a href="https://storopoli.io/Why-Julia">Why Julia? A gentle pitch</a></li>
<li><a href="https://storopoli.io/Estatistica/">Graduate course on Statistics (Portuguese)</a>
with <code>R</code></li>
<li><a href="https://storopoli.io/Rcpp/"><code>Rcpp</code> tutorials (Portuguese)</a></li>
<li><a href="https://storopoli.io/topic-modeling-workshop/">Topic Modeling workshop (Portuguese)</a></li>
</ul>
<p>I don&rsquo;t have social media, since I think they are overrated
and &ldquo;they sell your data&rdquo;.
If you want to contact me, please send an email.</p>
<p>For career opportunities, check my <a href="https://github.com/storopoli/cv/releases/latest/download/cv.pdf">CV</a>
and my website <a href="https://storopoli.io/">storopoli.io</a>;
where I keep a blog with technical aspects and backstages behind my projects
and milestones.</p>
]]></content>
      </entry>

</feed>


