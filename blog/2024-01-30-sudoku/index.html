<!DOCTYPE html>
<html>
  <head id="head">
    <meta charset="UTF-8">
    <meta name="description" content="Jose Storopoli, PhD - personal website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@storopoli">
    <meta name="twitter:author" content="@storopoli">
    <meta name="twitter:description" content="Jose Storopoli, PhD - personal website">
    <meta name="twitter:title" content="Fullstack and Progressive Web Apps in Rust: A Tale of a Sudoku Spyware | @stropoli">
    <meta name="twitter:image" content="https://storopoli.io/pp.jpg">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Fullstack and Progressive Web Apps in Rust: A Tale of a Sudoku Spyware | @storopoli">
    <meta property="og:image" content="https://storopoli.io/pp.jpg">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title id="title">
      Fullstack and Progressive Web Apps in Rust: A Tale of a Sudoku Spyware
      - @storopoli
    </title>
    <link rel="stylesheet" type="text/css" href="/main.css">
    <link rel="stylesheet" type="text/css" href="/fonts.css">
    <link rel="stylesheet" type="text/css" href="/fira_code.css">
    <link rel="stylesheet" type="text/css" href="/highlight.css">
    <link type="text/css" rel="stylesheet" href="/term-highlight.css">
    
  </head>
  <body>
    <div id="content">
      <style>
        h1,
        h2,
        h3 {
          text-align: center;
        }

        .profile-pic {
          border-radius: 50%;
          border: 5px solid lightblue;
          margin-top: 1rem;
        }
      </style>
      <div style="display:flex; flex-direction:column; align-items:center;">
        <h1 id="header" class="noupper" style="margin-bottom:0;">
          Jose Storopoli, PhD
        </h1>
        <div class="menu" style="display:flex; justify-content:center; ">
          <a href="/">Home</a>
          •
          <a href="/blog/">Blog</a>
          •
          <a href="https://github.com/storopoli" target="_blank">
            GitHub
          </a>
          •
          <a href="/publickey.txt" target="_blank">
            PGP
          </a>
          •
          <a href="/index.xml" rel="alternate" type="application/rss+xml">
            RSS
          </a>
        </div>
      </div>
      
  <h1>Fullstack and Progressive Web Apps in Rust: A Tale of a Sudoku Spyware</h1>
  <p class="post-byline">
    <span>January 30, 2024</span>
    •
    <span>11</span>
    min read • by
    <b>Jose Storopoli, PhD</b>
    <span></span>
  </p>
  <div id="post-description"></div>
  <div>
    <div class="toc block info">
      <h1>&nbsp;Table of Contents</h1>
      <div><ul>
<li>
<ul><li>
<a href="#tools-of-choice"><a href="#tools-of-choice">Tools of Choice</a></li><li><a href="#package-management"><a href="#package-management">Package Management</a></li><li><a href="#runtime-errors"><a href="#runtime-errors">Runtime Errors</a></li><li><a href="#performance"><a href="#performance">Performance</a></li><li><a href="#progressive-web-apps"><a href="#progressive-web-apps">Progressive Web Apps</a></li><li><a href="#sudoku-algorithm"><a href="#sudoku-algorithm">Sudoku Algorithm</a><ul><li>
<a href="#find-the-related-cells"><a href="#find-the-related-cells">Find the Related Cells</a></li><li><a href="#find-the-conflicting-cells"><a href="#find-the-conflicting-cells">Find the Conflicting Cells</a></li></ul></li><li><a href="#sudo-app-state"><a href="#sudo-app-state">Sudoku App State</a></li><li><a href="#tests"><a href="#tests">Tests</a></li><li><a href="#conclusion"><a href="#conclusion">Conclusion</a></li></ul></ul></div>
    </div>
  </div>
  <div></div>
  <div id="content">
    <div id="post-body"><p><figure><img src="/blog/2024-01-30-sudoku/rust_webdev_meme.jpg" alt="">
<figcaption>rust webdev meme</figcaption></figure></p><p>It all started when I had to accompany my mom to the hospital. It was just a routine checkup, but I had to wait for a few hours. I brought my laptop with me, since they have good WiFi and I could work on my projects. Then I realized that my mom was playing a <a href="https://en.wikipedia.org/wiki/Sudoku" target="_blank">Sudoku</a> game on her phone. I couln’t help but notice that the game was full of ads and it was asking for a lot of permissions, like location and sensor data. So I decided to make a <strong>Sudoku game for her, without ads or using any permission</strong>. It wouldn’t even need to ask for the blessing of Google or <a href="https://youtu.be/XHVxm12NbrY" target="_blank">Tim Apple</a> since it was a Progressive Web App (PWA) and it would work offline.</p><p>You can play the game at <a href="https://storopoli.io/sudoku" target="_blank">storopoli.io/sudoku</a> or check the source code at <a href="https://github.com/storopoli/sudoku" target="_blank"><code>storopoli/sudoku</code></a>.</p><p>Here’s a screenshot of the game:</p><p><figure><img src="/blog/2024-01-30-sudoku/sudoku_screenshot.png" alt="">
<figcaption>Sudoku screenshot</figcaption></figure></p><div id=tools-of-choice><h2><a class="" href="#tools-of-choice">Tools of Choice</a></h2><p>So what would I use to build this game? Only one thing: <a href="https://dioxuslabs.com/" target="_blank"><strong>Dioxus</strong></a>. Dioxus is a fullstack framework for Rust, that allows you to build web applications with Rust. You can benefit from the safety and performance of Rust, powerful type system and borrow checker, along with the low memory footprint.</p><p>That’s it. <strong>Just Rust and HTML with some raw CSS</strong>. No “YavaScript”. No Node.js. No npm. No webpack. No Tailwind CSS. Just <code>cargo run --release</code> and you’re done.</p></div><div id=package-management><h2><a class="" href="#package-management">Package Management</a></h2><p>Using Rust for fullstack development is an amazing thing. First, <strong>package management is a breeze with Cargo</strong>. Second, you don’t have to worry about <strong>“npm vulnerabilities”</strong>. Have you ever gone into your project and ran <code>npm audit</code>?</p><p><figure><img src="/blog/2024-01-30-sudoku/npm_vulnerabilities.png" alt="">
<figcaption>NPM vulnerabilities</figcaption></figure></p><p>This is solvable with Rust.</p></div><div id=runtime-errors><h2><a class="" href="#runtime-errors">Runtime Errors</a></h2><p>An additional advantage is that you <strong>don’t have to worry about common runtime errors</strong> like <code>undefined is not a function</code> or <code>null is not an object</code>. These are all picked-up by <strong>Rust on compile time</strong>. So you can focus on the logic of your application knowing that it will work as <strong>expected</strong>.</p><p>A common workflow in Rust fullstack applications is to use Rust’s powerful type system to parse any user input into a type that you can trust, and then propagate that type throughout your application. This way you can be sure that you’re not going to have any runtime errors due to invalid input. This is not the case with “YavaScript”. You need to validate the input at every step of the way, and you can’t be sure that the input is valid at any point in time.</p><p>You can sleep soundly at night knowing that your application won’t crash and as long as the <strong>host machine has electricity and internet access, your app is working as expected</strong>.</p></div><div id=performance><h2><a class="" href="#performance">Performance</a></h2><p>Rust is known for its <strong>performance</strong>. This is due to the fact that Rust gives you control over deciding on which type you’ll use for a variable. This is not the case with “YavaScript”, where you can’t decide if a variable is a number or a string. Also you can use references and lifetimes to avoid copying data around.</p><p>So, if you make sane decisions, like <code>u8</code> (unsigned 8-bit integer) instead of <code>i32</code> (signed 32-bit integer) for a number that will never be greater than 255, you can have a very low memory footprint. Also you can use <code>&amp;str</code> (string slice) instead of <code>String</code> to avoid copying strings around.</p><p>You just don’t have this level of control with “YavaScript”. You get either strings or numbers and you can’t decide on the size of the number. And all of your strings will be heap-allocated and copied around.</p></div><div id=progressive-web-apps><h2><a class="" href="#progressive-web-apps">Progressive Web Apps</a></h2><p>Progressive Web Apps (PWAs) are web applications that are regular web pages or websites, but can appear to the user like traditional applications or native mobile applications. Since they use the device’s browser, they don’t need to be installed through an app store. This is a great advantage, since you don’t have to ask for permissions to Google or <a href="https://youtu.be/XHVxm12NbrY" target="_blank">Tim Apple</a>.</p><p><strong>In Dioxus making a PWA was really easy</strong>. There is a PWA template in the <a href="https://github.com/DioxusLabs/dioxus/tree/master/examples/PWA-example" target="_blank"><code>examples/</code> directory in their repository</a>. You just have to follow the instructions in the README and you’re done. In my case, I only had to change the metadata in the <code>manifest.json</code> file and add what I wanted to cache in the service worker <code>.js</code> file. These were only the favicon icon and the CSS style file.</p></div><div id=sudoku-algorithm><h2><a class="" href="#sudoku-algorithm">Sudoku Algorithm</a></h2><p>I didn’t have to worry about the algorithm to generate the Sudoku board. This was already implemented in the <a href="https://crates.io/crates/sudoku" target="_blank"><code>sudoku</code></a> crate. But I had to implement some <strong>Sudoku logic to make the user interface work</strong>.</p><p>Some things that I had to implement were:</p><ul><li><strong>find the related cells</strong>. Given a cell, find the cells in the same row, column and sub-grid.</li><li><strong>find the conflicting cells</strong>. Given a cell, find the cells in the same row, column and sub-grid that have the same value.</li></ul></div><div id=find-the-related-cells><h3><a class="" href="#find-the-related-cells">Find the Related Cells</a></h3><p>This was a simple task, yet it was very fun to implement.</p><p>To get the related cells, you need to find the row and column of the cell. Then you can find the start row and start column of the 3x3 sub-grid. After that, you can add the cells in the same row, column and sub-grid to a vector. Finally, you can remove the duplicates and the original cell from the vector.</p><p>Here’s the code:</p><pre><code class="rust"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="function">get_related_cells</span><span class="punctuation bracket">(</span><span class="variable parameter">index</span><span class="punctuation delimiter">:</span> <span class="type builtin">u8</span><span class="punctuation bracket">)</span> -&gt; <span class="type">Vec</span>&lt;<span class="type builtin">u8</span><span class="punctuation bracket">&gt;</span> <span class="punctuation bracket">{</span>
    <span class="keyword">let</span> <span class="keyword">mut</span> <span class="constant">related_cells</span> = <span class="type">Vec</span><span class="punctuation delimiter">::</span><span class="function">new</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="keyword">let</span> <span class="constant">row</span> = <span class="constant">index</span> / <span class="constant builtin">9</span><span class="punctuation delimiter">;</span>
    <span class="keyword">let</span> <span class="constant">col</span> = <span class="constant">index</span> % <span class="constant builtin">9</span><span class="punctuation delimiter">;</span>
    <span class="keyword">let</span> <span class="constant">start_row</span> = <span class="constant">row</span> / <span class="constant builtin">3</span> <span class="operator">*</span> <span class="constant builtin">3</span><span class="punctuation delimiter">;</span>
    <span class="keyword">let</span> <span class="constant">start_col</span> = <span class="constant">col</span> / <span class="constant builtin">3</span> <span class="operator">*</span> <span class="constant builtin">3</span><span class="punctuation delimiter">;</span>

    <span class="comment">// Add cells in the same row</span>
    <span class="keyword">for</span> <span class="constant">i</span> <span class="keyword">in</span> <span class="constant builtin">0</span>..<span class="constant builtin">9</span> <span class="punctuation bracket">{</span>
        <span class="constant">related_cells</span><span class="punctuation delimiter">.</span><span class="function method">push</span><span class="punctuation bracket">(</span><span class="constant">row</span> <span class="operator">*</span> <span class="constant builtin">9</span> + <span class="constant">i</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="punctuation bracket">}</span>

    <span class="comment">// Add cells in the same column</span>
    <span class="keyword">for</span> <span class="constant">i</span> <span class="keyword">in</span> <span class="constant builtin">0</span>..<span class="constant builtin">9</span> <span class="punctuation bracket">{</span>
        <span class="constant">related_cells</span><span class="punctuation delimiter">.</span><span class="function method">push</span><span class="punctuation bracket">(</span><span class="constant">i</span> <span class="operator">*</span> <span class="constant builtin">9</span> + <span class="constant">col</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="punctuation bracket">}</span>

    <span class="comment">// Add cells in the same 3x3 sub-grid</span>
    <span class="keyword">for</span> <span class="constant">i</span> <span class="keyword">in</span> <span class="constant">start_row</span>..<span class="constant">start_row</span> + <span class="constant builtin">3</span> <span class="punctuation bracket">{</span>
        <span class="keyword">for</span> <span class="constant">j</span> <span class="keyword">in</span> <span class="constant">start_col</span>..<span class="constant">start_col</span> + <span class="constant builtin">3</span> <span class="punctuation bracket">{</span>
            <span class="constant">related_cells</span><span class="punctuation delimiter">.</span><span class="function method">push</span><span class="punctuation bracket">(</span><span class="constant">i</span> <span class="operator">*</span> <span class="constant builtin">9</span> + <span class="constant">j</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
        <span class="punctuation bracket">}</span>
    <span class="punctuation bracket">}</span>

    <span class="comment">// Remove duplicates and the original cell</span>
    <span class="constant">related_cells</span><span class="punctuation delimiter">.</span><span class="function method">sort_unstable</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="constant">related_cells</span><span class="punctuation delimiter">.</span><span class="function method">dedup</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="constant">related_cells</span><span class="punctuation delimiter">.</span><span class="function method">retain</span><span class="punctuation bracket">(</span>|<span class="operator">&amp;</span><span class="constant">x</span>| <span class="constant">x</span> != <span class="constant">index</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="constant">related_cells</span>
<span class="punctuation bracket">}</span>
</code></pre>
</div><div id=find-the-conflicting-cells><h3><a class="" href="#find-the-conflicting-cells">Find the Conflicting Cells</a></h3><p>To find the conflicting cells, you need to get the value of the target cell. Then you can get the related cells and filter the ones that have the same value as the target cell. Easy peasy.</p><p>Here’s the code:</p><pre><code class="rust"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="function">get_conflicting_cells</span><span class="punctuation bracket">(</span><span class="variable parameter">board</span><span class="punctuation delimiter">:</span> <span class="operator">&amp;</span><span class="type">SudokuState</span><span class="punctuation delimiter">,</span> <span class="variable parameter">index</span><span class="punctuation delimiter">:</span> <span class="type builtin">u8</span><span class="punctuation bracket">)</span> -&gt; <span class="type">Vec</span>&lt;<span class="type builtin">u8</span><span class="punctuation bracket">&gt;</span> <span class="punctuation bracket">{</span>
    <span class="comment">// Get the value of the target cell</span>
    <span class="keyword">let</span> <span class="constant">value</span> = <span class="constant">board</span><span class="punctuation bracket">[</span><span class="constant">index</span> <span class="keyword">as</span> <span class="type builtin">usize</span><span class="punctuation bracket">]</span><span class="punctuation delimiter">;</span>

    <span class="comment">// Ignore if the target cell is empty (value 0)</span>
    <span class="keyword">if</span> <span class="constant">value</span> == <span class="constant builtin">0</span> <span class="punctuation bracket">{</span>
        <span class="keyword">return</span> <span class="type">Vec</span><span class="punctuation delimiter">::</span><span class="function">new</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="punctuation bracket">}</span>

    <span class="comment">// Get related cells</span>
    <span class="keyword">let</span> <span class="constant">related_cells</span> = <span class="function">get_related_cells</span><span class="punctuation bracket">(</span><span class="constant">index</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="comment">// Find cells that have the same value as the target cell</span>
    <span class="constant">related_cells</span>
        <span class="punctuation delimiter">.</span><span class="function method">into_iter</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span>
        <span class="punctuation delimiter">.</span><span class="function method">filter</span><span class="punctuation bracket">(</span>|<span class="operator">&amp;</span><span class="constant">index</span>| <span class="constant">board</span><span class="punctuation bracket">[</span><span class="constant">index</span> <span class="keyword">as</span> <span class="type builtin">usize</span><span class="punctuation bracket">]</span> == <span class="constant">value</span><span class="punctuation bracket">)</span>
        <span class="punctuation delimiter">.</span><span class="function method">collect</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span>
<span class="punctuation bracket">}</span>
</code></pre>
<p>Note that I am using <code>0</code> to represent empty cells.</p><p>But if the user ignores the conflicting cells and adds a number to the board, there will be more conflicting cells than the ones related to the target cell. This can be done with another helper function.</p><p>Here’s the code, and I took the liberty of adding the docstrings (the <code>///</code> comments that renders as documentation):</p><pre><code class="rust"><span class="comment">/// Get all the conflictings cells for all filled cells in a Sudoku board
</span><span class="comment">///
</span><span class="comment">/// ## Parameters
</span><span class="comment">///
</span><span class="comment">/// - `current_sudoku: SudokuState` - A reference to the current [`SudokuState`]
</span><span class="comment">///
</span><span class="comment">/// ## Returns
</span><span class="comment">///
</span><span class="comment">/// Returns a `Vec&lt;u8&gt;` representing all cell&apos;s indices that are conflicting
</span><span class="comment">/// with the current Sudoku board.
</span><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="function">get_all_conflicting_cells</span><span class="punctuation bracket">(</span><span class="variable parameter">current_sudoku</span><span class="punctuation delimiter">:</span> <span class="operator">&amp;</span><span class="type">SudokuState</span><span class="punctuation bracket">)</span> -&gt; <span class="type">Vec</span>&lt;<span class="type builtin">u8</span><span class="punctuation bracket">&gt;</span> <span class="punctuation bracket">{</span>
    <span class="keyword">let</span> <span class="constant">filled</span><span class="punctuation delimiter">:</span> <span class="type">Vec</span>&lt;<span class="type builtin">u8</span><span class="punctuation bracket">&gt;</span> = <span class="constant">current_sudoku</span>
        <span class="punctuation delimiter">.</span><span class="function method">iter</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span>
        <span class="punctuation delimiter">.</span><span class="function method">enumerate</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span>
        <span class="punctuation delimiter">.</span><span class="function method">filter_map</span><span class="punctuation bracket">(</span>|<span class="punctuation bracket">(</span><span class="constant">idx</span><span class="punctuation delimiter">,</span> <span class="operator">&amp;</span><span class="constant">value</span><span class="punctuation bracket">)</span>| <span class="punctuation bracket">{</span>
            <span class="keyword">if</span> <span class="constant">value</span> != <span class="constant builtin">0</span> <span class="punctuation bracket">{</span>
                <span class="type">u8</span><span class="punctuation delimiter">::</span><span class="function">try_from</span><span class="punctuation bracket">(</span><span class="constant">idx</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">.</span><span class="function method">ok</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span>
            <span class="punctuation bracket">}</span> <span class="keyword">else</span> <span class="punctuation bracket">{</span>
                <span class="constant">None</span> <span class="comment">// Filter out the item if the value is 0</span>
            <span class="punctuation bracket">}</span>
        <span class="punctuation bracket">}</span><span class="punctuation bracket">)</span>
        <span class="punctuation delimiter">.</span><span class="function method">collect</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="comment">// Get all conflicting cells for the filled cells</span>
    <span class="keyword">let</span> <span class="keyword">mut</span> <span class="constant">conflicting</span><span class="punctuation delimiter">:</span> <span class="type">Vec</span>&lt;<span class="type builtin">u8</span><span class="punctuation bracket">&gt;</span> = <span class="constant">filled</span>
        <span class="punctuation delimiter">.</span><span class="function method">iter</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span>
        <span class="punctuation delimiter">.</span><span class="function method">flat_map</span><span class="punctuation bracket">(</span>|<span class="operator">&amp;</span><span class="constant">v</span>| <span class="function">get_conflicting_cells</span><span class="punctuation bracket">(</span><span class="constant">current_sudoku</span><span class="punctuation delimiter">,</span> <span class="constant">v</span><span class="punctuation bracket">)</span><span class="punctuation bracket">)</span>
        <span class="punctuation delimiter">.</span><span class="function method">collect</span><span class="punctuation delimiter">::</span>&lt;<span class="type">Vec</span>&lt;<span class="type builtin">u8</span><span class="punctuation bracket">&gt;</span><span class="punctuation bracket">&gt;</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="comment">// Retain unique</span>
    <span class="constant">conflicting</span><span class="punctuation delimiter">.</span><span class="function method">sort_unstable</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="constant">conflicting</span><span class="punctuation delimiter">.</span><span class="function method">dedup</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>

    <span class="constant">conflicting</span>
<span class="punctuation bracket">}</span>
</code></pre>
<p>The trick here is that we are using a <code>flat_map</code> since a naive <code>map</code> would return a nested <code>Vec&lt;Vec&lt;Vec&lt;...&gt;&gt;&gt;</code> of <code>u8</code>s, and we don’t want that. We want a flat <code>Vec&lt;u8&gt;</code> of all conflicting cells. Recursion is always tricky, go ask Alan Turing.</p></div><div id=sudo-app-state><h2><a class="" href="#sudo-app-state">Sudoku App State</a></h2><p>As you can see, I used a <code>SudokuState</code> type to represent the state of the game. This is just a type alias for a <code>[u8; 81]</code> array. This is a very simple and efficient way to represent the state of the game.</p><p>Here’s the code:</p><pre><code class="rust"><span class="keyword">pub</span> <span class="keyword">type</span> <span class="type">SudokuState</span> = <span class="punctuation bracket">[</span><span class="type builtin">u8</span><span class="punctuation delimiter">;</span> <span class="constant builtin">81</span><span class="punctuation bracket">]</span><span class="punctuation delimiter">;</span>
</code></pre>
<p>The Sudoku app has also an undo button. This is implemented by using a <code>Vec&lt;SudokuState&gt;</code> to store the history of the game. Every time that the user adds a number to the board, the new update state is pushed to the history vector. When the user clicks the undo button, the last state is popped from the history vector and the board is updated.</p><p>There’s one additional problem with the undo button. It needs to switch the clicked cell to the one that was clicked before. Yet another simple, but fun, task. First you need to find the index at which two given <code>SudokuState</code>, the current and the last, differ by exactly one item.</p><p>Again I’ll add the docstrings since they incorporate some good practices that are worth mentioning:</p><pre><code class="rust"><span class="comment">/// Finds the index at which two given [`SudokuState`]
</span><span class="comment">/// differ by exactly one item.
</span><span class="comment">///
</span><span class="comment">/// This function iterates over both arrays in lockstep and checks for a
</span><span class="comment">/// pair of elements that are not equal.
</span><span class="comment">/// It assumes that there is exactly one such pair and returns its index.
</span><span class="comment">///
</span><span class="comment">/// ## Parameters
</span><span class="comment">///
</span><span class="comment">/// * `previous: SudokuState` - A reference to the first [`SudokuState`] to compare.
</span><span class="comment">/// * `current: SudokuState` - A reference to the second [`SudokuState`] to compare.
</span><span class="comment">///
</span><span class="comment">/// ## Returns
</span><span class="comment">///
</span><span class="comment">/// Returns `Some(usize)` with the index of the differing element if found,
</span><span class="comment">/// otherwise returns `None` if the arrays are identical (which should not
</span><span class="comment">/// happen given the problem constraints).
</span><span class="comment">///
</span><span class="comment">/// ## Panics
</span><span class="comment">///
</span><span class="comment">/// The function will panic if cannot convert any of the Sudoku&apos;s board cells
</span><span class="comment">/// indexes from `usize` into a `u8`
</span><span class="comment">///
</span><span class="comment">/// ## Examples
</span><span class="comment">///
</span><span class="comment">/// ```
</span><span class="comment">/// let old_board: SudokuState = [0; 81];
</span><span class="comment">/// let mut new_boad: SudokuState = [0; 81];
</span><span class="comment">/// new_board[42] = 1; // Introduce a change
</span><span class="comment">///
</span><span class="comment">/// let index = find_changed_cell(&amp;old_board, &amp;new_board);
</span><span class="comment">/// assert_eq!(index, Some(42));
</span><span class="comment">/// ```
</span><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="function">find_changed_cell</span><span class="punctuation bracket">(</span><span class="variable parameter">previous</span><span class="punctuation delimiter">:</span> <span class="operator">&amp;</span><span class="type">SudokuState</span><span class="punctuation delimiter">,</span> <span class="variable parameter">current</span><span class="punctuation delimiter">:</span> <span class="operator">&amp;</span><span class="type">SudokuState</span><span class="punctuation bracket">)</span> -&gt; <span class="type">Option</span>&lt;<span class="type builtin">u8</span><span class="punctuation bracket">&gt;</span> <span class="punctuation bracket">{</span>
    <span class="keyword">for</span> <span class="punctuation bracket">(</span><span class="constant">index</span><span class="punctuation delimiter">,</span> <span class="punctuation bracket">(</span><span class="operator">&amp;</span><span class="constant">cell1</span><span class="punctuation delimiter">,</span> <span class="operator">&amp;</span><span class="constant">cell2</span><span class="punctuation bracket">)</span><span class="punctuation bracket">)</span> <span class="keyword">in</span> <span class="constant">previous</span><span class="punctuation delimiter">.</span><span class="function method">iter</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">.</span><span class="function method">zip</span><span class="punctuation bracket">(</span><span class="constant">current</span><span class="punctuation delimiter">.</span><span class="function method">iter</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">.</span><span class="function method">enumerate</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span>
        <span class="keyword">if</span> <span class="constant">cell1</span> != <span class="constant">cell2</span> <span class="punctuation bracket">{</span>
            <span class="keyword">return</span> <span class="function">Some</span><span class="punctuation bracket">(</span><span class="type">u8</span><span class="punctuation delimiter">::</span><span class="function">try_from</span><span class="punctuation bracket">(</span><span class="constant">index</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">.</span><span class="function method">expect</span><span class="punctuation bracket">(</span><span class="string">&quot;cannot convert from u8&quot;</span><span class="punctuation bracket">)</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
        <span class="punctuation bracket">}</span>
    <span class="punctuation bracket">}</span>
    <span class="constant">None</span> <span class="comment">// Return None if no change is found (which should not happen in your case)</span>
<span class="punctuation bracket">}</span>
</code></pre>
<p>The function <code>find_changed_cell</code> can panic if it cannot convert any of the Sudoku’s board cells indexes from <code>usize</code> into a <code>u8</code>. Hence, we add a <code>## Panics</code> section to the docstring to inform the user of this possibility. Additionally, we add an <code>## Examples</code> section to show how to use the function. These are good practices that are worth mentioning and I highly encourage you to use them in your Rust code.</p></div><div id=tests><h2><a class="" href="#tests">Tests</a></h2><p>Another advantage of using Rust is that you can write tests for your code without needing to use a third-party library. It is baked into the language and you can run your tests with <code>cargo test</code>.</p><p>Here’s an example of a test for the <code>get_conflicting_cells</code> function:</p><pre><code class="rust"><span class="attribute">#[test]</span>
    <span class="keyword">fn</span> <span class="function">test_conflicts_multiple</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span>
        <span class="keyword">let</span> <span class="constant">board</span> = <span class="punctuation bracket">[</span>
            <span class="constant builtin">1</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">1</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 1 with conflict</span>
            <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">1</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 2 with conflict</span>
            <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 3</span>
            <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 4</span>
            <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 5</span>
            <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 6</span>
            <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 7</span>
            <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 8</span>
            <span class="constant builtin">1</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation delimiter">,</span> <span class="comment">// Row 9 with conflict</span>
        <span class="punctuation bracket">]</span><span class="punctuation delimiter">;</span>
        <span class="constant">assert_eq</span><span class="function macro">!</span><span class="punctuation bracket">(</span><span class="constant">get_conflicting_cells</span><span class="punctuation bracket">(</span><span class="operator">&amp;</span><span class="constant">board</span><span class="punctuation delimiter">,</span> <span class="constant builtin">0</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">,</span> <span class="constant">vec</span>!<span class="punctuation bracket">[</span><span class="constant builtin">8</span><span class="punctuation delimiter">,</span> <span class="constant builtin">10</span><span class="punctuation delimiter">,</span> <span class="constant builtin">72</span><span class="punctuation bracket">]</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="punctuation bracket">}</span>
</code></pre>
<p>And also two tests for the <code>find_changed_cell</code> function:</p><pre><code class="rust"><span class="attribute">#[test]</span>
    <span class="keyword">fn</span> <span class="function">test_find_changed_cell_single_difference</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span>
        <span class="keyword">let</span> <span class="constant">old_board</span><span class="punctuation delimiter">:</span> <span class="type">SudokuState</span> = <span class="punctuation bracket">[</span><span class="constant builtin">0</span><span class="punctuation delimiter">;</span> <span class="constant builtin">81</span><span class="punctuation bracket">]</span><span class="punctuation delimiter">;</span>
        <span class="keyword">let</span> <span class="keyword">mut</span> <span class="constant">new_board</span><span class="punctuation delimiter">:</span> <span class="type">SudokuState</span> = <span class="punctuation bracket">[</span><span class="constant builtin">0</span><span class="punctuation delimiter">;</span> <span class="constant builtin">81</span><span class="punctuation bracket">]</span><span class="punctuation delimiter">;</span>
        <span class="constant">new_board</span><span class="punctuation bracket">[</span><span class="constant builtin">42</span><span class="punctuation bracket">]</span> = <span class="constant builtin">1</span><span class="punctuation delimiter">;</span> <span class="comment">// Introduce a change</span>

        <span class="constant">assert_eq</span><span class="function macro">!</span><span class="punctuation bracket">(</span><span class="constant">find_changed_cell</span><span class="punctuation bracket">(</span><span class="operator">&amp;</span><span class="constant">old_board</span><span class="punctuation delimiter">,</span> <span class="operator">&amp;</span><span class="constant">new_board</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">,</span> <span class="constant">Some</span><span class="punctuation bracket">(</span><span class="constant builtin">42</span><span class="punctuation bracket">)</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="punctuation bracket">}</span>

    <span class="attribute">#[test]</span>
    <span class="keyword">fn</span> <span class="function">test_find_changed_cell_no_difference</span><span class="punctuation bracket">(</span><span class="punctuation bracket">)</span> <span class="punctuation bracket">{</span>
        <span class="keyword">let</span> <span class="constant">old_board</span><span class="punctuation delimiter">:</span> <span class="type">SudokuState</span> = <span class="punctuation bracket">[</span><span class="constant builtin">0</span><span class="punctuation delimiter">;</span> <span class="constant builtin">81</span><span class="punctuation bracket">]</span><span class="punctuation delimiter">;</span>

        <span class="comment">// This should return None since there is no difference</span>
        <span class="constant">assert_eq</span><span class="function macro">!</span><span class="punctuation bracket">(</span><span class="constant">find_changed_cell</span><span class="punctuation bracket">(</span><span class="operator">&amp;</span><span class="constant">old_board</span><span class="punctuation delimiter">,</span> <span class="operator">&amp;</span><span class="constant">old_board</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">,</span> <span class="constant">None</span><span class="punctuation bracket">)</span><span class="punctuation delimiter">;</span>
    <span class="punctuation bracket">}</span>
</code></pre>
</div><div id=conclusion><h2><a class="" href="#conclusion">Conclusion</a></h2><p>I had a lot of fun building this game. I gave my mother an amazing gift that she’ll treasure forever. Her smartphone has one less spyware now. I deployed a fullstack web app with Rust that is fast, safe and efficient; with the caveat that I didn’t touched any “YavaScript” or complexes build tools.</p><p>I hope you enjoyed this post and that you’ll give Rust a try in your next fullstack project.</p></div></div>
  </div>
  <hr>
  <div id="prev-next">
    <span>
      <a href="/blog/2024-01-14-htmx/">←
        <span>htmx: an Oasis in a Desert of Soy</span></a>
    </span>
    <span>&nbsp; • &nbsp;</span>
    <span>
      <a href="/blog/2024-02-05-crypto-basics/"><span>Basics of Cryptographic Signatures</span>
        →</a>
    </span>
    <small>&nbsp; or &nbsp;</small>
    <small>
      <a href="/">Back to the Homepage</a>
    </small>
  </div>

    </div>
    <footer id="footer">
      <small class="noupper" style="color:#606060;font-weight:normal;">
        <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
          CC-BY-SA 4.0
        </a>
         &nbsp;
        —
        &nbsp;
        <a href="https://github.com/storopoli" target="_blank">
          Jose Storopoli, PhD
        </a>
         &nbsp;
        —
        &nbsp;
        <i>made with &nbsp;
          <a href="https://zine-ssg.io" target="_blank">
            <img src="/zig-logo-light.svg" height="13">
          </a></i>
      </small>
      
    </footer>
  </body>
</html>