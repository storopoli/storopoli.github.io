<!DOCTYPE html>
<html>
  <head id="head">
    <meta charset="UTF-8">
    <meta name="description" content="Jose Storopoli, PhD - personal website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@storopoli">
    <meta name="twitter:author" content="@storopoli">
    <meta name="twitter:description" content="Jose Storopoli, PhD - personal website">
    <meta name="twitter:title" content="Shamir&apos;s Secret Sharing | @stropoli">
    <meta name="twitter:image" content="https://storopoli.io/pp.jpg">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Shamir&apos;s Secret Sharing | @storopoli">
    <meta property="og:image" content="https://storopoli.io/pp.jpg">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title id="title">
      Shamir&apos;s Secret Sharing
      - @storopoli
    </title>
    <link rel="stylesheet" type="text/css" href="/main.css">
    <link rel="stylesheet" type="text/css" href="/fonts.css">
    <link rel="stylesheet" type="text/css" href="/fira_code.css">
    <link rel="stylesheet" type="text/css" href="/highlight.css">
    <link type="text/css" rel="stylesheet" href="/term-highlight.css">
    
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0"
    crossorigin="anonymous"
  >
  <!-- The loading of KaTeX is deferred to speed up page rendering -->
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4"
    crossorigin="anonymous"
  ></script>
  <!-- To automatically render math in text elements, include the auto-render extension: -->
  <script
    defer
    src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
    crossorigin="anonymous"
    onload="renderMathInElement(document.body);"
  ></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      renderMathInElement(document.body, {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "$", right: "$", display: false },
        ],
      });
    });
  </script>

  </head>
  <body>
    <div id="content">
      <style>
        h1,
        h2,
        h3 {
          text-align: center;
        }

        .profile-pic {
          border-radius: 50%;
          border: 5px solid lightblue;
          margin-top: 1rem;
        }
      </style>
      <div style="display:flex; flex-direction:column; align-items:center;">
        <h1 id="header" class="noupper" style="margin-bottom:0;">
          Jose Storopoli, PhD
        </h1>
        <div class="menu" style="display:flex; justify-content:center; ">
          <a href="/">Home</a>
          •
          <a href="/blog/">Blog</a>
          •
          <a href="https://github.com/storopoli" target="_blank">
            GitHub
          </a>
          •
          <a href="/publickey.txt" target="_blank">
            PGP
          </a>
          •
          <a href="/index.xml" rel="alternate" type="application/rss+xml">
            RSS
          </a>
        </div>
      </div>
      
  <h1>Shamir&apos;s Secret Sharing</h1>
  <p class="post-byline">
    <span>April 14, 2024</span>
    •
    <span>6</span>
    min read • by
    <b>Jose Storopoli, PhD</b>
    <span></span>
  </p>
  <div id="post-description"></div>
  <div>
    <div class="toc block info">
      <h1>&nbsp;Table of Contents</h1>
      <div><ul>
<li>
<ul><li>
<a href="#polynomial-interpolation"><a href="#polynomial-interpolation">Polynomial Interpolation</a></li><li><a href="#sharing-secret"><a href="#sharing-secret">Shamir’s Secret Sharing</a></li><li><a href="#rotating-shares"><a href="#rotating-shares">Rotating Shares</a></li><li><a href="#the-polynomial-king"><a href="#the-polynomial-king">The Polynomial King</a></li><li><a href="#conclusion"><a href="#conclusion">Conclusion</a></li></ul></ul></div>
    </div>
  </div>
  <div>
    <div class="block warning">
      <h1>&nbsp;Math Equations</h1>
      This post has
      <a href="https://katex.org/">KaTeX</a>
      enabled,
      so if you want to view the rendered math formulas,
      you'll have to unfortunately enable JavaScript.
    </div>
  </div>
  <div id="content">
    <div id="post-body"><p><figure><img src="/blog/2024-04-14-shamir-secret-sharing/polynomial_king.webp" alt="">
<figcaption>The Polynomial king and he can do anything!</figcaption></figure></p><p>In this post, we’ll talk about <strong><a href="https://en.wikipedia.org/wiki/Shamir%27s_Secret_Sharing" target="_blank">Shamir’s Secret Sharing</a> (SSS)</strong>, a cryptographic algorithm that allows us to <strong>split a secret into multiple parts, called shares, in such a way that the secret can only be reconstructed if a certain number of shares are combined</strong>.</p><p>The idea is to give a visual intuition of how the algorithm works, and describe the mathematical details behind it.</p><p>The code for all the plots in this post can be found in <a href="https://github.com/storopoli/shamir-secret-sharing" target="_blank"><code>storopoli/shamir-secret-sharing</code></a>.</p><div id=polynomial-interpolation><h2><a class="" href="#polynomial-interpolation">Polynomial Interpolation</a></h2><p><strong>If you have two points you can draw a <em>unique</em> line that passes through them</strong>. Suppose that you have the points $(3,3)$ and $(4,4)$. Hence, there is only one line that passes through these two points. See the plot below.</p><p><figure><img src="/blog/2024-04-14-shamir-secret-sharing/line.svg" alt="">
<figcaption>A line passing through two points</figcaption></figure></p><p><strong>If you have three points you can draw a <em>unique</em> parabola that passes through them</strong>. Suppose that you have the points $(-4,16)$, $(1,1)$, and $(4,16)$. Hence, there is only one parabola that passes through these three points.</p><p><figure><img src="/blog/2024-04-14-shamir-secret-sharing/quadratic.svg" alt="">
<figcaption>A parabola passing through three points</figcaption></figure></p><p><strong>If you have four points you can draw a <em>unique</em> cubic polynomial that passes through them</strong>. Suppose that you have the points $(-2,8)$, $(-1,1)$, $(1,1)$, and $(2,8)$. Hence, there is only one cubic polynomial that passes through these four points.</p><p><figure><img src="/blog/2024-04-14-shamir-secret-sharing/cubic.svg" alt="">
<figcaption>A cubic polynomial passing through four points</figcaption></figure></p><p>As you might have guessed, <strong>if you have $n$ points you can draw a <em>unique</em> polynomial of degree $n-1$ that passes through them</strong>. This is called <strong>polynomial interpolation</strong>.</p><div class="block info"><p> Steams from the <a href="https://en.wikipedia.org/wiki/Lagrange_polynomial" target="_blank">Lagrange interpolation</a>.</p></div><p>More formally, say that we have a polynomial $f(x)$ of degree $n$:</p><p>$$ f(x) = ax^n + a_{n-1} x^{n-1} + \ldots + a_1 x + a_0 $$</p><p>and we have $n$ points $(x_1, y_1)$, $(x_2, y_2)$, $\ldots$, $(x_n, y_n)$. Then, there is a unique polynomial $f(x)$ of degree $n-1$ such that $f(x_i) = y_i$ for $i = 1, 2, \ldots, n$.</p></div><div id=sharing-secret><h2><a class="" href="#sharing-secret">Shamir’s Secret Sharing</a></h2><p>Ok now let’s connect this idea to Shamir’s Secret Sharing. Suppose you encode a <strong>secret $k$ as a number</strong>. Let’s say a private key for a Bitcoin wallet. As you’ve already know, a private key is just a <a href="/blog/2024-02-05-crypto-basics/">very big number</a>.</p><p>You want to split this secret into <strong>$N$ parts</strong>, called <strong>shares</strong>. You also want to specify a <strong>threshold $T$</strong> such that the <strong>secret $k$ can only be reconstructed if at <em>least</em> $T$ shares are combined</strong>. Here’s how you can use polynomial interpolation to achieve this.</p><p>The idea is to use polynomial interpolation to generate a polynomial $f(x)$ of degree $T-1$ such that $f(0) = k$. In other words, the polynomial $f(x)$ when evaluated at $x = 0$ should give you the secret $k$. Then, you can <strong>generate $N$ shares by evaluating $f(x)$ at $N$ different points</strong>.</p><p>Here’s an example with $T = 4$ and $N = 5$. Our secret is $k = 5$ and since $T = 4$, we generate a polynomial of degree $T-1 = 3$. We’ve chosen the polynomial $f(x) = 2x^3 - 3x^2 + 2x + 5 $. Then, we evaluate $f(x)$ at $N = 5$ different points to generate the shares.</p><p><figure><img src="/blog/2024-04-14-shamir-secret-sharing/shamir.svg" alt="">
<figcaption>Shamir’s Secret Sharing with $N=5$ and $T=4$</figcaption></figure></p><p>Now this polynomial is <strong>guaranteed to pass through the point $(0, k)$</strong>. Hence if you evaluate <strong>$f(0)$ you get the secret $k$</strong>. To know the secret, you <strong>need to know the polynomial $f(x)$</strong>. And to know the polynomial $f(x)$, you <strong>need to know at least $T$ shares</strong>. Otherwise, you <strong>can’t reconstruct the polynomial and hence the secret</strong>.</p><p>In this setup we generate addresses from the extended public key (xpub) of a Bitcoin wallet that has the private key $k$. Then, we split the private key into shares and distribute them to different people. Only if at least $T$ people come together, they can reconstruct the private key and spend the funds.</p></div><div id=rotating-shares><h2><a class="" href="#rotating-shares">Rotating Shares</a></h2><p>Note that there’s nothing special about the points</p><ul><li>$(-2, f(-2))$</li><li>$(-1, f(-1))$</li><li>$(\frac{1}{2}, f(\frac{1}{2}))$</li><li>$(1, f(1))$</li><li>$(2, f(2))$</li></ul><p>that we’ve used in the previous example. You could have chosen <strong>any other $N$ points and the polynomial would still be the same</strong>.</p><p>Suppose now that your share buddy has lost his share. Then, the participants can get together and <strong>generate a new polynomial evaluation at any point $n \notin \{ -2, -1, \frac{1}{2}, 1, 2 \}$</strong>.</p><p>This is exactly what the image below shows:</p><p><figure><img src="/blog/2024-04-14-shamir-secret-sharing/shamir_alternate_single.svg" alt="">
<figcaption>Shamir’s Secret Sharing with $N=5$ and $T=4$</figcaption></figure></p><p>Here we’ve replaced the point $(-2, f(-2))$ with the point $(3, f(3))$. We also assume that the point $(-2, f(-2))$ is lost. The <strong>polynomial is still the same</strong>, and the secret can still be reconstructed if at least $T$ shares are combined.</p><p>We can also <strong>rotate all the shares</strong>. This is shown in the image below:</p><p><figure><img src="/blog/2024-04-14-shamir-secret-sharing/shamir_alternate_multiple.svg" alt="">
<figcaption>Shamir’s Secret Sharing with $N=5$ and $T=4$</figcaption></figure></p><p>Here <strong>all previous points have been replaced by new points</strong>.</p></div><div id=the-polynomial-king><h2><a class="" href="#the-polynomial-king">The Polynomial King</a></h2><blockquote><p>I am the <a href="https://youtu.be/ashTaoGrR2o?t=642" target="_blank"><del>Lizard</del> Polynomial King, I can do anything!</a></p><p>Jim Morrison</p></blockquote><p>In the end <strong>if you somehow know the polynomial $f(x)$, you can do anything</strong>. You can rug-pull all you share buddies and take all the funds.</p><p>There are several ways that a malicious actor could learn the polynomial. For example, if the shares are generated in a predictable way, an attacker could guess the polynomial. Or, during the reconstruction phase, an attacker could learn the polynomial by observing the shares. Additionally, during a distributed share generation, an attacker could disrupt the process and force the participants to reveal their shares.</p><div class="block info"><p> Or force them to reuse nonces. Then, “poof”, private keys are gone.</p></div></div><div id=conclusion><h2><a class="" href="#conclusion">Conclusion</a></h2><p>In this post, <strong>we’ve seen how polynomial interpolation can be used to split a secret into multiple shares</strong>. We’ve also seen how the <strong>secret can be reconstructed if a certain number of shares are combined</strong>. This is the basic idea behind <strong>Shamir’s Secret Sharing (SSS)</strong>.</p><p>Note that the devil is in the details. A lot of the complexities of SSS come from the <strong>details of how the shares are generated and how the secret is reconstructed</strong>. There are <strong>several types of attacks that can be done by a malicious actor</strong>. Especially during the share generation and reconstruction phases.</p><p>The intent of this blog post is to show how <strong>elegant, simple and powerful the idea behind SSS is</strong>.</p></div></div>
  </div>
  <hr>
  <div id="prev-next">
    <span>
      <a href="/blog/2024-03-23-dead-man-switch/">←
        <span>Sherlock Holmes Final Letter: A Simple Dead Man&apos;s Switch in Rust</span></a>
    </span>
    <span>&nbsp; • &nbsp;</span>
    <span>
      <a href="/blog/2024-06-08-zkp/"><span>Some Intuitions on Zero-Knowledge Proofs</span>
        →</a>
    </span>
    <small>&nbsp; or &nbsp;</small>
    <small>
      <a href="/">Back to the Homepage</a>
    </small>
  </div>

    </div>
    <footer id="footer">
      <small class="noupper" style="color:#606060;font-weight:normal;">
        <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">
          CC-BY-SA 4.0
        </a>
         &nbsp;
        —
        &nbsp;
        <a href="https://github.com/storopoli" target="_blank">
          Jose Storopoli, PhD
        </a>
         &nbsp;
        —
        &nbsp;
        <i>made with &nbsp;
          <a href="https://zine-ssg.io" target="_blank">
            <img src="/zig-logo-light.svg" height="13">
          </a></i>
      </small>
      
    </footer>
  </body>
</html>